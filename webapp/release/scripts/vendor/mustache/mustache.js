(function(t,e){"object"==typeof exports&&exports?module.exports=e:"function"==typeof define&&define.amd?define(e):t.Mustache=e})(this,function(){function t(t,e){return RegExp.prototype.test.call(t,e)}function e(e){return!t(d,e)}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function n(t){return(t+"").replace(/[&<>"'\/]/g,function(t){return w[t]})}function o(t){this.string=t,this.tail=t,this.pos=0}function s(t,e){this.view=t,this.parent=e,this.clearCache()}function a(){this.clearCache()}function r(t){function e(t,e,n){if(!i[t]){var o=r(e);i[t]=function(t,e){return o(t,e,n)}}return i[t]}var i={};return function(i,n,o){for(var s,a,r="",h=0,l=t.length;l>h;++h)switch(s=t[h],s[0]){case"#":a=o.slice(s[3],s[5]),r+=i._section(s[1],n,a,e(h,s[4],o));break;case"^":r+=i._inverted(s[1],n,e(h,s[4],o));break;case">":r+=i._partial(s[1],n);break;case"&":r+=i._name(s[1],n);break;case"name":r+=i._escaped(s[1],n);break;case"text":r+=s[1]}return r}}function h(t){for(var e,i=[],n=i,o=[],s=0,a=t.length;a>s;++s)switch(e=t[s],e[0]){case"#":case"^":o.push(e),n.push(e),n=e[4]=[];break;case"/":var r=o.pop();r[5]=e[2],n=o.length>0?o[o.length-1][4]:i;break;default:n.push(e)}return i}function l(t){for(var e,i,n=[],o=0,s=t.length;s>o;++o)e=t[o],"text"===e[0]&&i&&"text"===i[0]?(i[1]+=e[1],i[3]=e[3]):(i=e,n.push(e));return n}function c(t){return[RegExp(i(t[0])+"\\s*"),RegExp("\\s*"+i(t[1]))]}var f={};f.name="mustache.js",f.version="0.7.2",f.tags=["{{","}}"],f.Scanner=o,f.Context=s,f.Writer=a;var u=/\s*/,p=/\s+/,d=/\S/,v=/\s*=/,m=/\s*\}/,g=/#|\^|\/|>|\{|&|=|!/,y=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.escape=n,o.prototype.eos=function(){return""===this.tail},o.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},o.prototype.scanUntil=function(t){var e,i=this.tail.search(t);switch(i){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,i),this.tail=this.tail.substring(i),this.pos+=i}return e},s.make=function(t){return t instanceof s?t:new s(t)},s.prototype.clearCache=function(){this._cache={}},s.prototype.push=function(t){return new s(t,this)},s.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."===t)e=this.view;else for(var i=this;i;){if(t.indexOf(".")>0){var n=t.split("."),o=0;for(e=i.view;e&&n.length>o;)e=e[n[o++]]}else e=i.view[t];if(null!=e)break;i=i.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(t,e){var i=this._cache[t];if(!i){var n=f.parse(t,e);i=this._cache[t]=this.compileTokens(n,t)}return i},a.prototype.compilePartial=function(t,e,i){var n=this.compile(e,i);return this._partialCache[t]=n,n},a.prototype.compileTokens=function(t,e){var i=r(t),n=this;return function(t,o){if(o)if("function"==typeof o)n._loadPartial=o;else for(var a in o)n.compilePartial(a,o[a]);return i(n,s.make(t),e)}},a.prototype.render=function(t,e,i){return this.compile(t)(e,i)},a.prototype._section=function(t,e,i,n){var o=e.lookup(t);switch(typeof o){case"object":if(y(o)){for(var s="",a=0,r=o.length;r>a;++a)s+=n(this,e.push(o[a]));return s}return o?n(this,e.push(o)):"";case"function":var h=this,l=function(t){return h.render(t,e)},c=o.call(e.view,i,l);return null!=c?c:"";default:if(o)return n(this,e)}return""},a.prototype._inverted=function(t,e,i){var n=e.lookup(t);return!n||y(n)&&0===n.length?i(this,e):""},a.prototype._partial=function(t,e){t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t));var i=this._partialCache[t];return i?i(e):""},a.prototype._name=function(t,e){var i=e.lookup(t);return"function"==typeof i&&(i=i.call(e.view)),null==i?"":i+""},a.prototype._escaped=function(t,e){return f.escape(this._name(t,e))},f.parse=function(t,n){function s(){if(x&&!T)for(;k.length;)b.splice(k.pop(),1);else k=[];x=!1,T=!1}if(t=t||"",n=n||f.tags,"string"==typeof n&&(n=n.split(p)),2!==n.length)throw Error("Invalid tags: "+n.join(", "));for(var a,r,d,y,w=c(n),$=new o(t),C=[],b=[],k=[],x=!1,T=!1;!$.eos();){if(a=$.pos,d=$.scanUntil(w[0]))for(var j=0,P=d.length;P>j;++j)y=d.charAt(j),e(y)?k.push(b.length):T=!0,b.push(["text",y,a,a+1]),a+=1,"\n"===y&&s();if(a=$.pos,!$.scan(w[0]))break;if(x=!0,r=$.scan(g)||"name",$.scan(u),"="===r)d=$.scanUntil(v),$.scan(v),$.scanUntil(w[1]);else if("{"===r){var E=RegExp("\\s*"+i("}"+n[1]));d=$.scanUntil(E),$.scan(m),$.scanUntil(w[1]),r="&"}else d=$.scanUntil(w[1]);if(!$.scan(w[1]))throw Error("Unclosed tag at "+$.pos);if("/"===r){if(0===C.length)throw Error('Unopened section "'+d+'" at '+a);var _=C.pop();if(_[1]!==d)throw Error('Unclosed section "'+_[1]+'" at '+a)}var D=[r,d,a,$.pos];if(b.push(D),"#"===r||"^"===r)C.push(D);else if("name"===r||"{"===r||"&"===r)T=!0;else if("="===r){if(n=d.split(p),2!==n.length)throw Error("Invalid tags at "+a+": "+n.join(", "));w=c(n)}}var _=C.pop();if(_)throw Error('Unclosed section "'+_[1]+'" at '+$.pos);return h(l(b))};var $=new a;return f.clearCache=function(){return $.clearCache()},f.compile=function(t,e){return $.compile(t,e)},f.compilePartial=function(t,e,i){return $.compilePartial(t,e,i)},f.compileTokens=function(t,e){return $.compileTokens(t,e)},f.render=function(t,e,i){return $.render(t,e,i)},f.to_html=function(t,e,i,n){var o=f.render(t,e,i);return"function"!=typeof n?o:(n(o),void 0)},f}());