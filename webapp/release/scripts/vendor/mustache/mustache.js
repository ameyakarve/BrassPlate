(function(e,t){"object"==typeof exports&&exports?module.exports=t:"function"==typeof define&&define.amd?define(t):e.Mustache=t})(this,function(){function e(e,t){return RegExp.prototype.test.call(e,t)}function t(t){return!e(h,t)}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return b[e]})}function i(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=e,this.parent=t,this.clearCache()}function a(){this.clearCache()}function s(e){function t(e,t,r){if(!n[e]){var i=s(t);n[e]=function(e,t){return i(e,t,r)}}return n[e]}var n={};return function(n,r,i){for(var o,a,s="",u=0,c=e.length;c>u;++u)switch(o=e[u],o[0]){case"#":a=i.slice(o[3],o[5]),s+=n._section(o[1],r,a,t(u,o[4],i));break;case"^":s+=n._inverted(o[1],r,t(u,o[4],i));break;case">":s+=n._partial(o[1],r);break;case"&":s+=n._name(o[1],r);break;case"name":s+=n._escaped(o[1],r);break;case"text":s+=o[1]}return s}}function u(e){for(var t,n=[],r=n,i=[],o=0,a=e.length;a>o;++o)switch(t=e[o],t[0]){case"#":case"^":i.push(t),r.push(t),r=t[4]=[];break;case"/":var s=i.pop();s[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}function c(e){for(var t,n,r=[],i=0,o=e.length;o>i;++i)t=e[i],"text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t));return r}function l(e){return[RegExp(n(e[0])+"\\s*"),RegExp("\\s*"+n(e[1]))]}var f={};f.name="mustache.js",f.version="0.7.2",f.tags=["{{","}}"],f.Scanner=i,f.Context=o,f.Writer=a;var d=/\s*/,p=/\s+/,h=/\S/,m=/\s*=/,g=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/,y=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.escape=r,i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},i.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},o.make=function(e){return e instanceof o?e:new o(e)},o.prototype.clearCache=function(){this._cache={}},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."===e)t=this.view;else for(var n=this;n;){if(e.indexOf(".")>0){var r=e.split("."),i=0;for(t=n.view;t&&r.length>i;)t=t[r[i++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(e,t){var n=this._cache[e];if(!n){var r=f.parse(e,t);n=this._cache[e]=this.compileTokens(r,e)}return n},a.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},a.prototype.compileTokens=function(e,t){var n=s(e),r=this;return function(e,i){if(i)if("function"==typeof i)r._loadPartial=i;else for(var a in i)r.compilePartial(a,i[a]);return n(r,o.make(e),t)}},a.prototype.render=function(e,t,n){return this.compile(e)(t,n)},a.prototype._section=function(e,t,n,r){var i=t.lookup(e);switch(typeof i){case"object":if(y(i)){for(var o="",a=0,s=i.length;s>a;++a)o+=r(this,t.push(i[a]));return o}return i?r(this,t.push(i)):"";case"function":var u=this,c=function(e){return u.render(e,t)},l=i.call(t.view,n,c);return null!=l?l:"";default:if(i)return r(this,t)}return""},a.prototype._inverted=function(e,t,n){var r=t.lookup(e);return!r||y(r)&&0===r.length?n(this,t):""},a.prototype._partial=function(e,t){e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e));var n=this._partialCache[e];return n?n(t):""},a.prototype._name=function(e,t){var n=t.lookup(e);return"function"==typeof n&&(n=n.call(t.view)),null==n?"":n+""},a.prototype._escaped=function(e,t){return f.escape(this._name(e,t))},f.parse=function(e,r){function o(){if(T&&!k)for(;_.length;)C.splice(_.pop(),1);else _=[];T=!1,k=!1}if(e=e||"",r=r||f.tags,"string"==typeof r&&(r=r.split(p)),2!==r.length)throw Error("Invalid tags: "+r.join(", "));for(var a,s,h,y,b=l(r),w=new i(e),x=[],C=[],_=[],T=!1,k=!1;!w.eos();){if(a=w.pos,h=w.scanUntil(b[0]))for(var S=0,E=h.length;E>S;++S)y=h.charAt(S),t(y)?_.push(C.length):k=!0,C.push(["text",y,a,a+1]),a+=1,"\n"===y&&o();if(a=w.pos,!w.scan(b[0]))break;if(T=!0,s=w.scan(v)||"name",w.scan(d),"="===s)h=w.scanUntil(m),w.scan(m),w.scanUntil(b[1]);else if("{"===s){var j=RegExp("\\s*"+n("}"+r[1]));h=w.scanUntil(j),w.scan(g),w.scanUntil(b[1]),s="&"}else h=w.scanUntil(b[1]);if(!w.scan(b[1]))throw Error("Unclosed tag at "+w.pos);if("/"===s){if(0===x.length)throw Error('Unopened section "'+h+'" at '+a);var A=x.pop();if(A[1]!==h)throw Error('Unclosed section "'+A[1]+'" at '+a)}var N=[s,h,a,w.pos];if(C.push(N),"#"===s||"^"===s)x.push(N);else if("name"===s||"{"===s||"&"===s)k=!0;else if("="===s){if(r=h.split(p),2!==r.length)throw Error("Invalid tags at "+a+": "+r.join(", "));b=l(r)}}var A=x.pop();if(A)throw Error('Unclosed section "'+A[1]+'" at '+w.pos);return u(c(C))};var w=new a;return f.clearCache=function(){return w.clearCache()},f.compile=function(e,t){return w.compile(e,t)},f.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)},f.compileTokens=function(e,t){return w.compileTokens(e,t)},f.render=function(e,t,n){return w.render(e,t,n)},f.to_html=function(e,t,n,r){var i=f.render(e,t,n);return"function"!=typeof r?i:(r(i),void 0)},f}());