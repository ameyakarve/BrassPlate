define([],function(){function t(){return""===u.hash||"#"===u.hash}function e(t,e){for(var n=0;t.length>n;n+=1)if(e(t[n],n,t)===!1)return}function n(t){for(var e=[],n=0,i=t.length;i>n;n++)e=e.concat(t[n]);return e}function i(t,e,n){if(!t.length)return n();var i=0;(function r(){e(t[i],function(e){e||e===!1?(n(e),n=function(){}):(i+=1,i===t.length?n():r())})})()}function r(t,e,n){n=t;for(var i in e)if(e.hasOwnProperty(i)&&(n=e[i](t),n!==t))break;return n===t?"([._a-zA-Z0-9-]+)":n}function o(t,e){for(var n,i=0,o="";n=t.substr(i).match(/[^\w\d\- %@&]*\*[^\w\d\- %@&]*/);)i=n.index+n[0].length,n[0]=n[0].replace(/^\*/,"([_.()!\\ %@&a-zA-Z0-9-]+)"),o+=t.substr(0,n.index)+n[0];t=o+=t.substr(i);var s,a=t.match(/:([^\/]+)/gi);if(a){s=a.length;for(var u=0;s>u;u++)t=t.replace(a[u],r(a[u],e))}return t}function a(t,e,n,i){var r,o=0,s=0,a=0,n=""+(n||"("),i=""+(i||")");for(r=0;t.length>r;r++){var u=t[r];if(u.indexOf(n,o)>u.indexOf(i,o)||~u.indexOf(n,o)&&!~u.indexOf(i,o)||!~u.indexOf(n,o)&&~u.indexOf(i,o)){if(s=u.indexOf(n,o),a=u.indexOf(i,o),~s&&!~a||!~s&&~a){var c=t.slice(0,(r||1)+1).join(e);t=[c].concat(t.slice((r||1)+1))}o=(a>s?a:s)+1,r=0}else o=0}return t}Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var n,i=[],r=0,o=this.length;o>r;r++)r in this&&t.call(e,n=this[r],r,this)&&i.push(n);return i}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var u=document.location,c={mode:"modern",hash:u.hash,history:!1,check:function(){var t=u.hash;t!=this.hash&&(this.hash=t,this.onHashChanged())},fire:function(){"modern"===this.mode?this.history===!0?window.onpopstate():window.onhashchange():this.onHashChanged()},init:function(t,e){function n(t){for(var e=0,n=l.listeners.length;n>e;e++)l.listeners[e](t)}var i=this;if(this.history=e,l.listeners||(l.listeners=[]),"onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7))this.history===!0?setTimeout(function(){window.onpopstate=n},500):window.onhashchange=n,this.mode="modern";else{var r=document.createElement("iframe");r.id="state-frame",r.style.display="none",document.body.appendChild(r),this.writeFrame(""),"onpropertychange"in document&&"attachEvent"in document&&document.attachEvent("onpropertychange",function(){"location"===event.propertyName&&i.check()}),window.setInterval(function(){i.check()},50),this.onHashChanged=n,this.mode="legacy"}return l.listeners.push(t),this.mode},destroy:function(t){if(l&&l.listeners)for(var e=l.listeners,n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)},setHash:function(t){return"legacy"===this.mode&&this.writeFrame(t),this.history===!0?(window.history.pushState({},document.title,t),this.fire()):u.hash="/"===t[0]?t:"/"+t,this},writeFrame:function(t){var e=document.getElementById("state-frame"),n=e.contentDocument||e.contentWindow.document;n.open(),n.write("<script>_hash = '"+t+"'; onload = parent.listener.syncHash;<script>"),n.close()},syncHash:function(){var t=this._hash;return t!=u.hash&&(u.hash=t),this},onHashChanged:function(){}},l=l=function(t){return this instanceof l?(this.params={},this.routes={},this.methods=["on","once","after","before"],this.scope=[],this._methods={},this._insert=this.insert,this.insert=this.insertEx,this.historySupport=null!=(null!=window.history?window.history.pushState:null),this.configure(),this.mount(t||{}),void 0):new l(t)};return l.prototype.init=function(e){var n=this;if(this.handler=function(t){var e=t&&t.newURL||window.location.hash,i=n.history===!0?n.getPath():e.replace(/.*#/,"");n.dispatch("on",i)},c.init(this.handler,this.history),this.history===!1)t()&&e?u.hash=e:t()||n.dispatch("on",u.hash.replace(/^#/,""));else{var i=t()&&e?e:t()?null:u.hash.replace(/^#/,"");i&&window.history.replaceState({},document.title,i),(i||this.run_in_init===!0)&&this.handler()}return this},l.prototype.explode=function(){var t=this.history===!0?this.getPath():u.hash;return"/"===t.charAt(1)&&(t=t.slice(1)),t.slice(1,t.length).split("/")},l.prototype.setRoute=function(t,e,n){var i=this.explode();return"number"==typeof t&&"string"==typeof e?i[t]=e:"string"==typeof n?i.splice(t,e,s):i=[t],c.setHash(i.join("/")),i},l.prototype.insertEx=function(t,e,n,i){return"once"===t&&(t="on",n=function(t){var e=!1;return function(){return e?void 0:(e=!0,t.apply(this,arguments))}}(n)),this._insert(t,e,n,i)},l.prototype.getRoute=function(t){var e=t;if("number"==typeof t)e=this.explode()[t];else if("string"==typeof t){var n=this.explode();e=n.indexOf(t)}else e=this.explode();return e},l.prototype.destroy=function(){return c.destroy(this.handler),this},l.prototype.getPath=function(){var t=window.location.pathname;return"/"!==t.substr(0,1)&&(t="/"+t),t},l.prototype.configure=function(t){t=t||{};for(var e=0;this.methods.length>e;e++)this._methods[this.methods[e]]=!0;return this.recurse=t.recurse||this.recurse||!1,this.async=t.async||!1,this.delimiter=t.delimiter||"/",this.strict=t.strict===void 0?!0:t.strict,this.notfound=t.notfound,this.resource=t.resource,this.history=t.html5history&&this.historySupport||!1,this.run_in_init=this.history===!0&&t.run_handler_in_init!==!1,this.every={after:t.after||null,before:t.before||null,on:t.on||null},this},l.prototype.param=function(t,e){":"!==t[0]&&(t=":"+t);var n=RegExp(t,"g");this.params[t]=function(t){return t.replace(n,e.source||e)}},l.prototype.on=l.prototype.route=function(t,e,n){var i=this;return n||"function"!=typeof e||(n=e,e=t,t="on"),Array.isArray(e)?e.forEach(function(e){i.on(t,e,n)}):(e.source&&(e=e.source.replace(/\\\//gi,"/")),Array.isArray(t)?t.forEach(function(t){i.on(t.toLowerCase(),e,n)}):(e=e.split(RegExp(this.delimiter)),e=a(e,this.delimiter),this.insert(t,this.scope.concat(e),n),void 0))},l.prototype.dispatch=function(t,e,n){function i(){o.last=s.after,o.invoke(o.runlist(s),o,n)}var r,o=this,s=this.traverse(t,e,this.routes,""),a=this._invoked;return this._invoked=!0,s&&0!==s.length?("forward"===this.recurse&&(s=s.reverse()),r=this.every&&this.every.after?[this.every.after].concat(this.last):[this.last],r&&r.length>0&&a?(this.async?this.invoke(r,this,i):(this.invoke(r,this),i()),!0):(i(),!0)):(this.last=[],"function"==typeof this.notfound&&this.invoke([this.notfound],{method:t,path:e},n),!1)},l.prototype.invoke=function(t,n,r){var o=this;this.async?i(t,function s(e,r){return Array.isArray(e)?i(e,s,r):("function"==typeof e&&e.apply(n,t.captures.concat(r)),void 0)},function(){r&&r.apply(n,arguments)}):e(t,function s(i){return Array.isArray(i)?e(i,s):"function"==typeof i?i.apply(n,t.captures||[]):("string"==typeof i&&o.resource&&o.resource[i].apply(n,t.captures||[]),void 0)})},l.prototype.traverse=function(t,e,n,i,r){function o(t){function e(t){for(var n=[],i=0;t.length>i;i++)n[i]=Array.isArray(t[i])?e(t[i]):t[i];return n}function n(t){for(var e=t.length-1;e>=0;e--)Array.isArray(t[e])?(n(t[e]),0===t[e].length&&t.splice(e,1)):r(t[e])||t.splice(e,1)}if(!r)return t;var i=e(t);return i.matched=t.matched,i.captures=t.captures,i.after=t.after.filter(r),n(i),i}var s,a,u,c,l=[];if(e===this.delimiter&&n[t])return c=[[n.before,n[t]].filter(Boolean)],c.after=[n.after].filter(Boolean),c.matched=!0,c.captures=[],o(c);for(var f in n)if(n.hasOwnProperty(f)&&(!this._methods[f]||this._methods[f]&&"object"==typeof n[f]&&!Array.isArray(n[f]))){if(s=a=i+this.delimiter+f,this.strict||(a+="["+this.delimiter+"]?"),u=e.match(RegExp("^"+a)),!u)continue;if(u[0]&&u[0]==e&&n[f][t])return c=[[n[f].before,n[f][t]].filter(Boolean)],c.after=[n[f].after].filter(Boolean),c.matched=!0,c.captures=u.slice(1),this.recurse&&n===this.routes&&(c.push([n.before,n.on].filter(Boolean)),c.after=c.after.concat([n.after].filter(Boolean))),o(c);if(c=this.traverse(t,e,n[f],s),c.matched)return c.length>0&&(l=l.concat(c)),this.recurse&&(l.push([n[f].before,n[f].on].filter(Boolean)),c.after=c.after.concat([n[f].after].filter(Boolean)),n===this.routes&&(l.push([n.before,n.on].filter(Boolean)),c.after=c.after.concat([n.after].filter(Boolean)))),l.matched=!0,l.captures=c.captures,l.after=c.after,o(l)}return!1},l.prototype.insert=function(t,e,n,i){var r,s,a,u,c;if(e=e.filter(function(t){return t&&t.length>0}),i=i||this.routes,c=e.shift(),/\:|\*/.test(c)&&!/\\d|\\w/.test(c)&&(c=o(c,this.params)),e.length>0)return i[c]=i[c]||{},this.insert(t,e,n,i[c]);if(c||e.length||i!==this.routes){if(s=typeof i[c],a=Array.isArray(i[c]),i[c]&&!a&&"object"==s)switch(r=typeof i[c][t]){case"function":return i[c][t]=[i[c][t],n],void 0;case"object":return i[c][t].push(n),void 0;case"undefined":return i[c][t]=n,void 0}else if("undefined"==s)return u={},u[t]=n,i[c]=u,void 0;throw Error("Invalid route context: "+s)}switch(r=typeof i[t]){case"function":return i[t]=[i[t],n],void 0;case"object":return i[t].push(n),void 0;case"undefined":return i[t]=n,void 0}},l.prototype.extend=function(t){function e(t){i._methods[t]=!0,i[t]=function(){var e=1===arguments.length?[t,""]:[t];i.on.apply(i,e.concat(Array.prototype.slice.call(arguments)))}}var n,i=this,r=t.length;for(n=0;r>n;n++)e(t[n])},l.prototype.runlist=function(t){var e=this.every&&this.every.before?[this.every.before].concat(n(t)):n(t);return this.every&&this.every.on&&e.push(this.every.on),e.captures=t.captures,e.source=t.source,e},l.prototype.mount=function(t,e){function n(e,n){var r=e,o=e.split(i.delimiter),s=typeof t[e],u=""===o[0]||!i._methods[o[0]],c=u?"on":r;return u&&(r=r.slice((r.match(RegExp(i.delimiter))||[""])[0].length),o.shift()),u&&"object"===s&&!Array.isArray(t[e])?(n=n.concat(o),i.mount(t[e],n),void 0):(u&&(n=n.concat(r.split(i.delimiter)),n=a(n,i.delimiter)),i.insert(c,n,t[e]),void 0)}if(t&&"object"==typeof t&&!Array.isArray(t)){var i=this;e=e||[],Array.isArray(e)||(e=e.split(i.delimiter));for(var r in t)t.hasOwnProperty(r)&&n(r,e.slice(0))}},{Router:l}});