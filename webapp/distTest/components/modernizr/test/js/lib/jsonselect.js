(function(t){function e(t){try{return JSON&&JSON.parse?JSON.parse(t):Function("return "+t)()}catch(e){n("ijs")}}function n(t){throw Error(u[t])}function i(t){return Array.isArray?Array.isArray(t):"[object Array]"===c.call(t)}function o(t){if(null===t)return"null";var e=typeof t;return"object"===e&&i(t)&&(e="array"),e}function s(t,e,n,i,s){var r,a=[],l=">"===e[0]?e[1]:e[0],c=!0;return l.type&&(c=c&&l.type===o(t)),l.id&&(c=c&&l.id===n),c&&l.pf&&(":nth-last-child"===l.pf?i=s-i:i++,0===l.a?c=l.b===i:(r=(i-l.b)%l.a,c=!r&&i*l.a+l.b>=0)),">"!==e[0]&&":root"!==e[0].pc&&a.push(e),c&&(">"===e[0]?e.length>2&&(c=!1,a.push(e.slice(2))):e.length>1&&(c=!1,a.push(e.slice(1)))),[c,a]}function r(t,e,n,o,a,l){var c,u,h=","===t[0]?t.slice(1):[t],p=[],d=!1,f=0,m=0,v=0;for(f=0;h.length>f;f++)for(u=s(e,h[f],o,a,l),u[0]&&(d=!0),m=0;u[1].length>m;m++)p.push(u[1][m]);if(p.length&&"object"==typeof e)if(p.length>=1&&p.unshift(","),i(e))for(f=0;e.length>f;f++)r(p,e[f],n,void 0,f,e.length);else{v=0;for(c in e)e.hasOwnProperty(c)&&v++;f=0;for(c in e)e.hasOwnProperty(c)&&r(p,e[c],n,c,f++,v)}d&&n&&n(e)}function a(t,e){var n=[];return r(t,e,function(t){n.push(t)}),n}function l(t){return{sel:m(t),match:function(t){return a(this.sel,t)},forEach:function(t,e){return r(this.sel,t,e)}}}var c=Object.prototype.toString,u={ijs:"invalid json string",mpc:"multiple pseudo classes (:xxx) not allowed",mepf:"malformed expression in pseudo-function",nmi:"multiple ids not allowed",se:"selector expected",sra:"string required after '.'",uc:"unrecognized char",ujs:"unclosed json string",upc:"unrecognized pseudo class"},h={psc:1,psf:2,typ:3,str:4},p=/^(?:([\r\n\t\ ]+)|([*.,>])|(string|boolean|null|array|object|number)|(:(?:root|first-child|last-child|only-child))|(:(?:nth-child|nth-last-child))|(:\w+)|(\"(?:[^\\]|\\[^\"])*\")|(\")|((?:[_a-zA-Z]|[^\0-\0177]|\\[^\r\n\f0-9a-fA-F])(?:[_a-zA-Z0-9\-]|[^\u0000-\u0177]|(?:\\[^\r\n\f0-9a-fA-F]))*))/,d=/^\s*\(\s*(?:([+\-]?)([0-9]*)n\s*(?:([+\-])\s*([0-9]))?|(odd|even)|([+\-]?[0-9]+))\s*\)/,f=function(t,i){i||(i=0);var o=p.exec(t.substr(i));if(!o)return void 0;i+=o[0].length;var s;return o[1]?s=[i," "]:o[2]?s=[i,o[0]]:o[3]?s=[i,h.typ,o[0]]:o[4]?s=[i,h.psc,o[0]]:o[5]?s=[i,h.psf,o[0]]:o[6]?n("upc"):o[7]?s=[i,h.str,e(o[0])]:o[8]?n("ujs"):o[9]&&(s=[i,h.str,o[0].replace(/\\([^\r\n\f0-9a-fA-F])/g,"$1")]),s},m=function(t){for(var e,n=[],i=0;;){var o=v(t,i);if(n.push(o[1]),o=f(t,i=o[0]),o&&" "===o[1]&&(o=f(t,i=o[0])),!o)break;">"===o[1]?(n.push(">"),i=o[0]):","===o[1]&&(void 0===e?e=[",",n]:e.push(n),n=[],i=o[0])}return e&&e.push(n),e?e:n},v=function(t,e){var i=e,o={},s=f(t,e);for(s&&" "===s[1]&&(i=e=s[0],s=f(t,e)),s&&s[1]===h.typ?(o.type=s[2],s=f(t,e=s[0])):s&&"*"===s[1]&&(s=f(t,e=s[0]));;){if(void 0===s)break;if("."===s[1])s=f(t,e=s[0]),s&&s[1]===h.str||n("sra"),o.id&&n("nmi"),o.id=s[2];else if(s[1]===h.psc)(o.pc||o.pf)&&n("mpc"),":first-child"===s[2]?(o.pf=":nth-child",o.a=0,o.b=1):":last-child"===s[2]?(o.pf=":nth-last-child",o.a=0,o.b=1):o.pc=s[2];else{if(s[1]!==h.psf)break;(o.pc||o.pf)&&n("mpc"),o.pf=s[2];var r=d.exec(t.substr(s[0]));r||n("mepf"),r[5]?(o.a=2,o.b="odd"===r[5]?1:0):r[6]?(o.a=0,o.b=parseInt(r[6],10)):(o.a=parseInt((r[1]?r[1]:"+")+(r[2]?r[2]:"1"),10),o.b=r[3]?parseInt(r[3]+r[4],10):0),s[0]+=r[0].length}s=f(t,e=s[0])}return i===e&&n("se"),[e,o]};t._lex=f,t._parse=m,t.match=function(t,e){return l(t).match(e)},t.forEach=function(t,e,n){return l(t).forEach(e,n)},t.compile=l})("undefined"==typeof exports?window.JSONSelect={}:exports);