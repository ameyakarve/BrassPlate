window.dojo&&dojo.provide("doh._browserRunner"),function(){doh.setTimeout=function(e,i){return setTimeout(e,i)};try{var topdog=window.parent==window||!Boolean(window.parent.doh)}catch(e){topdog=!0}if(topdog){var byId=function(e){return document.getElementById(e)},_addOnEvt=function(e,i,u){u||(u=window);var s=i;"string"==typeof i&&(s=u[i]);var t=function(){return s.apply(u,arguments)};window.dojo&&"load"==e?dojo.addOnLoad(t):window.attachEvent?window.attachEvent("on"+e,t):window.addEventListener?window.addEventListener(e,t,!1):document.addEventListener&&document.addEventListener(e,t,!1)},escapeXml=function(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},_logBacklog=[],_loggedMsgLen=0,sendToLogPane=function(e,i){for(var u="",s=0;e.length>s;s++)u+=" "+e[s];if(u=escapeXml(u),u=u.replace("	","&nbsp;&nbsp;&nbsp;&nbsp;").replace(" ","&nbsp;").replace("\n","<br>&nbsp;"),!byId("logBody"))return _logBacklog.push(u),void 0;if(_logBacklog.length&&!i)for(var t;t=_logBacklog.shift();)sendToLogPane(t,!0);var a=byId("logBody"),l=document.createElement("div");l.innerHTML=u,a.appendChild(l),_loggedMsgLen++},findTarget=function(e){for(;e&&!e.getAttribute("_target");)e=e.parentNode,e.getAttribute||(e=null);return e};doh._jumpToLog=function(e){var i=findTarget(e?e.target:window.event.srcElement);if(i){var u=Number(i.getAttribute("_target")),s=byId("logBody");if(!(u>=s.childNodes.length)){var t=s.childNodes[u];if(t.scrollIntoView(),window.dojo){var a=dojo.style(t.parentNode.parentNode,"backgroundColor"),l=dojo.style(i.parentNode,"backgroundColor"),n=dojo.animateProperty({node:t,duration:500,properties:{backgroundColor:{start:l,end:a}},onEnd:function(){t.style.backgroundColor=""}}),r=dojo.animateProperty({node:t,duration:500,properties:{backgroundColor:{start:a,end:l}},onEnd:function(){n.play()}});r.play()}}}},doh._jumpToSuite=function(e){var i=findTarget(e?e.target:window.event.srcElement);if(i){var u=i.getAttribute("_target"),s=getGroupNode(u);s&&s.scrollIntoView()}},doh._init=function(e){return function(){var i=byId("logBody");if(i){for(;i.firstChild;)i.removeChild(i.firstChild);_loggedMsgLen=0}this._totalTime=0,this._suiteCount=0,e.apply(doh,arguments)}}(doh._init),doh._setupGroupForRun=function(e){return function(i){var u=doh._groups[i];doh._curTestCount=u.length,doh._curGroupCount=1;var s=getGroupNode(i);s&&s.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen+1),e.apply(doh,arguments)}}(doh._setupGroupForRun),doh._report=function(e){return function(){var i=byId("testList");if(i){var u=i.getElementsByTagName("tfoot");u.length&&i.removeChild(u[0]);var s=i.createTFoot(),t=s.insertRow(-1);t.className="inProgress";var a=t.insertCell(-1);a.colSpan=2,a.innerHTML="Result",a=t.insertCell(-1),a.innerHTML=this._testCount+" tests in "+this._groupCount+" groups /<span class='failure'>"+this._errorCount+"</span> errors, <span class='failure'>"+this._failureCount+"</span> failures",a.setAttribute("_target",_loggedMsgLen+1),t.insertCell(-1).innerHTML=doh._totalTime+"ms"}var l=null;if(doh.perfTestResults){window.dojo?(dojo.require("dojox.charting.Chart2D"),dojo.require("dojox.charting.DataChart"),dojo.require("dojox.charting.plot2d.Scatter"),dojo.require("dojox.charting.plot2d.Lines"),dojo.require("dojo.data.ItemFileReadStore"),l=doh._dojoPlotPerfResults):l=doh._asciiPlotPerfResults;try{var n,r=byId("perfTestsBody"),m=[];doh.perfTestResults&&doh.showPerfTestsPage();for(n in doh.perfTestResults){var o=doh.perfTestResults[n],c=document.createElement("h1");c.appendChild(document.createTextNode("Group: "+n)),r.appendChild(c);var d=document.createElement("blockquote");r.appendChild(d);var p;for(p in o){var v=o[p];if(v){var q=document.createElement("h3");q.appendChild(document.createTextNode("TEST: "+p)),q.style.textDecoration="underline",d.appendChild(q);var g=document.createElement("div");d.appendChild(g);var b,f="<b>TRIAL SIZE: </b>"+v.trials[0].testIterations+" iterations<br>"+"<b>NUMBER OF TRIALS: </b>"+v.trials.length+"<br>",h=[],P=[];for(b=0;v.trials.length>b;b++)h.push(v.trials[b].average),P.push(v.trials[b].executionTime);f+="<b>AVERAGE TRIAL EXECUTION TIME: </b>"+doh.average(P).toFixed(10)+"ms.<br>",f+="<b>MAXIMUM TEST ITERATION TIME: </b>"+doh.max(h).toFixed(10)+"ms.<br>",f+="<b>MINIMUM TEST ITERATION TIME: </b>"+doh.min(h).toFixed(10)+"ms.<br>",f+="<b>AVERAGE TEST ITERATION TIME: </b>"+doh.average(h).toFixed(10)+"ms.<br>",f+="<b>MEDIAN TEST ITERATION TIME: </b>"+doh.median(h).toFixed(10)+"ms.<br>",f+="<b>VARIANCE TEST ITERATION TIME: </b>"+doh.variance(h).toFixed(10)+"ms.<br>",f+="<b>STANDARD DEVIATION ON TEST ITERATION TIME: </b>"+doh.standardDeviation(h).toFixed(10)+"ms.<br>",g.innerHTML=f,g=document.createElement("div"),g.innerHTML="<h3>Average Test Execution Time (in milliseconds, with median line)</h3>",d.appendChild(g),g=document.createElement("div"),dojo.style(g,"width","600px"),dojo.style(g,"height","250px"),d.appendChild(g),m.push({div:g,title:"Average Test Execution Time",data:h}),g=document.createElement("div"),g.innerHTML="<h3>Average Trial Execution Time (in milliseconds, with median line)</h3>",d.appendChild(g),g=document.createElement("div"),dojo.style(g,"width","600px"),dojo.style(g,"height","250px"),d.appendChild(g),m.push({div:g,title:"Average Trial Execution Time",data:P})}}}var N=function(){if(m.length){var e=m.shift();l(e.div,e.title,e.data)}doh.setTimeout(N,50)};doh.setTimeout(N,150)}catch(S){doh.debug(S)}}e.apply(doh,arguments)}}(doh._report),doh.debug=this.opera&&opera.postError?function(){for(var e="",i=0;arguments.length>i;i++)e+=" "+arguments[i];sendToLogPane([e]),opera.postError("DEBUG:"+e)}:window.console?function(){for(var e="",i=0;arguments.length>i;i++)e+=" "+arguments[i];sendToLogPane([e]),console.log("DEBUG:"+e)}:function(){sendToLogPane.call(window,arguments)};var loaded=!1,groupTemplate=null,testTemplate=null,groupNodes={},_groupTogglers={},_getGroupToggler=function(e,i){if(_groupTogglers[e])return _groupTogglers[e];var u=!0;return _groupTogglers[e]=function(s,t){var a,l=groupNodes[e].__items;if(u||t){for(u=!1,a=0;l.length>a;a++)l[a].style.display="";i.innerHTML="&#9660;"}else{for(u=!0,a=0;l.length>a;a++)l[a].style.display="none";i.innerHTML="&#9658;"}}},addGroupToList=function(e){if(byId("testList")){var i=byId("testList").tBodies[0],u=groupTemplate.cloneNode(!0),s=u.getElementsByTagName("td"),t=s[0];t.onclick=_getGroupToggler(e,t);var a=s[1].getElementsByTagName("input")[0];return a.group=e,a.onclick=function(){doh._groups[e].skip=!this.checked},s[2].innerHTML="<div class='testGroupName'>"+e+"</div><div style='width:0;'>&nbsp;</div>",s[3].innerHTML="",i.appendChild(u),u}},addFixtureToList=function(e,i){if(testTemplate){var u=groupNodes[e];u.__items||(u.__items=[]);var s=testTemplate.cloneNode(!0),t=s.getElementsByTagName("td");t[2].innerHTML=i.name,t[3].innerHTML="";var a=(u.__lastFixture||u.__groupNode).nextSibling;return a?a.parentNode.insertBefore(s,a):u.__groupNode.parentNode.appendChild(s),s.style.display="none",u.__items.push(s),u.__lastFixture=s}},getFixtureNode=function(e,i){return groupNodes[e]?groupNodes[e][i.name]:null},getGroupNode=function(e){return groupNodes[e]?groupNodes[e].__groupNode:null},updateBacklog=[];doh._updateTestList=function(e,i,u){if(!loaded)return e&&i&&updateBacklog.push([e,i]),void 0;if(updateBacklog.length&&!u)for(var s;s=updateBacklog.shift();)doh._updateTestList(s[0],s[1],!0);e&&i&&(groupNodes[e]||(groupNodes[e]={__groupNode:addGroupToList(e)}),groupNodes[e][i.name]||(groupNodes[e][i.name]=addFixtureToList(e,i)))},doh._testRegistered=doh._updateTestList,doh._groupStarted=function(e){0==this._suiteCount&&(this._runedSuite=0,this._currentGlobalProgressBarWidth=0,this._suiteCount=this._testCount),doh._inGroup!=e&&(doh._groupTotalTime=0,doh._runed=0,doh._inGroup=e,this._runedSuite++);var i=getGroupNode(e);i&&(i.className="inProgress")},doh._groupFinished=function(e,i){var u=getGroupNode(e);if(u&&doh._inGroup==e){doh._totalTime+=doh._groupTotalTime,u.getElementsByTagName("td")[3].innerHTML=doh._groupTotalTime+"ms",u.getElementsByTagName("td")[2].lastChild.className="",doh._inGroup=null;var s=doh._updateGlobalProgressBar(this._runedSuite/this._groupCount,i,e);u.className=s?"failure":"success",doh._currentGlobalProgressBarWidth=parseInt(1e4*(this._runedSuite/this._groupCount))/100}doh._inGroup==e&&this.debug('Total time for GROUP "',e,'" is ',doh._groupTotalTime,"ms")},doh._testStarted=function(e,i){var u=getFixtureNode(e,i);u&&(u.className="inProgress")};var _nameTimes={},_playSound=function(e){if(byId("hiddenAudio")&&byId("audio")&&byId("audio").checked){var i=_nameTimes[e];if(!i||new Date-i>700){_nameTimes[e]=new Date;var u=document.createElement("span");byId("hiddenAudio").appendChild(u),u.innerHTML='<embed src="_sounds/'+e+'.wav" autostart="true" loop="false" hidden="true" width="1" height="1"></embed>'}}};doh._updateGlobalProgressBar=function(e,i,u){var s=byId("progressOuter"),t=s.childNodes[doh._runedSuite-1];t||(t=document.createElement("div"),s.appendChild(t),t.className="success",t.setAttribute("_target",u)),i||t._failure||(t._failure=!0,t.className="failure",u&&t.setAttribute("title","failed group "+u));var a=parseInt(1e4*e)/100;return t.style.width=a-doh._currentGlobalProgressBarWidth+"%",t._failure},doh._testFinished=function(e,i,u){var s=getFixtureNode(e,i),t=i.endTime-i.startTime;if(s&&(s.getElementsByTagName("td")[3].innerHTML=t+"ms",s.className=u?"success":"failure",s.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen),!u)){_playSound("doh");var a=getGroupNode(e);a&&(a.className="failure",_getGroupToggler(e)(null,!0))}if(doh._inGroup==e){var a=getGroupNode(e);if(doh._runed++,a&&doh._curTestCount){var l=doh._runed/doh._curTestCount,n=this._updateGlobalProgressBar((doh._runedSuite+l-1)/doh._groupCount,u,e),r=a.getElementsByTagName("td")[2].lastChild;r.className=n?"failure":"success",r.style.width=parseInt(100*l)+"%",a.getElementsByTagName("td")[3].innerHTML=parseInt(1e4*l)/100+"%"}}this._groupTotalTime+=t,this.debug(u?"PASSED":"FAILED","test:",i.name,t,"ms")},doh.registerUrl=function(e,i,u){var s=new String(e);this.register(e,{name:i,setUp:function(){doh.currentGroupName=s,doh.currentGroup=this,doh.currentUrl=i,this.d=new doh.Deferred,doh.currentTestDeferred=this.d,doh.showTestPage(),byId("testBody").src=i},timeout:u||1e4,runTest:function(){return this.d},tearDown:function(){doh.currentGroupName=null,doh.currentGroup=null,doh.currentTestDeferred=null,doh.currentUrl=null,doh.showLogPage()}})};var tabzidx=1,_showTab=function(toShow,toHide){var i;for(i=0;toHide.length>i;i++){var node=byId(toHide[i]);node&&(node.style.display="none")}if(toShow=byId(toShow))with(toShow.style)display="",zIndex=++tabzidx};doh.showTestPage=function(){_showTab("testBody",["logBody","perfTestsBody"])},doh.showLogPage=function(){_showTab("logBody",["testBody","perfTestsBody"])},doh.showPerfTestsPage=function(){_showTab("perfTestsBody",["testBody","logBody"])};var runAll=!0;doh.toggleRunAll=function(){if(runAll=!runAll,byId("testList"))for(var e,i=byId("testList").tBodies[0],u=i.getElementsByTagName("input"),s=0;e=u[s++];)e.checked=runAll,doh._groups[e.group].skip=!runAll};var listHeightTimer=null,setListHeight=function(){listHeightTimer&&clearTimeout(listHeightTimer);var e=byId("testList");e&&(listHeightTimer=doh.setTimeout(function(){e.style.display="none",e.style.display=""},10))};_addOnEvt("resize",setListHeight),_addOnEvt("load",setListHeight),_addOnEvt("load",function(){loaded||(loaded=!0,groupTemplate=byId("groupTemplate"),groupTemplate&&(groupTemplate.parentNode.removeChild(groupTemplate),groupTemplate.style.display="",testTemplate=byId("testTemplate"),testTemplate.parentNode.removeChild(testTemplate),testTemplate.style.display="",doh._updateTestList()))}),_addOnEvt("load",function(){var e=doh._onEnd;if(doh._onEnd=function(){e.apply(doh,arguments),0==doh._failureCount?(doh.debug("WOOHOO!!"),_playSound("woohoo")):console.debug("doh._failureCount:",doh._failureCount),byId("play")&&u()},byId("play")){var i=!1,u=function(){i?(byId("play").style.display=byId("pausedMsg").style.display="",byId("playingMsg").style.display=byId("pause").style.display="none",i=!1):(byId("play").style.display=byId("pausedMsg").style.display="none",byId("playingMsg").style.display=byId("pause").style.display="",i=!0)};doh.run=function(e){return function(){return doh._currentGroup||u(),e.apply(doh,arguments)}}(doh.run);for(var s,t=byId("toggleButtons").getElementsByTagName("span"),a=0;s=t[a++];)s.onclick=u;doh._dojoPlotPerfResults=function(e,i,u){var s,t=doh.median(u),a=[];for(s=0;u.length>s;s++)a.push(t);var l={label:"name",items:[{name:i,trials:u},{name:"Median",trials:a}]},n=new dojo.data.ItemFileReadStore({data:l}),r=Math.floor(doh.min(u)),m=Math.ceil(doh.max(u)),o=(m-r)/10;r>0&&(r-=o,0>r&&(r=0),r=Math.floor(r)),m>0&&(m+=o,m=Math.ceil(m)),o=(m-r)/10;var c=new dojox.charting.DataChart(e,{type:dojox.charting.plot2d.Lines,displayRange:u.length,xaxis:{min:1,max:u.length,majorTickStep:Math.ceil((u.length-1)/10),htmlLabels:!1},yaxis:{min:r,max:m,majorTickStep:o,vertical:!0,htmlLabels:!1}});c.setStore(n,{name:"*"},"trials")},doh._asciiPlotPerfResults=function(){}}})}else{_doh=window.parent.doh;var _thisGroup=_doh.currentGroupName,_thisUrl=_doh.currentUrl;if(_thisGroup){doh._testRegistered=function(e,i){_doh._updateTestList(_thisGroup,i)},doh._onEnd=function(){_doh._errorCount+=doh._errorCount,_doh._failureCount+=doh._failureCount,_doh._testCount+=doh._testCount,_doh.currentTestDeferred.callback(!0)};var otr=doh._getTestObj;doh._getTestObj=function(){var e=otr.apply(doh,arguments);return e.name=_thisUrl+"::"+arguments[0]+"::"+e.name,e},doh.debug=doh.hitch(_doh,"debug"),doh.registerUrl=doh.hitch(_doh,"registerUrl"),doh._testStarted=function(e,i){_doh._testStarted(_thisGroup,i)},doh._testFinished=function(e,i,u){if(_doh._testFinished(_thisGroup,i,u),doh.perfTestResults)try{gName=""+e;for(var s=i.name;s.indexOf("::")>=0;)s=s.substring(s.indexOf("::")+2,s.length);_doh.perfTestResults||(_doh.perfTestResults={}),_doh.perfTestResults[gName]||(_doh.perfTestResults[gName]={}),_doh.perfTestResults[gName][i.name]=doh.perfTestResults[gName][s]}catch(t){doh.debug(t)}},doh._groupStarted=function(){this._setParent||(_doh._curTestCount=this._testCount,_doh._curGroupCount=this._groupCount,this._setParent=!0)},doh._report=function(){}}}}();