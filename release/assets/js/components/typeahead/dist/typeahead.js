/*!
 * typeahead.js 0.8.1
 * https://github.com/twitter/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */

define(["jquery"],function(e){(function(){var t="0.8.1",n={isMsie:function(){return/msie [\w.]+/i.test(navigator.userAgent)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isArray:e.isArray,isFunction:e.isFunction,isObject:function(e){return e===Object(e)},isUndefined:function(e){return e===void 0},bind:e.proxy,bindAll:function(t){var r;for(var i in t)n.isFunction(r=t[i])&&(t[i]=e.proxy(r,t))},indexOf:function(e,t){for(var n=0;e.length>n;n++)if(e[n]===t)return n;return-1},each:e.each,map:e.map,filter:function(t,n){var r=[];return e.each(t,function(e,i){n(i,e,t)&&r.push(i)}),r},every:function(t,n){var r=!0;return t?(e.each(t,function(e,i){return(r=n.call(null,i,e,t))?void 0:!1}),!!r):r},mixin:e.extend,getUniqueId:function(){var e=0;return function(){return e++}}(),debounce:function(e,t,n){var r,i;return function(){var o,s,a=this,u=arguments;return o=function(){r=null,n||(i=e.apply(a,u))},s=n&&!r,clearTimeout(r),r=setTimeout(o,t),s&&(i=e.apply(a,u)),i}},throttle:function(e,t){var n,r,i,o,s,a;return s=0,a=function(){s=new Date,i=null,o=e.apply(n,r)},function(){var u=new Date,l=t-(u-s);return n=this,r=arguments,0>=l?(clearTimeout(i),i=null,s=u,o=e.apply(n,r)):i||(i=setTimeout(a,l)),o}},uniqueArray:function(e){for(var t={},n=[],r=0,i=e.length;i>r;++r)t.hasOwnProperty(e[r])||(n.push(e[r]),t[e[r]]=1);return n},tokenizeQuery:function(t){return e.trim(t).toLowerCase().split(/[\s]+/)},tokenizeText:function(t){return e.trim(t).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}},r=function(){var e=/\s+/;return{on:function(t,n){var r;if(!n)return this;for(this._callbacks=this._callbacks||{},t=t.split(e);r=t.shift();)this._callbacks[r]=this._callbacks[r]||[],this._callbacks[r].push(n);return this},trigger:function(t,n){var r,i;if(!this._callbacks)return this;for(t=t.split(e);r=t.shift();)if(i=this._callbacks[r])for(var o=0;i.length>o;o+=1)i[o].call(this,{type:r,data:n});return this}}}(),i=function(){function e(e){this.prefix=["__",e,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=RegExp("^"+this.prefix)}function t(){return(new Date).getTime()}function r(e){return JSON.stringify(n.isUndefined(e)?null:e)}function i(e){return JSON.parse(e)}var o,s=window.localStorage;return o=window.localStorage&&window.JSON?{_prefix:function(e){return this.prefix+e},_ttlKey:function(e){return this._prefix(e)+this.ttlKey},get:function(e){return this.isExpired(e)&&this.remove(e),i(s.getItem(this._prefix(e)))},set:function(e,i,o){return n.isNumber(o)?s.setItem(this._ttlKey(e),r(t()+o)):s.removeItem(this._ttlKey(e)),s.setItem(this._prefix(e),r(i))},remove:function(e){return s.removeItem(this._ttlKey(e)),s.removeItem(this._prefix(e)),this},clear:function(){var e,t,n=[],r=s.length;for(e=0;r>e;e++)(t=s.key(e)).match(this.keyMatcher)&&n.push(t.replace(this.keyMatcher,""));for(e=n.length;e--;)this.remove(n[e]);return this},isExpired:function(e){var r=i(s.getItem(this._ttlKey(e)));return n.isNumber(r)&&t()>r?!0:!1}}:{get:n.noop,set:n.noop,remove:n.noop,clear:n.noop,isExpired:n.noop},n.mixin(e.prototype,o),e}(),o=function(){function e(e){n.bindAll(this),e=e||{},this.sizeLimit=e.sizeLimit||10,this.cache={},this.cachedKeysByAge=[]}return n.mixin(e.prototype,{get:function(e){return this.cache[e]},set:function(e,t){var n;this.cachedKeysByAge.length===this.sizeLimit&&(n=this.cachedKeysByAge.shift(),delete this.cache[n]),this.cache[e]=t,this.cachedKeysByAge.push(e)}}),e}(),s=function(){function t(e){var t;n.bindAll(this),e=e||{},t=/^throttle$/i.test(e.rateLimitFn)?n.throttle:n.debounce,this.wait=e.wait||300,this.wildcard=e.wildcard||"%QUERY",this.maxConcurrentRequests=e.maxConcurrentRequests||6,this.concurrentRequests=0,this.onDeckRequestArgs=null,this.cache=new o,this.get=t(this.get,this.wait)}return n.mixin(t.prototype,{_incrementConcurrentRequests:function(){this.concurrentRequests++},_decrementConcurrentRequests:function(){this.concurrentRequests--},_belowConcurrentRequestsThreshold:function(){return this.concurrentRequests<this.maxConcurrentRequests},get:function(t,n,r){var i,o=this;t=t.replace(this.wildcard,encodeURIComponent(n||"")),(i=this.cache.get(t))?r&&r(i):this._belowConcurrentRequestsThreshold()?e.ajax({url:t,type:"GET",dataType:"json",beforeSend:function(){o._incrementConcurrentRequests()},success:function(e){r&&r(e),o.cache.set(t,e)},complete:function(){o._decrementConcurrentRequests(),o.onDeckRequestArgs&&(o.get.apply(o,o.onDeckRequestArgs),o.onDeckRequestArgs=null)}}):this.onDeckRequestArgs=[].slice.call(arguments,0)}}),t}(),a=function(){function r(e){n.bindAll(this),this.storage=new i(e.name),this.adjacencyList={},this.itemHash={},this.name=e.name,this.resetDataOnProtocolSwitch=e.resetDataOnProtocolSwitch||!1,this.queryUrl=e.remote,this.transport=e.transport,this.limit=e.limit||10,this._customMatcher=e.matcher||null,this._customRanker=e.ranker||null,this._ttl_ms=e.ttl_ms||2592e5,this.keys={version:"version",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList"},e.local&&this._processLocalData(e.local),e.prefetch&&this._loadPrefetchData(e.prefetch)}return n.mixin(r.prototype,{_processLocalData:function(e){e&&this._mergeProcessedData(this._processData(e))},_loadPrefetchData:function(r){function i(e){var r=o._processData(e),i=r.itemHash,s=r.adjacencyList;o.storage.set(o.keys.itemHash,i,o._ttl_ms),o.storage.set(o.keys.adjacencyList,s,o._ttl_ms),o.storage.set(o.keys.version,t,o._ttl_ms),o.storage.set(o.keys.protocol,n.getProtocol(),o._ttl_ms),o._mergeProcessedData(r)}var o=this,s=this.storage.get(this.keys.itemHash),a=this.storage.get(this.keys.adjacencyList),u=this.storage.get(this.keys.protocol),l=this.storage.get(this.keys.version),c=l!==t||u!==n.getProtocol();s&&a&&!c?this._mergeProcessedData({itemHash:s,adjacencyList:a}):e.getJSON(r).done(i)},_processData:function(e){var t={},r={};return n.each(e,function(e,i){var o;n.isString(i)&&(i={value:i,tokens:n.tokenizeText(i)}),i.tokens=n.map(i.tokens||[],function(e){return e.toLowerCase()}),t[o=n.getUniqueId(i.value)]=i,n.each(i.tokens,function(e,t){var i=t.charAt(0),s=r[i]||(r[i]=[o]);!~n.indexOf(s,o)&&s.push(o)})}),{itemHash:t,adjacencyList:r}},_mergeProcessedData:function(e){var t=this;n.mixin(this.itemHash,e.itemHash),n.each(e.adjacencyList,function(e,n){var r=t.adjacencyList[e];t.adjacencyList[e]=r?r.concat(n):n})},_getPotentiallyMatchingIds:function(t){var r=[],i=[];if(n.map(t,n.bind(function(e){var t=this.adjacencyList[e.charAt(0)];t&&i.push(t)},this)),1===i.length)return i[0];var o=[];e.each(i,function(e,t){o.push(t.length)});var s=n.indexOf(o,Math.min.apply(null,o))||0,a=i[s]||[];return r=n.map(a,function(e){var t=n.every(i,function(t){return n.indexOf(t,e)>-1});return t?e:void 0})},_getItemsFromIds:function(e){var t=[];return n.map(e,n.bind(function(e){var n=this.itemHash[e];n&&t.push(n)},this)),t},_matcher:function(e){if(this._customMatcher){var t=this._customMatcher;return function(e){return t(e)}}return function(t){var r=t.tokens,i=n.every(e,function(e){var t=n.filter(r,function(t){return 0===t.indexOf(e)});return t.length});return i?t:void 0}},_compareItems:function(e,t,n){var r=e.score_boost?e.score_boost:0,i=t.score_boost?t.score_boost:0,o=e.score?e.score:0,s=t.score?t.score:0;return n?t.weight+i-(e.weight+r):s+i-(o+r)},_ranker:function(e,t){if(this._customRanker)return this._customRanker(e,t);var n=e.weight&&0!==e.weight,r=t.weight&&0!==t.weight;return n&&!r?-1:r&&!n?1:n&&r?this._compareItems(e,t,!0):this._compareItems(e,t,!1)},_processRemoteSuggestions:function(e,t){var r=this;return function(i){n.each(i,function(e,i){var o=!1;return i=n.isString(i)?{value:i}:i,n.each(t,function(e,t){return i.value===t.value?(o=!0,!1):void 0}),!o&&t.push(i),t.length<r.limit}),e&&e(t)}},getSuggestions:function(e,t){var r=n.tokenizeQuery(e),i=this._getPotentiallyMatchingIds(r),o=this._getItemsFromIds(i),s=n.filter(o,this._matcher(r));s.sort(this._ranker),t&&t(s),s.length<this.limit&&this.queryUrl&&this.transport.get(this.queryUrl,e,this._processRemoteSuggestions(t,s))}}),r}(),u=function(){function t(t){var r=this;n.bindAll(this),this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},this.query="",this.$hint=e(t.hint),this.$input=e(t.input).on("blur",this._handleBlur).on("focus",this._handleFocus).on("keydown",this._handleSpecialKeyEvent),n.isMsie()?this.$input.on("keydown keypress cut paste",function(e){r.specialKeyCodeMap[e.which||e.keyCode]||setTimeout(r._compareQueryToInputValue,0)}):this.$input.on("input",this._compareQueryToInputValue),this.$overflowHelper=i(this.$input)}function i(t){return e("<span></span>").css({display:"none",position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:t.css("font-family"),fontSize:t.css("font-size"),fontStyle:t.css("font-style"),fontVariant:t.css("font-variant"),fontWeight:t.css("font-weight"),wordSpacing:t.css("word-spacing"),letterSpacing:t.css("letter-spacing"),textIndent:t.css("text-indent"),textRendering:t.css("text-rendering"),textTransform:t.css("text-transform")}).insertAfter(t)}function o(e,t){return e=(e||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),t=(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),e===t}return n.mixin(t.prototype,r,{_handleFocus:function(){this.trigger("focus")},_handleBlur:function(){this.trigger("blur")},_handleSpecialKeyEvent:function(e){var t=this.specialKeyCodeMap[e.which||e.keyCode];t&&this.trigger(t,e)},_compareQueryToInputValue:function(){var e=this.getInputValue(),t=o(this.query,e),n=t?this.query.length!==e.length:!1;n?this.trigger("whitespaceChange",{value:this.query}):t||this.trigger("queryChange",{value:this.query=e})},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},getInputValue:function(){return this.$input.val()},setInputValue:function(e,t){this.$input.val(e),t!==!0&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(e){this.$hint.val(e)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var e,t=this.$input.val().length,r=this.$input[0].selectionStart;return n.isNumber(r)?r===t:document.selection?(e=document.selection.createRange(),e.moveStart("character",-t),t===e.text.length):!0}}),t}(),l=function(){function t(t){n.bindAll(this),this.isMouseOverDropdown,this.$menu=e(t.menu).on("mouseenter",this._handleMouseenter).on("mouseleave",this._handleMouseleave).on("mouseover",".tt-suggestions > .tt-suggestion",this._handleMouseover).on("click",".tt-suggestions > .tt-suggestion",this._handleSelection)}function i(e){var t=e.parents(".tt-suggestions").first();return{value:e.data("value"),query:t.data("query"),dataset:t.data("dataset"),data:t.data("suggestions")}}return n.mixin(t.prototype,r,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(t){this._getSuggestions().removeClass("tt-is-under-cursor"),e(t.currentTarget).addClass("tt-is-under-cursor")},_handleSelection:function(t){this.trigger("select",i(e(t.currentTarget)))},_moveCursor:function(e){var t,n,r,i;if(this.$menu.hasClass("tt-is-open")){if(t=this._getSuggestions(),n=t.filter(".tt-is-under-cursor"),n.removeClass("tt-is-under-cursor"),r=t.index(n)+e,r=(r+1)%(t.length+1)-1,-1===r)return this.trigger("cursorOff"),void 0;-1>r&&(r=t.length-1),i=t.eq(r).addClass("tt-is-under-cursor"),this.trigger("cursorOn",{value:i.data("value")})}},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},hideUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.hide()},hide:function(){this.$menu.hasClass("tt-is-open")&&(this.$menu.removeClass("tt-is-open").find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor"),this.trigger("hide"))},show:function(){this.$menu.hasClass("tt-is-open")||(this.$menu.addClass("tt-is-open"),this.trigger("show"))},isOpen:function(){return this.$menu.hasClass("tt-is-open")},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var e=this._getSuggestions().filter(".tt-is-under-cursor").first();return e.length>0?i(e):null},getFirstSuggestion:function(){var e=this._getSuggestions().first();return e.length>0?i(e):null},renderSuggestions:function(t,r,i){var o,s,a,u="tt-dataset-"+r.name,l=this.$menu.find("."+u);0===l.length&&(l=e('<li><ol class="tt-suggestions"></ol></li>').addClass(u).appendTo(this.$menu)),o=document.createElement("div"),s=document.createDocumentFragment(),this.clearSuggestions(r.name),i.length>0&&(this.$menu.removeClass("tt-is-empty"),n.each(i,function(e,t){o.innerHTML=r.template.render(t),a=o.firstChild,a.setAttribute("data-value",t.value),s.appendChild(a)})),l.find("> .tt-suggestions").data({query:t,dataset:r.name,suggestions:i}).append(s),this.trigger("suggestionsRender")},clearSuggestions:function(e){var t=e?this.$menu.find(".tt-dataset-"+e+" .tt-suggestions"):this.$menu.find(".tt-suggestions");t.empty(),0===this._getSuggestions().length&&this.$menu.addClass("tt-is-empty")}}),t}(),c=function(){function t(e){n.bindAll(this),this.$node=i(e.input),this.datasets=e.datasets,n.each(this.datasets,function(e,t){var n='<li class="tt-suggestion">%body</li>';t.template=t.template?t.engine.compile(n.replace("%body",t.template)):{render:function(e){return n.replace("%body","<p>"+e.value+"</p>")}}}),this.inputView=new u({input:this.$node.find(".tt-query"),hint:this.$node.find(".tt-hint")}),this.dropdownView=new l({menu:this.$node.find(".tt-dropdown-menu")}),this.dropdownView.on("select",this._handleSelection).on("cursorOn",this._clearHint).on("cursorOn",this._setInputValueToSuggestionUnderCursor).on("cursorOff",this._setInputValueToQuery).on("cursorOff",this._updateHint).on("suggestionsRender",this._updateHint).on("show",this._updateHint).on("hide",this._clearHint),this.inputView.on("focus",this._showDropdown).on("blur",this._hideDropdown).on("blur",this._setInputValueToQuery).on("enter",this._handleSelection).on("queryChange",this._clearHint).on("queryChange",this._clearSuggestions).on("queryChange",this._getSuggestions).on("whitespaceChange",this._updateHint).on("queryChange whitespaceChange",this._showDropdown).on("queryChange whitespaceChange",this._setLanguageDirection).on("esc",this._hideDropdown).on("esc",this._setInputValueToQuery).on("tab up down",this._managePreventDefault).on("up down",this._moveDropdownCursor).on("up down",this._showDropdown).on("tab left right",this._autocomplete)}function i(t){var n=e(t),r=e(o.hint).css({"background-color":n.css("background-color")});if(0===n.length)return null;try{!n.attr("dir")&&n.attr("dir","auto")}catch(i){}return n.attr({autocomplete:"off",spellcheck:!1}).addClass("tt-query").wrap(o.wrapper).parent().prepend(r).append(o.dropdown)}var o={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input style="display:none;">',dropdown:'<ol class="tt-dropdown-menu tt-is-empty"></ol>'};return n.mixin(t.prototype,r,{_managePreventDefault:function(e){var t,n,r=e.data,i=!1;switch(e.type){case"tab":t=this.inputView.getHintValue(),n=this.inputView.getInputValue(),i=t&&t!==n;break;case"up":case"down":i=!r.shiftKey&&!r.ctrlKey&&!r.metaKey}i&&r.preventDefault()},_setLanguageDirection:function(){var e="tt-"+this.inputView.getLanguageDirection();this.$node.hasClass(e)||this.$node.removeClass("tt-ltr tt-rtl").addClass(e)},_updateHint:function(){var e,t,n,r,i=this.dropdownView.getFirstSuggestion(),o=i?i.value:null;o&&this.dropdownView.isOpen()&&!this.inputView.isOverflow()&&(e=this.inputView.getInputValue(),t=e.replace(/\s{2,}/g," ").replace(/^\s+/g,""),n=RegExp("^(?:"+t+")(.*$)","i"),r=n.exec(o),this.inputView.setHintValue(e+(r?r[1]:"")))},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(e){var t=e.data;this.inputView.setInputValue(t.value,!0)},_showDropdown:function(){this.dropdownView.show()},_hideDropdown:function(e){this.dropdownView["blur"===e.type?"hideUnlessMouseIsOverDropdown":"hide"]()},_moveDropdownCursor:function(e){var t=e.data;t.shiftKey||t.ctrlKey||t.metaKey||this.dropdownView["up"===e.type?"moveCursorUp":"moveCursorDown"]()},_handleSelection:function(e){var t="select"===e.type,r=t?e.data:this.dropdownView.getSuggestionUnderCursor();if(r){this.inputView.setInputValue(r.value),t?this.inputView.focus():e.data.preventDefault(),t&&n.isMsie()?setTimeout(this.dropdownView.hide,0):this.dropdownView.hide();var i=CustomEvent(r.data[0].callback.type,{detail:{returnData:r}});document.getElementById(r.data[0].callback.target).dispatchEvent(i)}},_getSuggestions:function(){var e=this,t=this.inputView.getQuery();n.each(this.datasets,function(n,r){r.getSuggestions(t,function(n){e._renderSuggestions(t,r,n)})})},_renderSuggestions:function(e,t,n){e===this.inputView.getQuery()&&(n=n.slice(0,t.limit),this.dropdownView.renderSuggestions(e,t,n))},_autocomplete:function(e){var t,n,r,i;("right"!==e.type&&"left"!==e.type||(t=this.inputView.isCursorAtEnd(),n="ltr"===this.inputView.getLanguageDirection()?"left"===e.type:"right"===e.type,t&&!n))&&(r=this.inputView.getQuery(),i=this.inputView.getHintValue(),""!==i&&r!==i&&this.inputView.setInputValue(i))}}),t}();(function(){function t(e){return o[e]?o[e].apply(this,[].slice.call(arguments,1)):o.initialize.apply(this,arguments)}function r(e){l=e}var i,o,u={},l={};jQuery.fn.typeahead=t,t.configureTransport=r,o={initialize:function(r){var o={};if(r=n.isArray(r)?r:[r],0===r.length)throw Error("no datasets provided");return delete t.configureTransport,i=i||new s(l),n.each(r,function(e,t){var r,s=t.name=t.name||n.getUniqueId();if(u[s])r=u[s];else{if(t.limit=t.limit||5,t.template=t.template,t.engine=t.engine,t.template&&!t.engine)throw Error("no template engine specified for "+s);r=u[s]=new a({name:t.name,limit:t.limit,local:t.local,prefetch:t.prefetch,ttl_ms:t.ttl_ms,remote:t.remote,matcher:t.matcher,ranker:t.ranker,transport:i})}o[s]={name:t.name,limit:t.limit,template:t.template,engine:t.engine,getSuggestions:r.getSuggestions}}),this.each(function(){e(this).data({typeahead:new c({input:this,datasets:o})})})}}})()})()});