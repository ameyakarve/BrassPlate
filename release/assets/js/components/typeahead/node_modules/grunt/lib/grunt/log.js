/*
 * grunt
 * http://gruntjs.com/
 *
 * Copyright (c) 2012 "Cowboy" Ben Alman
 * Licensed under the MIT license.
 * https://github.com/gruntjs/grunt/blob/master/LICENSE-MIT
 */

function markup(e){return e=e||"",e=e.replace(/(\s|^)_(\S|\S[\s\S]+?\S)_(?=[\s,.!?]|$)/g,"$1"+"$2".underline),e=e.replace(/(\s|^)\*(\S|\S[\s\S]+?\S)\*(?=[\s,.!?]|$)/g,"$1"+"$2".bold)}var grunt=require("../grunt"),util=require("util"),log=module.exports={},colors=require("colors");log.initColors=function(){var e=grunt.util;grunt.option("no-color")&&(colors.mode="none",e.hooker.hook(console,"log",function(){var t=e.toArray(arguments);return e.hooker.filter(this,t.map(function(t){return"string"===e.kindOf(t)?colors.stripColors(t):t}))}))};var suppressOutput;log.muted=!1;var hasLogged;log.write=function(e){return log.muted||suppressOutput||(hasLogged=!0,grunt.option("no-color")&&(e=colors.stripColors(e)),process.stdout.write(markup(e))),this},log.writeln=function(e){return this.write((e||"")+"\n"),this},log.warn=function(e){return e?this.writeln(">> ".red+grunt.util._.trim(e).replace(/\n/g,"\n>> ".red)):this.writeln("ERROR".red)},log.error=function(e){return e?(grunt.fail.errorcount++,this.writeln(">> ".red+grunt.util._.trim(e).replace(/\n/g,"\n>> ".red))):this.writeln("ERROR".red)},log.ok=function(e){return e?this.writeln(">> ".green+grunt.util._.trim(e).replace(/\n/g,"\n>> ".green)):this.writeln("OK".green)},log.errorlns=function(e){return this.error(log.wraptext(77,e))},log.oklns=function(e){return this.ok(log.wraptext(77,e))},log.success=function(e){return this.writeln(e.green)},log.fail=function(e){return this.writeln(e.red)},log.header=function(e){return hasLogged&&this.writeln(),this.writeln(e.underline)},log.subhead=function(e){return hasLogged&&this.writeln(),this.writeln(e.bold)},log.debug=function(){return grunt.option("debug")&&this.writeln(("[D] "+util.format.apply(this,arguments)).magenta),this},log.writetableln=function(e,t){return this.writeln(this.table(e,t))},log.writelns=function(e){return this.writeln(this.wraptext(80,e))},log.writeflags=function(e,t){var n;return Array.isArray(e)?n=log.wordlist(e):"object"==typeof e&&e&&(n=log.wordlist(Object.keys(e).map(function(t){var n=e[t];return t+(n===!0?"":"="+JSON.stringify(n))}))),this.writeln((t||"Flags")+": "+(n||"(none)".cyan))},log.verbose={},log.notverbose={},Object.keys(log).filter(function(e){return"function"==typeof log[e]}).forEach(function(e){log.verbose[e]=function(){return suppressOutput=!grunt.option("verbose"),log[e].apply(this,arguments),suppressOutput=!1,this},log.notverbose[e]=function(){return suppressOutput=grunt.option("verbose"),log[e].apply(this,arguments),suppressOutput=!1,this}}),log.verbose.or=log.notverbose,log.notverbose.or=log.verbose,log.wordlist=function(e,t){return t=grunt.util._.defaults(t||{},{separator:", ",color:"cyan"}),e.map(function(e){return t.color?(e+"")[t.color]:e}).join(t.separator)},log.uncolor=function(e){return e.replace(/\x1B\[\d+m/g,"")},log.wraptext=function(e,t){for(var n,r,i,o=[],a=[],s=0;n=t.match(/(?:(\x1B\[\d+m)|\n|(.))([\s\S]*)/);)if(t=n[3],n[1])r=n[1],a.push(n[1]);else{if(n[2]){if(0===s&&r&&a.push(r),a.push(n[2]),s++,e>=s||" "===n[2])continue;i=a.lastIndexOf(" "),t=a.slice(-1===i?i:i+1).join("")+t,a=a.slice(0,i)}o.push(a.join("")),a=[],s=0}return o.push(a.join("")),o.join("\n")},log.table=function(e,t){var n=[];e.forEach(function(e,r){var i=log.wraptext(e,t[r]).split("\n");i.forEach(function(e,t){var i=n[t];i||(i=n[t]=[]),i[r]=e})});var r=[];return n.forEach(function(t){for(var n,i="",o=0;t.length>o;o++){n=t[o]||"",i+=n;var a=e[o]-log.uncolor(n).length;a>0&&(i+=grunt.util.repeat(a," "))}r.push(i)}),r.join("\n")};