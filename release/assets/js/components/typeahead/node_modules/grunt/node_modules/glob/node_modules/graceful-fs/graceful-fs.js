function OpenReq(e,t,n,r){this.path=e,this.flags=t,this.mode=n,this.cb=r}function noop(){}function gracefulOpen(e,t,n,r){return"function"==typeof n&&(r=n,n=null),"function"!=typeof r&&(r=noop),fs._curOpen>=fs.MAX_OPEN?(queue.push(new OpenReq(e,t,n,r)),setTimeout(flush),void 0):(open(e,t,n,function(i,o){return i&&"EMFILE"===i.code&&fs._curOpen>fs.MIN_MAX_OPEN?(fs.MAX_OPEN=fs._curOpen-1,fs.open(e,t,n,r)):(r(i,o),void 0)}),void 0)}function open(e,t,n,r){r=r||noop,fs._curOpen++,originalOpen.call(fs,e,t,n,function(e,t){e&&onclose(),r(e,t)})}function onclose(){fs._curOpen--,flush()}function flush(){for(;fs._curOpen<fs.MAX_OPEN;){var e=queue.shift();if(!e)return;open(e.path,e.flags||"r",e.mode||511,e.cb)}}function chownFix(e){return e?function(t,n,r,i){return e.call(fs,t,n,r,function(e,t){chownErOk(e)&&(e=null),i(e,t)})}:e}function chownFixSync(e){return e?function(t,n,r){try{return e.call(fs,t,n,r)}catch(i){if(!chownErOk(i))throw i}}:e}function chownErOk(e){return e&&(process.getuid&&0===process.getuid()||"EINVAL"!==e.code&&"EPERM"!==e.code)?void 0:!0}var fs_=require("fs"),fs=module.exports={};Object.getOwnPropertyNames(fs_).forEach(function(e){var t=Object.getOwnPropertyDescriptor(fs_,e);Object.defineProperty(fs,e,t)});var queue=[],constants=require("constants");exports=module.exports=fs,fs._curOpen=0,fs.MIN_MAX_OPEN=64,fs.MAX_OPEN=1024;var originalOpen=fs.open,originalOpenSync=fs.openSync,originalClose=fs.close,originalCloseSync=fs.closeSync;fs.open=gracefulOpen,fs.openSync=function(e,t,n){var r;return r=originalOpenSync.call(fs,e,t,n),fs._curOpen++,r},fs.close=function(e,t){t=t||noop,originalClose.call(fs,e,function(e){onclose(),t(e)})},fs.closeSync=function(e){return onclose(),originalCloseSync.call(fs,e)};var constants=require("constants");if(constants.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&(fs.lchmod=function(e,t,n){n=n||noop,fs.open(e,constants.O_WRONLY|constants.O_SYMLINK,t,function(e,r){return e?(n(e),void 0):(fs.fchmod(r,t,function(e){fs.close(r,function(t){n(e||t)})}),void 0)})},fs.lchmodSync=function(e,t){var n,r,i=fs.openSync(e,constants.O_WRONLY|constants.O_SYMLINK,t);try{var o=fs.fchmodSync(i,t)}catch(a){n=a}try{fs.closeSync(i)}catch(a){r=a}if(n||r)throw n||r;return o}),fs.lutimes||(constants.hasOwnProperty("O_SYMLINK")?(fs.lutimes=function(e,t,n,r){fs.open(e,constants.O_SYMLINK,function(e,i){return r=r||noop,e?r(e):(fs.futimes(i,t,n,function(e){fs.close(i,function(t){return r(e||t)})}),void 0)})},fs.lutimesSync=function(e,t,n){var r,i,o,a=fs.openSync(e,constants.O_SYMLINK);try{var o=fs.futimesSync(a,t,n)}catch(s){r=s}try{fs.closeSync(a)}catch(s){i=s}if(r||i)throw r||i;return o}):fs.utimensat&&constants.hasOwnProperty("AT_SYMLINK_NOFOLLOW")?(fs.lutimes=function(e,t,n,r){fs.utimensat(e,t,n,constants.AT_SYMLINK_NOFOLLOW,r)},fs.lutimesSync=function(e,t,n){return fs.utimensatSync(e,t,n,constants.AT_SYMLINK_NOFOLLOW)}):(fs.lutimes=function(e,t,n,r){process.nextTick(r)},fs.lutimesSync=function(){})),fs.chown=chownFix(fs.chown),fs.fchown=chownFix(fs.fchown),fs.lchown=chownFix(fs.lchown),fs.chownSync=chownFixSync(fs.chownSync),fs.fchownSync=chownFixSync(fs.fchownSync),fs.lchownSync=chownFixSync(fs.lchownSync),fs.lchmod||(fs.lchmod=function(e,t,n){process.nextTick(n)},fs.lchmodSync=function(){}),fs.lchown||(fs.lchown=function(e,t,n,r){process.nextTick(r)},fs.lchownSync=function(){}),"win32"===process.platform){var rename_=fs.rename;fs.rename=function(e,t,n){var r=Date.now();rename_(e,t,function i(o){return o&&("EACCES"===o.code||"EPERM"===o.code)&&1e3>Date.now()-r?rename_(e,t,i):(n(o),void 0)})}}var read=fs.read;fs.read=function(e,t,n,r,i,o){var a;if(o&&"function"==typeof o){var s=0;a=function(u){return u&&"EAGAIN"===u.code&&10>s?(s++,read.call(fs,e,t,n,r,i,a)):(o.apply(this,arguments),void 0)}}return read.call(fs,e,t,n,r,i,a)};var readSync=fs.readSync;fs.readSync=function(e,t,n,r,i){for(var o=0;;)try{return readSync.call(fs,e,t,n,r,i)}catch(a){if("EAGAIN"===a.code&&10>o){o++;continue}throw a}};