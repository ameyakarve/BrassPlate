function TarHeader(e){return this instanceof TarHeader?(e&&this.decode(e),void 0):new TarHeader(e)}function encode(e){if(!(e||this instanceof TarHeader))throw Error("encode must be called on a TarHeader, or supplied an object");e=e||this;var t=e.block=new Buffer(512);e.prefix&&(e.path=e.prefix+"/"+e.path,e.prefix=""),e.needExtended=!1,e.mode&&("string"==typeof e.mode&&(e.mode=parseInt(e.mode,8)),e.mode=511&e.mode);for(var n=0;null!==fields[n];n++){var r,i=fields[n],o=fieldOffs[n],a=fieldEnds[n];switch(i){case"cksum":break;case"prefix":break;case"type":var s=e.type||"0";s.length>1&&(s=tar.types[e.type],s||(s="0")),writeText(t,o,a,s);break;case"path":var u=Buffer.byteLength(e.path),l=fieldSize[fields.path],c=fieldSize[fields.prefix];if(u>l&&l+c>=u){for(var f=u-1-l,d=c,p=!1,h=new Buffer(e.path),m=f;d>=m;m++)if(h[m]===slash||h[m]===bslash){p=m;break}if(p!==!1){prefix=h.slice(0,p).toString("utf8"),path=h.slice(p+1).toString("utf8"),r=writeText(t,o,a,path),o=fieldOffs[fields.prefix],a=fieldEnds[fields.prefix],r=writeText(t,o,a,prefix)||r;break}}var g=fieldOffs[fields.prefix],v=fieldEnds[fields.prefix];writeText(t,g,v,"");default:r=numeric[i]?writeNumeric(t,o,a,e[i]):writeText(t,o,a,e[i]||"")}e.needExtended=e.needExtended||r}var o=fieldOffs[fields.cksum],a=fieldEnds[fields.cksum];return writeNumeric(t,o,a,calcSum.call(this,t)),t}function writeNumeric(e,t,n,r){var i=n-t,o=MAXNUM[i]||0;if(r=r||0,(r instanceof Date||"[object Date]"===Object.prototype.toString.call(r))&&(r=r.getTime()/1e3),r>o||0>r)return write256(e,t,n,r),!0;var a=Math.floor(r).toString(8);if(MAXNUM[i-1]>r&&(a+=" "),i>a.length&&(a=Array(i-a.length).join("0")+a),a.length!==i-1)throw Error("invalid length: "+JSON.stringify(a)+"\n"+"expected: "+i);e.write(a,t,i,"utf8"),e[n-1]=0}function write256(e,t,n,r){var i=e.slice(t,n),o=r>=0;i[0]=o?128:255,o||(r*=-1);var a=[];do{var s=r%256;a.push(s),r=(r-s)/256}while(r);for(var u=a.length,l=i.length-u,c=1;l>c;c++)i[c]=o?0:255;var f=!0;for(c=u;c>0;c--){var d=a[u-c];o?i[l+c]=d:f&&0===d?i[l+c]=0:f?(f=!1,i[l+c]=256-d):i[l+c]=255-d}}function writeText(e,t,n,r){var i=Buffer.byteLength(r),o=Math.min(i,n-t),a=i!==r.length||i>o;o>0&&e.write(r,t,o,"utf8");for(var s=t+o;n>s;s++)e[s]=0;return a}function calcSum(e){if(e=e||this.block,assert(Buffer.isBuffer(e)&&512===e.length),!e)throw Error("Need block to checksum");for(var t=0,n=fieldOffs[fields.cksum],r=fieldEnds[fields.cksum],i=0;fieldOffs[fields.cksum]>i;i++)t+=e[i];for(var i=n;r>i;i++)t+=space;for(var i=r;512>i;i++)t+=e[i];return t}function checkSum(e){var t=calcSum.call(this,e);e=e||this.block;var n=e.slice(fieldOffs[fields.cksum],fieldEnds[fields.cksum]);return n=parseNumeric(n),n===t}function decode(e){e=e||this.block,assert(Buffer.isBuffer(e)&&512===e.length),this.block=e,this.cksumValid=this.checkSum();for(var t=null,n=0;null!==fields[n];n++){var r=fields[n],i=e.slice(fieldOffs[n],fieldEnds[n]);switch(r){case"ustar":if("ustar\0"!=""+i)return this.ustar=!1,void 0;this.ustar=""+i;break;case"prefix":var o=parseNumeric(i.slice(131,143)),a=parseNumeric(i.slice(143,155));0!==i[130]&&i[130]!==space||"number"!=typeof o||"number"!=typeof a||i[143]!==space||i[155]!==space||(this.atime=o,this.ctime=a,i=i.slice(0,130)),t=i.toString("utf8").replace(/\0+$/,"");break;default:this[r]=numeric[r]?parseNumeric(i):i.toString("utf8").replace(/\0+$/,"")}}t&&(this.path=t+"/"+this.path)}function parse256(e){var t;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}for(var n=!1,r=[],i=e.length-1;i>0;i--){var o=e[i];t?r.push(o):n&&0===o?r.push(0):n?(n=!1,r.push(256-o)):r.push(255-o)}for(var a=0,i=0,s=r.length;s>i;i++)a+=r[i]*Math.pow(256,i);return t?a:-1*a}function parseNumeric(e){if(128&e[0])return parse256(e);var t=e.toString("utf8").split("\0")[0].trim(),n=parseInt(t,8);return isNaN(n)?null:n}module.exports=TarHeader;var tar=require("../tar.js"),fields=tar.fields,fieldOffs=tar.fieldOffs,fieldEnds=tar.fieldEnds,fieldSize=tar.fieldSize,numeric=tar.numeric,assert=require("assert").ok,space=" ".charCodeAt(0),slash="/".charCodeAt(0),bslash="win32"===process.platform?"\\".charCodeAt(0):null;TarHeader.prototype={decode:decode,encode:encode,calcSum:calcSum,checkSum:checkSum},TarHeader.parseNumeric=parseNumeric,TarHeader.encode=encode,TarHeader.decode=decode;var MAXNUM={12:8589934591,11:1073741823,8:2097151,7:262143};