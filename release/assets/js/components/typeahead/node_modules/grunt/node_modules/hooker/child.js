function sendMessage(e){process.stdout.write(JSON.stringify(e)+"\n")}var path=require("path"),fs=require("fs"),nodeunit=require("nodeunit"),filepaths=fs.readdirSync("test").map(function(e){return path.join("test",e)}),unfinished={},currentModule;process.on("uncaughtException",function(e){sendMessage({error:[e.name,e.message,e.stack]}),process.exit()});var unfinished={};process.on("exit",function(){var e=Object.keys(unfinished).length;e>0?sendMessage({exit:["UNFINISHED"]}):sendMessage({exit:["finished"]})}),nodeunit.reporters.test={run:function(e){var t=e.map(function(e){return path.resolve(e)});nodeunit.runFiles(t,{testspec:void 0,moduleStart:function(e){currentModule=e,sendMessage({moduleStart:[""+e]})},moduleDone:function(e){e===currentModule&&sendMessage({moduleDone:[""+e]})},testStart:function(e){unfinished[e]=e,sendMessage({testStart:[""+e]})},testDone:function(e,t){delete unfinished[e],sendMessage({testDone:[""+e,t.failures(),t.map(function(e){var t=e.error;return t&&(e.error={name:t.name,message:t.message,stack:t.stack}),e})]})},done:function(e){sendMessage({done:[e.failures(),e.duration,e]})}})}},nodeunit.reporters.test.run(filepaths,{});