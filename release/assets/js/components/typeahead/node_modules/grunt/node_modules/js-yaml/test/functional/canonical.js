function CanonicalError(){_errors.YAMLError.apply(this,arguments),this.name="CanonicalError"}function CanonicalScanner(e){this.data=e+"\0",this.index=0,this.tokens=[],this.scanned=!1}var fs=require("fs"),assert=require("assert"),jsyaml=require(__dirname+"/../../lib/js-yaml"),helper=require(__dirname+"/../test-helper"),$$=require(__dirname+"/../../lib/js-yaml/common"),_errors=require(__dirname+"/../../lib/js-yaml/errors"),_composer=require(__dirname+"/../../lib/js-yaml/composer"),_constructor=require(__dirname+"/../../lib/js-yaml/construct"),_tokens=require(__dirname+"/../../lib/js-yaml/tokens"),_resolver=require(__dirname+"/../../lib/js-yaml/resolver"),DIRECTIVE="%YAML 1.1",QUOTE_CODES={x:2,u:4,U:8},QUOTE_REPLACES={"\\":"\\",'"':'"'," ":" ",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"	",v:"",N:"Â…",L:"\u2028",P:"\u2029",_:"_",0:"\0"};$$.inherits(CanonicalError,_errors.YAMLError),CanonicalScanner.prototype.checkToken=function(){var e;if(this.scanned||this.scan(),this.tokens.length){if(!arguments.length)return!0;for(e=0;arguments.length>e;e+=1)if(this.tokens[0].isA(arguments[e]))return!0}return!1},CanonicalScanner.prototype.peekToken=function(){return this.scanned||this.scan(),this.tokens.length?this.tokens[0]:null},CanonicalScanner.prototype.getToken=function(e){var t=null;if(this.scanned||this.scan(),t=this.tokens.shift(),e&&!t.isA(e))throw new CanonicalError("unexpected token "+t.hash());return t},CanonicalScanner.prototype.scan=function(){var e;for(this.tokens.push(new _tokens.StreamStartToken(null,null));;){if(this.find_token(),e=this.data[this.index],"\0"===e){this.tokens.push(new _tokens.StreamEndToken(null,null));break}if("%"===e)this.tokens.push(this.scanDirective());else if("-"===e&&"---"===this.data.silce(this.index,this.index+3))this.index+=3,this.tokens.push(new _tokens.DocumentStartToken(null,null));else if("["===e)this.index+=1,this.tokens.push(new _tokens.FlowSequenceStartToken(null,null));else if("{"===e)this.index+=1,this.tokens.push(new _tokens.FlowMappingStartToken(null,null));else if("]"===e)this.index+=1,this.tokens.push(new _tokens.FlowSequenceEndToken(null,null));else if("}"===e)this.index+=1,this.tokens.push(new _tokens.FlowMappingEndToken(null,null));else if("?"===e)this.index+=1,this.tokens.push(new _tokens.KeyToken(null,null));else if(":"===e)this.index+=1,this.tokens.push(new _tokens.ValueToken(null,null));else if(","===e)this.index+=1,this.tokens.push(new _tokens.FlowEntryToken(null,null));else if("*"===e||"&"===e)this.tokens.push(this.scanAlias());else if("!"===e)this.tokens.push(this.scanTag());else{if('"'!==e)throw new CanonicalError("invalid token");this.tokens.push(this.scanScalar())}}this.scanned=!0},CanonicalScanner.prototype.scanDirective=function(){if(this.data.slice(this.index,this.index+DIRECTIVE.length)===this.DIRECTIVE&&" \n\0".indexOf(this.data.slice(this.index+DIRECTIVE.length))>=0)return this.index+=this.DIRECTIVE.length,new _tokens.DirectiveToken("YAML",[1,1],null,null);throw new CanonicalError("invalid directive")},CanonicalScanner.prototype.scanAlias=function(){var e,t,n;for(n="*"===this.data[this.index]?_tokens.AliasToken:_tokens.AnchorToken,this.index+=1,e=this.index;-1===", \n\0".indexOf(this.data[this.index]);)this.index+=1;return t=this.data.slice(e,this.index),new n(t,null,null)},CanonicalScanner.prototype.scanTag=function(){var e,t;for(this.index+=1,e=this.index;-1===" \n\0".indexOf(this.data[this.index]);)this.index+=1;return t=this.data.slice(e,this.index),t=t?"!"===t[0]?"tag:yaml.org,2002:"+t.slice(1):"<"===t[0]&&">"===t[t.length-1]?t.slice(1,t.length-2):"!"+t:"!",new _tokens.TagToken(t,null,null)},CanonicalScanner.prototype.scanScalar=function(){var e,t,n,r,i,o;for(this.index+=1,e=[],t=this.index,n=!1;'"'!==this.data[this.index];)if("\\"===this.data[this.index]){if(n=!1,e.push(this.data.slice(t,this.index)),this.index+=1,r=this.data[this.index],this.index+=1,"\n"===r)n=!0;else if(QUOTE_CODES.indexOf(r)>=0)o=QUOTE_CODES[r],i=parseInt(this.data.slice(this.index,this.index+o),16),e.puush(String.fromCharCode(i)),this.index+=o;else{if(-1===QUOTE_REPLACES.indexOf(r))throw new CanonicalError("invalid escape code");e.push(QUOTE_REPLACES[r])}t=this.index}else"\n"===this.data[this.index]?(e.push(this.data.slice(t,this.index)),e.push(" "),this.index+=1,t=this.index,n=!0):n&&" "===this.data[this.index]?(this.index+=1,t=this.index):(n=!1,this.index+=1);return e.push(this.data.slice(t,this.index)),this.index+=1,new _tokens.ScalarToken(e.join(""),!1,null,null)},CanonicalScanner.prototype.findToken=function(){for(var e=!1;!e;){for(;" 	".indexOf(this.data[this.index])>=0;)this.index+=1;if("#"===this.data[this.index])for(;"\n"!==this.data[this.index];)this.index+=1;"\n"===this.data[this.index]?this.index+=1:e=!0}},module.exports.CanonicalScanner=CanonicalScanner;