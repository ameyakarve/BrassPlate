function DirWriter(e){var t=this;t instanceof DirWriter||t.error("DirWriter must be called as constructor.",null,!0),"Directory"===e.type&&e.Directory||t.error("Non-directory type "+e.type+" "+JSON.stringify(e),null,!0),Writer.call(this,e)}module.exports=DirWriter;var fs=require("../../graceful-fs/graceful-fs.js"),fstream=require("../fstream.js"),Writer=require("./writer.js"),inherits=require("../../inherits/inherits.js"),mkdir=require("../../mkdirp"),path=require("path"),collect=require("./collect.js");inherits(DirWriter,Writer),DirWriter.prototype._create=function(){var e=this;mkdir(e._path,Writer.dirmode,function(t){return t?e.error(t):(e.ready=!0,e.emit("ready"),e._process(),void 0)})},DirWriter.prototype.write=function(){return!0},DirWriter.prototype.end=function(){this._ended=!0,this._process()},DirWriter.prototype.add=function(e){var t=this;return collect(e),!t.ready||t._currentEntry?(t._buffer.push(e),!1):t._ended?t.error("add after end"):(t._buffer.push(e),t._process(),0===this._buffer.length)},DirWriter.prototype._process=function(){function e(){s||(s=!0,t._currentChild=null,t._processing=!1,t._process())}var t=this;if(!t._processing){var n=t._buffer.shift();if(!n)return t.emit("drain"),t._ended&&t._finish(),void 0;t._processing=!0,t.emit("entry",n);var r=n;do{var i=r._path||r.path;if(i===t.root._path||i===t._path||i&&0===i.indexOf(t._path))return t._processing=!1,n._collected&&n.pipe(),t._process()}while(r=r.parent);var o={parent:t,root:t.root||t,type:n.type,depth:t.depth+1},r=n._path||n.path||n.props.path;n.parent&&(r=r.substr(n.parent._path.length+1)),o.path=path.join(t.path,path.join("/",r)),o.filter=t.filter,Object.keys(n.props).forEach(function(e){o.hasOwnProperty(e)||(o[e]=n.props[e])});var a=t._currentChild=new Writer(o);a.on("ready",function(){n.pipe(a),n.resume()}),a.on("error",function(e){a._swallowErrors?(t.warn(e),a.emit("end"),a.emit("close")):t.emit("error",e)}),a.on("close",e);var s=!1}};