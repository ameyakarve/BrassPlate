function Writer(e,t){var n=this;"string"==typeof e&&(e={path:e}),e.path||n.error("Must provide a path",null,!0);var r=getType(e),i=Writer;switch(r){case"Directory":i=DirWriter;break;case"File":i=FileWriter;break;case"Link":case"SymbolicLink":i=LinkWriter;break;case null:i=ProxyWriter}return n instanceof i?(Abstract.call(n),n.type=e.type,n.props=e,n.depth=e.depth||0,n.clobber=!1===e.clobber?e.clobber:!0,n.parent=e.parent||null,n.root=e.root||e.parent&&e.parent.root||n,n._path=n.path=path.resolve(e.path),"win32"===process.platform&&(n.path=n._path=n.path.replace(/\?/g,"_"),n._path.length>=260&&(n._swallowErrors=!0,n._path="\\\\?\\"+n.path.replace(/\//g,"\\"))),n.basename=path.basename(e.path),n.dirname=path.dirname(e.path),n.linkpath=e.linkpath||null,e.parent=e.root=null,n.size=e.size,"string"==typeof e.mode&&(e.mode=parseInt(e.mode,8)),n.readable=!1,n.writable=!0,n._buffer=[],n.ready=!1,n.filter="function"==typeof e.filter?e.filter:null,n._stat(t),void 0):new i(e)}function create(e){mkdir(path.dirname(e._path),Writer.dirmode,function(t,n){return t?e.error(t):(e._madeDir=n,e._create())})}function endChmod(e,t,n,r,i){var o=t.mode,a=t.follow||"SymbolicLink"!==e.type?"chmod":"lchmod";if(!fs[a])return i();if("number"!=typeof o)return i();var s=511&n.mode;return o=511&o,o===s?i():(fs[a](r,o,i),void 0)}function endChown(e,t,n,r,i){if("win32"===process.platform)return i();if(!process.getuid||0===!process.getuid())return i();if("number"!=typeof t.uid&&"number"!=typeof t.gid)return i();if(n.uid===t.uid&&n.gid===t.gid)return i();var o=e.props.follow||"SymbolicLink"!==e.type?"chown":"lchown";return fs[o]?("number"!=typeof t.uid&&(t.uid=n.uid),"number"!=typeof t.gid&&(t.gid=n.gid),fs[o](r,t.uid,t.gid,i),void 0):i()}function endUtimes(e,t,n,r,i){if(!fs.utimes||"win32"===process.platform)return i();var o=t.follow||"SymbolicLink"!==e.type?"utimes":"lutimes";if("lutimes"!==o||fs[o]||(o="utimes"),!fs[o])return i();var a=n.atime,s=n.mtime,u=t.atime,l=t.mtime;return void 0===u&&(u=a),void 0===l&&(l=s),isDate(u)||(u=new Date(u)),isDate(l)||(u=new Date(l)),u.getTime()===a.getTime()&&l.getTime()===s.getTime()?i():(fs[o](r,u,l,i),void 0)}function endMadeDir(e,t,n){var r=e._madeDir,i=path.dirname(t);endMadeDir_(e,i,function(t){return t?n(t):i===r?n():(endMadeDir(e,i,n),void 0)})}function endMadeDir_(e,t,n){function r(e){return a?void 0:e?n(a=e):0===--o?n():void 0}var i={};Object.keys(e.props).forEach(function(t){i[t]=e.props[t],"mode"===t&&"Directory"!==e.type&&(i[t]=73|i[t])});var o=3,a=null;fs.stat(t,function(o,s){return o?n(a=o):(endChmod(e,i,s,t,r),endChown(e,i,s,t,r),endUtimes(e,i,s,t,r),void 0)})}function objectToString(e){return Object.prototype.toString.call(e)}function isDate(e){return"object"==typeof e&&"[object Date]"===objectToString(e)}module.exports=Writer;var fs=require("../../graceful-fs/graceful-fs.js"),inherits=require("../../inherits/inherits.js"),rimraf=require("../../rimraf/rimraf.js"),mkdir=require("../../mkdirp"),path=require("path"),umask="win32"===process.platform?0:process.umask(),getType=require("./get-type.js"),Abstract=require("./abstract.js");inherits(Writer,Abstract),Writer.dirmode=511&~umask,Writer.filemode=438&~umask;var DirWriter=require("./dir-writer.js"),LinkWriter=require("./link-writer.js"),FileWriter=require("./file-writer.js"),ProxyWriter=require("./proxy-writer.js");Writer.prototype._create=function(){var e=this;fs[e.props.follow?"stat":"lstat"](e._path,function(t){return t?e.warn("Cannot create "+e._path+"\n"+"Unsupported type: "+e.type,"ENOTSUP"):(e._finish(),void 0)})},Writer.prototype._stat=function(e){function t(e,t){if(n.filter&&!n.filter.call(o,o,t))return n._aborted=!0,n.emit("end"),n.emit("close"),void 0;if(e||!t)return create(n);n._old=t;var r=getType(t);return r!==n.type?rimraf(n._path,function(e){return e?n.error(e):(n._old=null,create(n),void 0)}):(create(n),void 0)}var n=this,r=n.props,i=r.follow?"stat":"lstat",o=n._proxy||n;e?t(null,e):fs[i](n._path,t)},Writer.prototype._finish=function(){function e(e){endChmod(n,n.props,e,n._path,t("chmod")),endChown(n,n.props,e,n._path,t("chown")),endUtimes(n,n.props,e,n._path,t("chown"))}function t(e){return r++,function(t){function a(e){return e?(e.fstream_finish_call="setupMadeDir",n.error(e)):(n.emit("end"),n.emit("close"),void 0)}if(!i){if(t)return t.fstream_finish_call=e,n.error(i=t);if(!(--r>0||o))return o=!0,n._madeDir?(endMadeDir(n,n._path,a),void 0):a()}}}var n=this,r=0,i=null,o=!1;if(n._old)n._old.atime=new Date(0),n._old.mtime=new Date(0),e(n._old);else{var a=n.props.follow?"stat":"lstat";fs[a](n._path,function(t,r){return t?"ENOENT"!==t.code||"Link"!==n.type&&"SymbolicLink"!==n.type||"win32"!==process.platform?n.error(t):(n.ready=!0,n.emit("ready"),n.emit("end"),n.emit("close"),n.end=n._finish=function(){},void 0):(e(n._old=r),void 0)})}},Writer.prototype.pipe=function(){this.error("Can't pipe from writable stream")},Writer.prototype.add=function(){this.error("Cannot add to non-Directory type")},Writer.prototype.write=function(){return!0};