(function(){var e,t,n,r,i,o,a,s,u,l,c,f,p;r=require("fs"),l=require("path"),i=require("./helpers"),u=require("./optparse"),e=require("./coffee-script"),p={},s={},f=[],a=null,i.extend(global,{task:function(e,t,n){var r;return n||(r=[t,n],n=r[0],t=r[1]),p[e]={name:e,description:t,action:n}},option:function(e,t,n){return f.push([e,t,n])},invoke:function(e){return p[e]||o(e),p[e].action(s)}}),exports.run=function(){var i,o,l,p,d,h;if(global.__originalDirname=r.realpathSync("."),process.chdir(t(__originalDirname)),o=process.argv.slice(2),e.run(""+r.readFileSync("Cakefile"),{filename:"Cakefile"}),a=new u.OptionParser(f),!o.length)return c();try{s=a.parse(o)}catch(m){return n(""+m)}for(d=s.arguments,h=[],l=0,p=d.length;p>l;l++)i=d[l],h.push(invoke(i));return h},c=function(){var e,t,n,r,i,o;r=l.relative||l.resolve,e=l.join(r(__originalDirname,process.cwd()),"Cakefile"),console.log(""+e+" defines the following tasks:\n");for(n in p)o=p[n],i=20-n.length,i=i>0?Array(i+1).join(" "):"",t=o.description?"# "+o.description:"",console.log("cake "+n+i+" "+t);return f.length?console.log(a.help()):void 0},n=function(e){return console.error(e+"\n"),console.log('To see a list of all tasks/options, run "cake"'),process.exit(1)},o=function(e){return n("No such task: "+e)},t=function(e){var n;if(l.existsSync(l.join(e,"Cakefile")))return e;if(n=l.normalize(l.join(e,"..")),n!==e)return t(n);throw Error("Cakefile not found in "+process.cwd())}}).call(this);