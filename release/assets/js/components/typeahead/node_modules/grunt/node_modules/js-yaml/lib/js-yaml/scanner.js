function ScannerError(){_errors.MarkedYAMLError.apply(this,arguments),this.name="ScannerError"}function SimpleKey(e,t,n,r,i,o){this.tokenNumber=e,this.required=t,this.index=n,this.line=r,this.column=i,this.mark=o}function Scanner(){this.done=!1,this.flowLevel=0,this.tokens=[],this.fetchStreamStart(),this.tokensTaken=0,this.indent=-1,this.indents=[],this.allowSimpleKey=!0,this.possibleSimpleKeys={}}var $$=require("./common"),_errors=require("./errors"),_tokens=require("./tokens"),ESCAPE_REPLACEMENTS={0:"\0",a:"",b:"\b",t:"	","	":"	",n:"\n",v:"",f:"\f",r:"\r",e:""," ":" ",'"':'"',"\\":"\\",N:"Â…",_:"Â ",L:"\u2028",P:"\u2029"},ESCAPE_CODES={x:2,u:4,U:8},range=function(e,t){var n=[];for(void 0===t&&(t=e,e=0);t>0;)n.push(e),t-=1,e+=1;return n};$$.inherits(ScannerError,_errors.MarkedYAMLError),Scanner.prototype.checkToken=function(){for(var e;this.needMoreTokens();)this.fetchMoreTokens();if(this.tokens.length){if(!arguments.length)return!0;for(e=0;arguments.length>e;e+=1)if($$.isInstanceOf(this.tokens[0],arguments[e]))return!0}return!1},Scanner.prototype.peekToken=function(){for(;this.needMoreTokens();)this.fetchMoreTokens();return this.tokens.length?this.tokens[0]:null},Scanner.prototype.getToken=function(){for(var e=null;this.needMoreTokens();)this.fetchMoreTokens();return this.tokens.length&&(this.tokensTaken+=1,e=this.tokens.shift()),e},Scanner.prototype.needMoreTokens=function(){return this.done?!1:this.tokens.length?(this.stalePossibleSimpleKeys(),this.nextPossibleSimpleKey()===this.tokensTaken?!0:!1):!0},Scanner.prototype.fetchMoreTokens=function(){var e;if(this.scanToNextToken(),this.stalePossibleSimpleKeys(),this.unwindIndent(this.column),e=this.peek(),"\0"===e)return this.fetchStreamEnd();if("%"===e&&this.checkDirective())return this.fetchDirective();if("-"===e&&this.checkDocumentStart())return this.fetchDocumentStart();if("."===e&&this.checkDocumentEnd())return this.fetchDocumentEnd();if("["===e)return this.fetchFlowSequenceStart();if("{"===e)return this.fetchFlowMappingStart();if("]"===e)return this.fetchFlowSequenceEnd();if("}"===e)return this.fetchFlowMappingEnd();if(","===e)return this.fetchFlowEntry();if("-"===e&&this.checkBlockEntry())return this.fetchBlockEntry();if("?"===e&&this.checkKey())return this.fetchKey();if(":"===e&&this.checkValue())return this.fetchValue();if("*"===e)return this.fetchAlias();if("&"===e)return this.fetchAnchor();if("!"===e)return this.fetchTag();if("|"===e&&!this.flowLevel)return this.fetchLiteral();if(">"===e&&!this.flowLevel)return this.fetchFolded();if("'"===e)return this.fetchSingle();if('"'===e)return this.fetchDouble();if(this.checkPlain())return this.fetchPlain();throw new ScannerError("while scanning for the next token",null,"found character "+e+" that cannot start any token",this.getMark())},Scanner.prototype.nextPossibleSimpleKey=function(){var e=null;return $$.each(this.possibleSimpleKeys,function(t){(null===e||e>t.tokenNumber)&&(e=t.tokenNumber)}),e},Scanner.prototype.stalePossibleSimpleKeys=function(){$$.each(this.possibleSimpleKeys,function(e,t){if(e.line!==this.line||this.index-e.index>1024){if(e.required)throw new ScannerError("while scanning a simple key",e.mark,"could not found expected ':'",this.getMark());delete this.possibleSimpleKeys[t]}},this)},Scanner.prototype.savePossibleSimpleKey=function(){var e,t,n;if(e=!this.flowLevel&&this.indent===this.column,!this.allowSimpleKey&&e)throw new _errors.YAMLError("Simple key is required");this.allowSimpleKey&&(this.removePossibleSimpleKey(),t=this.tokensTaken+this.tokens.length,n=new SimpleKey(t,e,this.index,this.line,this.column,this.getMark()),this.possibleSimpleKeys[this.flowLevel]=n)},Scanner.prototype.removePossibleSimpleKey=function(){var e;if(void 0!==this.possibleSimpleKeys[this.flowLevel]){if(e=this.possibleSimpleKeys[this.flowLevel],e.required)throw new ScannerError("while scanning a simple key",e.mark,"could not found expected ':'",this.getMark());delete this.possibleSimpleKeys[this.flowLevel]}},Scanner.prototype.unwindIndent=function(e){var t;if(!this.flowLevel)for(;this.indent>e;)t=this.getMark(),this.indent=this.indents.pop(),this.tokens.push(new _tokens.BlockEndToken(t,t))},Scanner.prototype.addIndent=function(e){return e>this.indent?(this.indents.push(this.indent),this.indent=e,!0):!1},Scanner.prototype.fetchStreamStart=function(){var e;e=this.getMark(),this.tokens.push(new _tokens.StreamStartToken(e,e,this.encoding))},Scanner.prototype.fetchStreamEnd=function(){var e;this.unwindIndent(-1),this.removePossibleSimpleKey(),this.allowSimpleKey=!1,this.possibleSimpleKeys={},e=this.getMark(),this.tokens.push(new _tokens.StreamEndToken(e,e)),this.done=!0},Scanner.prototype.fetchDirective=function(){this.unwindIndent(-1),this.removePossibleSimpleKey(),this.allowSimpleKey=!1,this.tokens.push(this.scanDirective())},Scanner.prototype.fetchDocumentStart=function(){this.fetchDocumentIndicator(_tokens.DocumentStartToken)},Scanner.prototype.fetchDocumentEnd=function(){this.fetchDocumentIndicator(_tokens.DocumentEndToken)},Scanner.prototype.fetchDocumentIndicator=function(e){var t,n;this.unwindIndent(-1),this.removePossibleSimpleKey(),this.allowSimpleKey=!1,t=this.getMark(),this.forward(3),n=this.getMark(),this.tokens.push(new e(t,n))},Scanner.prototype.fetchFlowSequenceStart=function(){this.fetchFlowCollectionStart(_tokens.FlowSequenceStartToken)},Scanner.prototype.fetchFlowMappingStart=function(){this.fetchFlowCollectionStart(_tokens.FlowMappingStartToken)},Scanner.prototype.fetchFlowCollectionStart=function(e){var t,n;this.savePossibleSimpleKey(),this.flowLevel+=1,this.allowSimpleKey=!0,t=this.getMark(),this.forward(),n=this.getMark(),this.tokens.push(new e(t,n))},Scanner.prototype.fetchFlowSequenceEnd=function(){this.fetchFlowCollectionEnd(_tokens.FlowSequenceEndToken)},Scanner.prototype.fetchFlowMappingEnd=function(){this.fetchFlowCollectionEnd(_tokens.FlowMappingEndToken)},Scanner.prototype.fetchFlowCollectionEnd=function(e){var t,n;this.removePossibleSimpleKey(),this.flowLevel-=1,this.allowSimpleKey=!1,t=this.getMark(),this.forward(),n=this.getMark(),this.tokens.push(new e(t,n))},Scanner.prototype.fetchFlowEntry=function(){var e,t;this.allowSimpleKey=!0,this.removePossibleSimpleKey(),e=this.getMark(),this.forward(),t=this.getMark(),this.tokens.push(new _tokens.FlowEntryToken(e,t))},Scanner.prototype.fetchBlockEntry=function(){var e,t,n;if(!this.flowLevel){if(!this.allowSimpleKey)throw new ScannerError(null,null,"sequence entries are not allowed here",this.getMark());this.addIndent(this.column)&&(e=this.getMark(),this.tokens.push(new _tokens.BlockSequenceStartToken(e,e)))}this.allowSimpleKey=!0,this.removePossibleSimpleKey(),t=this.getMark(),this.forward(),n=this.getMark(),this.tokens.push(new _tokens.BlockEntryToken(t,n))},Scanner.prototype.fetchKey=function(){var e,t,n;if(!this.flowLevel){if(!this.allowSimpleKey)throw new ScannerError(null,null,"mapping keys are not allowed here",this.getMark());this.addIndent(this.column)&&(e=this.getMark(),this.tokens.push(new _tokens.BlockMappingStartToken(e,e)))}this.allowSimpleKey=!this.flowLevel,this.removePossibleSimpleKey(),t=this.getMark(),this.forward(),n=this.getMark(),this.tokens.push(new _tokens.KeyToken(t,n))},Scanner.prototype.fetchValue=function(){var e,t,n,r;if(void 0!==this.possibleSimpleKeys[this.flowLevel])e=this.possibleSimpleKeys[this.flowLevel],delete this.possibleSimpleKeys[this.flowLevel],this.tokens.splice(e.tokenNumber-this.tokensTaken,0,new _tokens.KeyToken(e.mark,e.mark)),this.flowLevel||this.addIndent(e.column)&&this.tokens.splice(e.tokenNumber-this.tokensTaken,0,new _tokens.BlockMappingStartToken(e.mark,e.mark)),this.allowSimpleKey=!1;else{if(!this.flowLevel&&!this.allowSimpleKey)throw new ScannerError(null,null,"mapping values are not allowed here",this.getMark());this.flowLevel||this.addIndent(this.column)&&(t=this.getMark(),this.tokens.push(new _tokens.BlockMappingStartToken(t,t))),this.allowSimpleKey=!this.flowLevel,this.removePossibleSimpleKey()}n=this.getMark(),this.forward(),r=this.getMark(),this.tokens.push(new _tokens.ValueToken(n,r))},Scanner.prototype.fetchAlias=function(){this.savePossibleSimpleKey(),this.allowSimpleKey=!1,this.tokens.push(this.scanAnchor(_tokens.AliasToken))},Scanner.prototype.fetchAnchor=function(){this.savePossibleSimpleKey(),this.allowSimpleKey=!1,this.tokens.push(this.scanAnchor(_tokens.AnchorToken))},Scanner.prototype.fetchTag=function(){this.savePossibleSimpleKey(),this.allowSimpleKey=!1,this.tokens.push(this.scanTag())},Scanner.prototype.fetchLiteral=function(){this.fetchBlockScalar("|")},Scanner.prototype.fetchFolded=function(){this.fetchBlockScalar(">")},Scanner.prototype.fetchBlockScalar=function(e){this.allowSimpleKey=!0,this.removePossibleSimpleKey(),this.tokens.push(this.scanBlockScalar(e))},Scanner.prototype.fetchSingle=function(){this.fetchFlowScalar("'")},Scanner.prototype.fetchDouble=function(){this.fetchFlowScalar('"')},Scanner.prototype.fetchFlowScalar=function(e){this.savePossibleSimpleKey(),this.allowSimpleKey=!1,this.tokens.push(this.scanFlowScalar(e))},Scanner.prototype.fetchPlain=function(){this.savePossibleSimpleKey(),this.allowSimpleKey=!1,this.tokens.push(this.scanPlain())},Scanner.prototype.checkDirective=function(){return 0===this.column},Scanner.prototype.checkDocumentStart=function(){return 0===+this.column&&"---"===this.prefix(3)?"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(3))>=0:!1},Scanner.prototype.checkDocumentEnd=function(){return 0===+this.column&&"..."===this.prefix(3)?"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(3))>=0:!1},Scanner.prototype.checkBlockEntry=function(){return"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(1))>=0},Scanner.prototype.checkKey=function(){return this.flowLevel?!0:"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(1))>=0},Scanner.prototype.checkValue=function(){return this.flowLevel?!0:"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(1))>=0},Scanner.prototype.checkPlain=function(){var e=this.peek();return-1==="\0 	\r\nÂ…\u2028\u2029-?:,[]{}#&*!|>'\"%@`".indexOf(e)||-1==="\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(1))&&("-"===e||!this.flowLevel&&"?:".indexOf(e)>=0)},Scanner.prototype.scanToNextToken=function(){var e=!1;for(0===this.index&&"ï»¿"===this.peek()&&this.forward();!e;){for(;" "===this.peek();)this.forward();if("#"===this.peek())for(;-1==="\0\r\nÂ…\u2028\u2029".indexOf(this.peek());)this.forward();this.scanLineBreak()?this.flowLevel||(this.allowSimpleKey=!0):e=!0}},Scanner.prototype.scanDirective=function(){var e,t,n,r;if(e=this.getMark(),this.forward(),n=this.scanDirectiveName(e),r=null,"YAML"===n)r=this.scanYamlDirectiveValue(e),t=this.getMark();else if("TAG"===n)r=this.scanTagDirectiveValue(e),t=this.getMark();else for(t=this.getMark();-1==="\0\r\nÂ…\u2028\u2029".indexOf(this.peek());)this.forward();return this.scanDirectiveIgnoredLine(e),new _tokens.DirectiveToken(n,r,e,t)},Scanner.prototype.scanDirectiveName=function(e){var t,n,r;for(t=0,n=this.peek(t);/^[0-9A-Za-z]/.test(n)||"-_".indexOf(n)>=0;)t+=1,n=this.peek(t);if(!t)throw new ScannerError("while scanning a directive",e,"expected alphabetic or numeric character, but found "+n,this.getMark());if(r=this.prefix(t),this.forward(t),n=this.peek(),-1==="\0 \r\nÂ…\u2028\u2029".indexOf(n))throw new ScannerError("while scanning a directive",e,"expected alphabetic or numeric character, but found "+n,this.getMark());return r},Scanner.prototype.scanYamlDirectiveValue=function(e){for(var t,n;" "===this.peek();)this.forward();if(t=this.scanYamlDirectiveNumber(e),"."!==this.peek())throw new ScannerError("while scanning a directive",e,"expected a digit or '.', but found "+this.peek(),this.getMark());if(this.forward(),n=this.scanYamlDirectiveNumber(e),-1==="\0 \r\nÂ…\u2028\u2029".indexOf(this.peek()))throw new ScannerError("while scanning a directive",e,"expected a digit or ' ', but found "+this.peek(),this.getMark());return[t,n]},Scanner.prototype.scanYamlDirectiveNumber=function(e){var t,n,r;if(t=this.peek(),!/^[0-9]/.test(t))throw new ScannerError("while scanning a directive",e,"expected a digit, but found "+t,this.getMark());for(n=0;/^[0-9]/.test(this.peek(n));)n+=1;return r=+this.prefix(n),this.forward(n),r},Scanner.prototype.scanTagDirectiveValue=function(e){for(var t,n;" "===this.peek();)this.forward();for(t=this.scanTagDirectiveHandle(e);" "===this.peek();)this.forward();return n=this.scanTagDirectivePrefix(e),[t,n]},Scanner.prototype.scanTagDirectiveHandle=function(e){var t,n;if(t=this.scanTagHandle("directive",e),n=this.peek()," "!==n)throw new ScannerError("while scanning a directive",e,"expected ' ', but found "+n,this.getMark());return t},Scanner.prototype.scanTagDirectivePrefix=function(e){var t,n;if(t=this.scanTagUri("directive",e),n=this.peek(),-1==="\0 \r\nÂ…\u2028\u2029".indexOf(n))throw new ScannerError("while scanning a directive",e,"expected ' ', but found "+n,this.getMark());return t},Scanner.prototype.scanDirectiveIgnoredLine=function(e){for(var t;" "===this.peek();)this.forward();if("#"===this.peek())for(;-1==="\0\r\nÂ…\u2028\u2029".indexOf(this.peek());)this.forward();if(t=this.peek(),-1==="\0\r\nÂ…\u2028\u2029".indexOf(t))throw new ScannerError("while scanning a directive",e,"expected a comment or a line break, but found "+t,this.getMark());this.scanLineBreak()},Scanner.prototype.scanAnchor=function(e){var t,n,r,i,o,a;for(t=this.getMark(),n=this.peek(),r="*"===n?"alias":"anchor",this.forward(),i=0,o=this.peek(i);/^[0-9A-Za-z]/.test(o)||"-_".indexOf(o)>=0;)i+=1,o=this.peek(i);if(!i)throw new ScannerError("while scanning an "+r,t,"expected alphabetic or numeric character, but found "+o,this.getMark());if(a=this.prefix(i),this.forward(i),o=this.peek(),-1==="\0 	\r\nÂ…\u2028\u2029?:,]}%@`".indexOf(o))throw new ScannerError("while scanning an "+r,t,"expected alphabetic or numeric character, but found "+o,this.getMark());return new e(a,t,this.getMark())},Scanner.prototype.scanTag=function(){var e,t,n,r,i,o;if(e=this.getMark(),t=this.peek(1),"<"===t){if(n=null,this.forward(2),r=this.scanTagUri("tag",e),">"!==this.peek())throw new ScannerError("while parsing a tag",e,"expected '>', but found "+this.peek(),this.getMark());this.forward()}else if("\0 	\r\nÂ…\u2028\u2029".indexOf(t)>=0)n=null,r="!",this.forward();else{for(i=1,o=!1;-1==="\0 \r\nÂ…\u2028\u2029".indexOf(t);){if("!"===t){o=!0;break}i+=1,t=this.peek(i)}o?n=this.scanTagHandle("tag",e):(n="!",this.forward()),r=this.scanTagUri("tag",e)}if(t=this.peek(),-1==="\0 \r\nÂ…\u2028\u2029".indexOf(t))throw new ScannerError("while scanning a tag",e,"expected ' ', but found "+t,this.getMark());return new _tokens.TagToken([n,r],e,this.getMark())},Scanner.prototype.scanBlockScalar=function(e){var t,n,r,i,o,a,s,u,c,l,f,p,d,h=null;for(t=">"===e,n=[],r=this.getMark(),this.forward(),p=this.scanBlockScalarIndicators(r),o=p[0],h=p[1]||null,this.scanBlockScalarIgnoredLine(r),a=this.indent+1,1>a&&(a=1),null===h?(p=this.scanBlockScalarIndentation(),c=p[0],s=p[1],i=p[2],u=Math.max(a,s)):(u=a+h-1,p=this.scanBlockScalarBreaks(u),c=p[0],i=p[1]),l="";+this.column===u&&"\0"!==this.peek();){for(n=n.concat(c),f=-1===" 	".indexOf(this.peek()),d=0;-1==="\0\r\nÂ…\u2028\u2029".indexOf(this.peek(d));)d+=1;if(n.push(this.prefix(d)),this.forward(d),l=this.scanLineBreak(),p=this.scanBlockScalarBreaks(u),c=p[0],i=p[1],+this.column!==u||"\0"===this.peek())break;t&&"\n"===l&&f&&-1===" 	".indexOf(this.peek())?c&&c.length||n.push(" "):n.push(l)}return!1!==o&&n.push(l),!0===o&&(n=n.concat(c)),new _tokens.ScalarToken(n.join(""),!1,r,i,e)},Scanner.prototype.scanBlockScalarIndicators=function(e){var t=null,n=null,r=this.peek();if("+-".indexOf(r)>=0){if(t="+"===r,this.forward(),r=this.peek(),"0123456789".indexOf(r)>=0){if(n=+r,0===n)throw new ScannerError("while scanning a block scalar",e,"expected indentation indicator in the range 1-9, but found 0",this.getMark());this.forward()}}else if("0123456789".indexOf(r)>=0){if(n=+r,0===n)throw new ScannerError("while scanning a block scalar",e,"expected indentation indicator in the range 1-9, but found 0",this.getMark());this.forward(),r=this.peek(),"+-".indexOf(r)>=0&&(t="+"===r,this.forward())}if(r=this.peek(),-1==="\0 \r\nÂ…\u2028\u2029".indexOf(r))throw new ScannerError("while scanning a block scalar",e,"expected chomping or indentation indicators, but found "+r,this.getMark());return[t,n]},Scanner.prototype.scanBlockScalarIgnoredLine=function(e){for(var t;" "===this.peek();)this.forward();if("#"===this.peek())for(;-1==="\0\r\nÂ…\u2028\u2029".indexOf(this.peek());)this.forward();if(t=this.peek(),-1==="\0\r\nÂ…\u2028\u2029".indexOf(t))throw new ScannerError("while scanning a block scalar",e,"expected a comment or a line break, but found "+t,this.getMark());this.scanLineBreak()},Scanner.prototype.scanBlockScalarIndentation=function(){var e,t,n;for(e=[],t=0,n=this.getMark();" \r\nÂ…\u2028\u2029".indexOf(this.peek())>=0;)" "!==this.peek()?(e.push(this.scanLineBreak()),n=this.getMark()):(this.forward(),this.column>t&&(t=this.column));return[e,t,n]},Scanner.prototype.scanBlockScalarBreaks=function(e){var t,n;for(t=[],n=this.getMark();e>this.column&&" "===this.peek();)this.forward();for(;"\r\nÂ…\u2028\u2029".indexOf(this.peek())>=0;)for(t.push(this.scanLineBreak()),n=this.getMark();e>this.column&&" "===this.peek();)this.forward();return[t,n]},Scanner.prototype.scanFlowScalar=function(e){var t,n,r,i,o;for(t='"'===e,n=[],r=this.getMark(),i=this.peek(),this.forward(),n=n.concat(this.scanFlowScalarNonSpaces(t,r));this.peek()!==i;)n=n.concat(this.scanFlowScalarSpaces(t,r)),n=n.concat(this.scanFlowScalarNonSpaces(t,r));return this.forward(),o=this.getMark(),new _tokens.ScalarToken(n.join(""),!1,r,o,e)},Scanner.prototype.scanFlowScalarNonSpaces=function(e,t){var n,r,i,o,a,s=this;for(a=function(e){if(-1==="0123456789ABCDEFabcdef".indexOf(s.peek(e)))throw new ScannerError("while scanning a double-quoted scalar",t,"expected escape sequence of "+r+" hexdecimal numbers, but found "+s.peek(e),s.getMark())},n=[];;){for(r=0;-1==="'\"\\\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(r));)r+=1;if(r&&(n.push(this.prefix(r)),this.forward(r)),i=this.peek(),e||"'"!==i||"'"!==this.peek(1))if(e&&"'"===i||!e&&'"\\'.indexOf(i)>=0)n.push(i),this.forward();else{if(!e||"\\"!==i)return n;if(this.forward(),i=this.peek(),ESCAPE_REPLACEMENTS.hasOwnProperty(i))n.push(ESCAPE_REPLACEMENTS[i]),this.forward();else if(ESCAPE_CODES.hasOwnProperty(i))r=ESCAPE_CODES[i],this.forward(),range(r).forEach(a),o=parseInt(this.prefix(r),16),n.push(String.fromCharCode(o)),this.forward(r);else{if(!("\r\nÂ…\u2028\u2029".indexOf(i)>=0))throw new ScannerError("while scanning a double-quoted scalar",t,"found unknown escape character "+i,this.getMark());this.scanLineBreak(),n=n.concat(this.scanFlowScalarBreaks(e,t))}}else n.push("'"),this.forward(2)}},Scanner.prototype.scanFlowScalarSpaces=function(e,t){var n,r,i,o,a,s;for(n=[],r=0;" 	".indexOf(this.peek(r))>=0;)r+=1;if(i=this.prefix(r),this.forward(r),o=this.peek(),"\0"===o)throw new ScannerError("while scanning a quoted scalar",t,"found unexpected end of stream",this.getMark());return"\r\nÂ…\u2028\u2029".indexOf(o)>=0?(a=this.scanLineBreak(),s=this.scanFlowScalarBreaks(e,t),"\n"!==a?n.push(a):s||n.push(" "),n=n.concat(s)):n.push(i),n},Scanner.prototype.scanFlowScalarBreaks=function(e,t){for(var n,r=[];;){if(n=this.prefix(3),("---"===n||"..."===n)&&"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(3))>=0)throw new ScannerError("while scanning a quoted scalar",t,"found unexpected document separator",this.getMark());for(;" 	".indexOf(this.peek())>=0;)this.forward();if(!("\r\nÂ…\u2028\u2029".indexOf(this.peek())>=0))return r;r.push(this.scanLineBreak())}},Scanner.prototype.scanPlain=function(){var e,t,n,r,i,o,a;for(t=[],n=this.getMark(),r=n,i=this.indent+1,o=[];;){if(a=0,"#"===this.peek())break;for(;;){if(e=this.peek(a),"\0 	\r\nÂ…\u2028\u2029".indexOf(e)>=0||!this.flowLevel&&":"===e&&"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(a+1))>=0||this.flowLevel&&",:?[]{}".indexOf(e)>=0)break;a+=1}if(this.flowLevel&&":"===e&&-1==="\0 	\r\nÂ…\u2028\u2029,[]{}".indexOf(this.peek(a+1)))throw this.forward(a),new ScannerError("while scanning a plain scalar",n,"found unexpected ':'",this.getMark(),"Please check http://pyyaml.org/wiki/YAMLColonInFlowContext for details.");if(0===a)break;if(this.allowSimpleKey=!1,t=t.concat(o),t.push(this.prefix(a)),this.forward(a),r=this.getMark(),o=this.scanPlainSpaces(i,n),!Array.isArray(o)||!o.length||"#"===this.peek()||!this.flowLevel&&i>this.column)break}return new _tokens.ScalarToken(t.join(""),!0,n,r)},Scanner.prototype.scanPlainSpaces=function(){var e,t,n,r,i,o,a;for(e=[],t=0;" "===this.peek(t);)t+=1;if(n=this.prefix(t),this.forward(t),r=this.peek(),"\r\nÂ…\u2028\u2029".indexOf(r)>=0){if(a=this.scanLineBreak(),this.allowSimpleKey=!0,i=this.prefix(3),("---"===i||"..."===i)&&"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(3))>=0)return;for(o=[];" \r\nÂ…\u2028\u2029".indexOf(this.peek())>=0;)if(" "===this.peek())this.forward();else if(o.push(this.scanLineBreak()),i=this.prefix(3),("---"===i||"..."===i)&&"\0 	\r\nÂ…\u2028\u2029".indexOf(this.peek(3))>=0)return;"\n"!==a?e.push(a):o&&o.length||e.push(" "),e=e.concat(o)}else n&&e.push(n);return e},Scanner.prototype.scanTagHandle=function(e,t){var n,r,i;if(n=this.peek(),"!"!==n)throw new ScannerError("while scanning a "+e,t,"expected '!', but found "+n,this.getMark());if(r=1,n=this.peek(r)," "!==n){for(;/^[0-9A-Za-z]/.test(n)||"-_".indexOf(n)>=0;)r+=1,n=this.peek(r);if("!"!==n)throw this.forward(r),new ScannerError("while scanning a "+e,t,"expected '!', but found "+n,this.getMark());r+=1}return i=this.prefix(r),this.forward(r),i},Scanner.prototype.scanTagUri=function(e,t){var n,r,i;for(n=[],r=0,i=this.peek(r);/^[0-9A-Za-z]/.test(i)||"-;/?:@&=+$,_.!~*'()[]%".indexOf(i)>=0;)"%"===i?(n.push(this.prefix(r)),this.forward(r),r=0,n.push(this.scanUriEscapes(e,t))):r+=1,i=this.peek(r);if(r&&(n.push(this.prefix(r)),this.forward(r),r=0),!n.length)throw new ScannerError("while parsing a "+e,t,"expected URI, but found "+i,this.getMark());return n.join("")},Scanner.prototype.scanUriEscapes=function(e,t){var n,r,i,o,a=this;for(n=[],r=this.getMark(),o=function(n){if(-1==="0123456789ABCDEFabcdef".indexOf(a.peek(n)))throw new ScannerError("while scanning a "+e,t,"expected URI escape sequence of 2 hexdecimal numbers, but found "+a.peek(n),a.getMark())};"%"===this.peek();)this.forward(),range(2).forEach(o),n.push(parseInt(this.prefix(2),16)),this.forward(2);try{i=new Buffer(n).toString("utf8")}catch(s){throw new ScannerError("while scanning a "+e,t,""+s,r)}return i},Scanner.prototype.scanLineBreak=function(){var e;return e=this.peek(),"\r\nÂ…".indexOf(e)>=0?("\r\n"===this.prefix(2)?this.forward(2):this.forward(),"\n"):"\u2028\u2029".indexOf(e)>=0?(this.forward(),e):""},module.exports.Scanner=Scanner;