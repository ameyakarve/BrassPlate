function setup_tempdir(){var e=path.join(os.tmpDir(),"argparse_temp");try{fs.mkdirSync(e)}catch(t){if(!t.message.match(/EEXIST/))throw t}return oldcwd=process.cwd(),process.chdir(e),oldcwd}function teardown_tempdir(e){var t=process.cwd();if(process.chdir(e),_.str.startsWith(t,os.tmpDir())){var n=fs.readdirSync(t);n.forEach(function(e){fs.unlinkSync(path.join(t,e))}),fs.rmdirSync(t)}}function setup_files(){var e=[["hello","hello world!\n"],["recursive","-a\n","A\n","@hello"],["invalid","@no-such-path\n"]];oldcwd=setup_tempdir(),e.forEach(function(e){var t=e[0],n=e.slice(1).join("");fs.writeFileSync(t,n)})}var assert=require("assert"),ArgumentParser=require("../lib/argparse").ArgumentParser,fs=require("fs"),os=require("os"),path=require("path"),assert=require("assert"),_=require("underscore");_.str=require("underscore.string");var oldcwd=process.cwd();describe("from file",function(){var e,t;before(function(){setup_files()}),beforeEach(function(){e=new ArgumentParser({debug:!0,fromfilePrefixChars:"@"}),e.addArgument(["-a"]),e.addArgument(["x"]),e.addArgument(["y"],{nargs:"+"})}),after(function(){teardown_tempdir(oldcwd)}),it("test reading arguments from a file",function(){t=e.parseArgs(["X","Y"]),assert.deepEqual(t,{a:null,x:"X",y:["Y"]}),t=e.parseArgs(["X","-a","A","Y","Z"]),assert.deepEqual(t,{a:"A",x:"X",y:["Y","Z"]}),t=e.parseArgs(["@hello","X"]),assert.deepEqual(t,{a:null,x:"hello world!",y:["X"]}),t=e.parseArgs(["X","@hello"]),assert.deepEqual(t,{a:null,x:"X",y:["hello world!"]})}),it("test recursive reading arguments from files",function(){t=e.parseArgs(["-a","B","@recursive","Y","Z"]),assert.deepEqual(t,{a:"A",x:"hello world!",y:["Y","Z"]}),t=e.parseArgs(["X","@recursive","Z","-a","B"]),assert.deepEqual(t,{a:"B",x:"X",y:["hello world!","Z"]})}),it("fest reading arguments from an invalid file",function(){assert.throws(function(){t=e.parseArgs(["@invalid"])},/ENOENT, no such file or directory/)}),it("test reading arguments from an missing file",function(){assert.throws(function(){t=e.parseArgs(["@missing"])},/ENOENT, no such file or directory/)}),it("test custom convertArgLineToArgs function",function(){e.convertArgLineToArgs=function(e){return t=e.split(" "),t=t.map(function(e){return e.trim()}),t=t.filter(function(e){return e.length>0})},t=e.parseArgs(["X","@hello"]),assert.deepEqual(t,{a:null,x:"X",y:["hello","world!"]})})});