function collect(e){function t(e){"string"==typeof e&&(e=new Buffer(e)),(!Buffer.isBuffer(e)||e.length)&&i.push(e)}function n(e){collect(e),o.push(e)}function r(e){e.pause()}if(!e._collected){e._collected=!0,e.pause(),e.on("data",t),e.on("end",t);var i=[];e.on("entry",n);var o=[];e.on("proxy",r),e.pipe=function(r){return function(a){function s(){e.removeListener("entry",n),e.removeListener("data",t),e.removeListener("end",t),e.pipe=r,a&&e.pipe(a),i.forEach(function(t){t?e.emit("data",t):e.emit("end")}),e.resume()}var u=0;return function l(){var t=o[u++];return t?(t.on("end",l),a?a.add(t):e.emit("entry",t),void 0):s()}(),a}}(e.pipe)}}module.exports=collect;