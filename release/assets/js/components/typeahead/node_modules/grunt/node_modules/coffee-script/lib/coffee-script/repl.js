(function(){var e,t,n,r,i,o,a,s,u,l,c,f,p,d,h,m,g,v,y,b,w,_,x;_=process.openStdin(),x=process.stdout,t=require("./coffee-script"),y=require("readline"),m=require("util").inspect,s=require("vm").Script,n=require("module"),r="coffee> ",o="------> ",i="......> ",p=!1,"win32"!==process.platform&&(p=!process.env.NODE_DISABLE_COLORS),d=function(e){return x.write((e.stack||""+e)+"\n")},e=/\s*([\w\.]+)(?:\.(\w*))$/,a=/(\w+)$/i,u=function(e){return c(e)||f(e)||[[],e]},c=function(t){var n,r,i,o,a,u,l,c;if(o=t.match(e)){n=o[0],a=o[1],l=o[2];try{c=s.runInThisContext(a)}catch(f){return}c=Object(c),u=Object.getOwnPropertyNames(c);for(i in c)~u.indexOf(c)&&u.push(i);return r=h(l,u),[r,l]}},f=function(e){var n,r,i,o,u,l,c;return r=null!=(c=e.match(a))?c[1]:void 0,""===e&&(r=""),null!=r?(l=s.runInThisContext("Object.getOwnPropertyNames(Object(this))"),i=function(){var e,n,r,i;for(r=t.RESERVED,i=[],e=0,n=r.length;n>e;e++)u=r[e],"__"!==u.slice(0,2)&&i.push(u);return i}(),o=l.concat(i),n=h(r,o),[n,r]):void 0},h=function(e,t){var n,r,i,o;for(o=[],r=0,i=t.length;i>r;r++)n=t[r],0===n.indexOf(e)&&o.push(n);return o},process.on("uncaughtException",d),l="",w=function(e){var n,o,a;if(e=e.replace(/(^|[\r\n]+)(\s*)##?(?:[^#\r\n][^\r\n]*|)($|[\r\n])/,"$1$2$3"),e=e.replace(/[\r\n]+$/,""),g)return l+=""+e+"\n",b.setPrompt(i),b.prompt(),void 0;if(!(""+e).trim()&&!l)return b.prompt(),void 0;if(n=l+=e,"\\"===n[n.length-1])return l=""+l.slice(0,-1)+"\n",b.setPrompt(i),b.prompt(),void 0;b.setPrompt(r),l="";try{a=global._,o=t.eval("_=("+n+"\n)",{filename:"repl",modulename:"repl"}),void 0===o&&(global._=a),b.output.write(""+m(o,!1,2,p)+"\n")}catch(s){d(s)}return b.prompt()},_.readable?(v="",b={prompt:function(){return x.write(this._prompt)},setPrompt:function(e){return this._prompt=e},input:_,output:x,on:function(){}},_.on("data",function(e){var t,n,r,i,o;if(v+=e,/\n/.test(v))for(n=v.split("\n"),v=n[n.length-1],o=n.slice(0,-1),r=0,i=o.length;i>r;r++)t=o[r],t&&(x.write(""+t+"\n"),w(t))}),_.on("end",function(){var e,t,n,r;for(r=v.trim().split("\n"),t=0,n=r.length;n>t;t++)e=r[t],e&&(x.write(""+e+"\n"),w(e));return x.write("\n"),process.exit(0)})):3>y.createInterface.length?(b=y.createInterface(_,u),_.on("data",function(e){return b.write(e)})):b=y.createInterface(_,x,u),g=!1,b.input.on("keypress",function(e,t){var n,i;if(t&&t.ctrl&&!t.meta&&!t.shift&&"v"===t.name)return n=b.cursor,b.output.cursorTo(0),b.output.clearLine(1),g=!g,!g&&l&&b._line(),l="",b.setPrompt(i=g?o:r),b.prompt(),b.output.cursorTo(i.length+(b.cursor=n))}),b.input.on("keypress",function(e,t){return g&&b.line&&t&&t.ctrl&&!t.meta&&!t.shift&&"d"===t.name?(g=!1,b._line()):void 0}),b.on("attemptClose",function(){return g?(g=!1,b.output.cursorTo(0),b.output.clearLine(1),b._onLine(b.line),void 0):l?(l="",b.output.write("\n"),b.setPrompt(r),b.prompt()):b.close()}),b.on("close",function(){return b.output.write("\n"),b.input.destroy()}),b.on("line",w),b.setPrompt(r),b.prompt()}).call(this);