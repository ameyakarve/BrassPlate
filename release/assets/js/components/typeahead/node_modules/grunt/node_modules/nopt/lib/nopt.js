function nopt(e,t,n,r){n=n||process.argv,e=e||{},t=t||{},"number"!=typeof r&&(r=2),debug(e,t,n,r),n=n.slice(r);var i={},o=[],a=n,s=n.slice(0);return parse(n,i,o,e,t),clean(i,e,exports.typeDefs),i.argv={remain:o,cooked:a,original:s},i.argv.toString=function(){return this.original.map(JSON.stringify).join(" ")},i}function clean(e,t,n){n=n||exports.typeDefs;var r={},i=[!1,!0,null,String,Number];Object.keys(e).forEach(function(o){if("argv"!==o){var a=e[o],s=Array.isArray(a),u=t[o];s||(a=[a]),u||(u=i),u===Array&&(u=i.concat(Array)),Array.isArray(u)||(u=[u]),debug("val=%j",a),debug("types=",u),a=a.map(function(i){if("string"==typeof i&&(debug("string %j",i),i=i.trim(),"null"===i&&~u.indexOf(null)||"true"===i&&(~u.indexOf(!0)||~u.indexOf(Boolean))||"false"===i&&(~u.indexOf(!1)||~u.indexOf(Boolean))?(i=JSON.parse(i),debug("jsonable %j",i)):~u.indexOf(Number)&&!isNaN(i)?(debug("convert to number",i),i=+i):~u.indexOf(Date)&&!isNaN(Date.parse(i))&&(debug("convert to date",i),i=new Date(i))),!t.hasOwnProperty(o))return i;i!==!1||!~u.indexOf(null)||~u.indexOf(!1)||~u.indexOf(Boolean)||(i=null);var a={};return a[o]=i,debug("prevalidated val",a,i,t[o]),validate(a,o,i,t[o],n)?(debug("validated val",a,i,t[o]),a[o]):(exports.invalidHandler?exports.invalidHandler(o,i,t[o],e):exports.invalidHandler!==!1&&debug("invalid: "+o+"="+i,t[o]),r)}).filter(function(e){return e!==r}),a.length?s?(debug(s,e[o],a),e[o]=a):e[o]=a[0]:delete e[o],debug("k=%s val=%j",o,a,e[o])}})}function validateString(e,t,n){e[t]=n+""}function validatePath(e,t,n){return e[t]=path.resolve(n+""),!0}function validateNumber(e,t,n){return debug("validate Number %j %j %j",t,n,isNaN(n)),isNaN(n)?!1:(e[t]=+n,void 0)}function validateDate(e,t,n){debug("validate Date %j %j %j",t,n,Date.parse(n));var r=Date.parse(n);return isNaN(r)?!1:(e[t]=new Date(n),void 0)}function validateBoolean(e,t,n){n=n instanceof Boolean?n.valueOf():"string"==typeof n?isNaN(n)?"null"===n||"false"===n?!1:!0:!!+n:!!n,e[t]=n}function validateUrl(e,t,n){return n=url.parse(n+""),n.host?(e[t]=n.href,void 0):!1}function validateStream(e,t,n){return n instanceof Stream?(e[t]=n,void 0):!1}function validate(e,t,n,r,i){if(Array.isArray(r)){for(var o=0,a=r.length;a>o;o++)if(r[o]!==Array&&validate(e,t,n,r[o],i))return!0;return delete e[t],!1}if(r===Array)return!0;if(r!==r)return debug("Poison NaN",t,n,r),delete e[t],!1;if(n===r)return debug("Explicitly allowed %j",n),e[t]=n,!0;for(var s=!1,u=Object.keys(i),o=0,a=u.length;a>o;o++){debug("test type %j %j %j",t,n,u[o]);var l=i[u[o]];if(l&&r===l.type){var c={};if(s=!1!==l.validate(c,t,n),n=c[t],s){e[t]=n;break}}}return debug("OK? %j (%j %j %j)",s,t,n,u[o]),s||delete e[t],s}function parse(e,t,n,r,i){debug("parse",e,t,n);for(var o=abbrev(Object.keys(r)),a=abbrev(Object.keys(i)),s=0;e.length>s;s++){var u=e[s];if(debug("arg",u),u.match(/^-{2,}$/)){n.push.apply(n,e.slice(s+1)),e[s]="--";break}if("-"!==u.charAt(0))n.push(u);else{if(-1!==u.indexOf("=")){var l=u.split("=");u=l.shift(),l=l.join("="),e.splice.apply(e,[s,1].concat([u,l]))}var c=resolveShort(u,i,a,o);if(debug("arg=%j shRes=%j",u,c),c&&(debug(u,c),e.splice.apply(e,[s,1].concat(c)),u!==c[0])){s--;continue}u=u.replace(/^-+/,"");for(var f=!1;0===u.toLowerCase().indexOf("no-");)f=!f,u=u.substr(3);o[u]&&(u=o[u]);var p,d=r[u]===Array||Array.isArray(r[u])&&-1!==r[u].indexOf(Array),h=e[s+1],g=f||r[u]===Boolean||Array.isArray(r[u])&&-1!==r[u].indexOf(Boolean)||"false"===h&&(null===r[u]||Array.isArray(r[u])&&~r[u].indexOf(null));if(g){p=!f,("true"===h||"false"===h)&&(p=JSON.parse(h),h=null,f&&(p=!p),s++),Array.isArray(r[u])&&h&&(~r[u].indexOf(h)?(p=h,s++):"null"===h&&~r[u].indexOf(null)?(p=null,s++):h.match(/^-{2,}[^-]/)||isNaN(h)||!~r[u].indexOf(Number)?!h.match(/^-[^-]/)&&~r[u].indexOf(String)&&(p=h,s++):(p=+h,s++)),d?(t[u]=t[u]||[]).push(p):t[u]=p;continue}h&&h.match(/^-{2,}$/)&&(h=void 0,s--),p=void 0===h?!0:h,d?(t[u]=t[u]||[]).push(p):t[u]=p,s++}}}function resolveShort(e,t,n,r){if(e=e.replace(/^-+/,""),r[e]&&!t[e])return null;if(n[e])e=n[e];else{var i=t.___singles;i||(i=Object.keys(t).filter(function(e){return 1===e.length}).reduce(function(e,t){return e[t]=!0,e},{}),t.___singles=i);var o=e.split("").filter(function(e){return i[e]});if(o.join("")===e)return o.map(function(e){return t[e]}).reduce(function(e,t){return e.concat(t)},[])}return t[e]&&!Array.isArray(t[e])&&(t[e]=t[e].split(/\s+/)),t[e]}var debug=process.env.DEBUG_NOPT||process.env.NOPT_DEBUG?function(){console.error.apply(console,arguments)}:function(){},url=require("url"),path=require("path"),Stream=require("stream").Stream,abbrev=require("abbrev");if(module.exports=exports=nopt,exports.clean=clean,exports.typeDefs={String:{type:String,validate:validateString},Boolean:{type:Boolean,validate:validateBoolean},url:{type:url,validate:validateUrl},Number:{type:Number,validate:validateNumber},path:{type:path,validate:validatePath},Stream:{type:Stream,validate:validateStream},Date:{type:Date,validate:validateDate}},module===require.main){var assert=require("assert"),util=require("util"),shorthands={s:["--loglevel","silent"],d:["--loglevel","info"],dd:["--loglevel","verbose"],ddd:["--loglevel","silly"],noreg:["--no-registry"],reg:["--registry"],"no-reg":["--no-registry"],silent:["--loglevel","silent"],verbose:["--loglevel","verbose"],h:["--usage"],H:["--usage"],"?":["--usage"],help:["--usage"],v:["--version"],f:["--force"],desc:["--description"],"no-desc":["--no-description"],local:["--no-global"],l:["--long"],p:["--parseable"],porcelain:["--parseable"],g:["--global"]},types={aoa:Array,nullstream:[null,Stream],date:Date,str:String,browser:String,cache:path,color:["always",Boolean],depth:Number,description:Boolean,dev:Boolean,editor:path,force:Boolean,global:Boolean,globalconfig:path,group:[String,Number],gzipbin:String,logfd:[Number,Stream],loglevel:["silent","win","error","warn","info","verbose","silly"],"long":Boolean,"node-version":[!1,String],npaturl:url,npat:Boolean,"onload-script":[!1,String],outfd:[Number,Stream],parseable:Boolean,pre:Boolean,prefix:path,proxy:url,"rebuild-bundle":Boolean,registry:url,searchopts:String,searchexclude:[null,String],shell:path,t:[Array,String],tag:String,tar:String,tmp:path,"unsafe-perm":Boolean,usage:Boolean,user:String,username:String,userconfig:path,version:Boolean,viewer:path,_exit:Boolean};[["-v",{version:!0},[]],["---v",{version:!0},[]],["ls -s --no-reg connect -d",{loglevel:"info",registry:null},["ls","connect"]],["ls ---s foo",{loglevel:"silent"},["ls","foo"]],["ls --registry blargle",{},["ls"]],["--no-registry",{registry:null},[]],["--no-color true",{color:!1},[]],["--no-color false",{color:!0},[]],["--no-color",{color:!1},[]],["--color false",{color:!1},[]],["--color --logfd 7",{logfd:7,color:!0},[]],["--color=true",{color:!0},[]],["--logfd=10",{logfd:10},[]],["--tmp=/tmp -tar=gtar",{tmp:"/tmp",tar:"gtar"},[]],["--tmp=tmp -tar=gtar",{tmp:path.resolve(process.cwd(),"tmp"),tar:"gtar"},[]],["--logfd x",{},[]],["a -true -- -no-false",{"true":!0},["a","-no-false"]],["a -no-false",{"false":!1},["a"]],["a -no-no-true",{"true":!0},["a"]],["a -no-no-no-false",{"false":!1},["a"]],["---NO-no-No-no-no-no-nO-no-no-No-no-no-no-no-no-no-no-no-no-no-no-no-NO-NO-no-no-no-no-no-no-no-body-can-do-the-boogaloo-like-I-do",{"body-can-do-the-boogaloo-like-I-do":!1},[]],["we are -no-strangers-to-love --you-know the-rules --and so-do-i ---im-thinking-of=a-full-commitment --no-you-would-get-this-from-any-other-guy --no-gonna-give-you-up -no-gonna-let-you-down=true --no-no-gonna-run-around false --desert-you=false --make-you-cry false --no-tell-a-lie --no-no-and-hurt-you false",{"strangers-to-love":!1,"you-know":"the-rules",and:"so-do-i","you-would-get-this-from-any-other-guy":!1,"gonna-give-you-up":!1,"gonna-let-you-down":!1,"gonna-run-around":!1,"desert-you":!1,"make-you-cry":!1,"tell-a-lie":!1,"and-hurt-you":!1},["we","are"]],["-t one -t two -t three",{t:["one","two","three"]},[]],["-t one -t null -t three four five null",{t:["one","null","three"]},["four","five","null"]],["-t foo",{t:["foo"]},[]],["--no-t",{t:["false"]},[]],["-no-no-t",{t:["true"]},[]],["-aoa one -aoa null -aoa 100",{aoa:["one",null,100]},[]],["-str 100",{str:"100"},[]],["--color always",{color:"always"},[]],["--no-nullstream",{nullstream:null},[]],["--nullstream false",{nullstream:null},[]],["--notadate 2011-01-25",{notadate:"2011-01-25"},[]],["--date 2011-01-25",{date:new Date("2011-01-25")},[]]].forEach(function(e){var t=e[0].split(/\s+/),n=e[1],r=e[2],i=nopt(types,shorthands,t,0),o=i.argv;delete i.argv,console.log(util.inspect(i,!1,2,!0),o.remain);for(var a in n){var s=JSON.stringify(n[a]),u=JSON.stringify(void 0===i[a]?null:i[a]);s&&"object"==typeof s?assert.deepEqual(s,u):assert.equal(s,u)}assert.deepEqual(r,o.remain)})}