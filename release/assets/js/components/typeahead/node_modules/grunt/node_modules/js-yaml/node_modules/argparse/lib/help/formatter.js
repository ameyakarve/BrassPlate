function Section(e,t){this._parent=e,this._heading=t,this._items=[]}var _=require("underscore");_.str=require("underscore.string");var $$=require("../const");Section.prototype.addItem=function(e){this._items.push(e)},Section.prototype.formatHelp=function(e){var t,n;if(this._parent&&e._indent(),t=this._items.map(function(t){var n,r,i;return n=e,r=t[0],i=t[1],r.apply(n,i)}),t=e._joinParts(t),this._parent&&e._dedent(),!t)return"";if(n="",this._heading&&this._heading!==$$.SUPPRESS){var r=e.currentIndent;n=_.str.repeat(" ",r)+this._heading+":"+$$.EOL}return e._joinParts([$$.EOL,n,t,$$.EOL])};var HelpFormatter=module.exports=function HelpFormatter(e){e=e||{},this._prog=e.prog,this._maxHelpPosition=e.maxHelpPosition||24,this._width=e.width||(process.env.COLUMNS||80)-2,this._currentIndent=0,this._indentIncriment=e.indentIncriment||2,this._level=0,this._actionMaxLength=0,this._rootSection=new Section(null),this._currentSection=this._rootSection,this._whitespaceMatcher=RegExp("\\s+","g"),this._longBreakMatcher=RegExp($$.EOL+$$.EOL+$$.EOL+"+","g")};HelpFormatter.prototype._indent=function(){this._currentIndent+=this._indentIncriment,this._level+=1},HelpFormatter.prototype._dedent=function(){if(this._currentIndent-=this._indentIncriment,this._level-=1,0>this._currentIndent)throw Error("Indent decreased below 0.")},HelpFormatter.prototype._addItem=function(e,t){this._currentSection.addItem([e,t])},HelpFormatter.prototype.startSection=function(e){this._indent();var t=new Section(this._currentSection,e),n=t.formatHelp.bind(t);this._addItem(n,[this]),this._currentSection=t},HelpFormatter.prototype.endSection=function(){this._currentSection=this._currentSection._parent,this._dedent()},HelpFormatter.prototype.addText=function(e){e&&e!==$$.SUPPRESS&&this._addItem(this._formatText,[e])},HelpFormatter.prototype.addUsage=function(e,t,n,r){e!==$$.SUPPRESS&&this._addItem(this._formatUsage,[e,t,n,r])},HelpFormatter.prototype.addArgument=function(e){if(e.help!==$$.SUPPRESS){var t,n=this,r=[this._formatActionInvocation(e)],i=r[0].length;e._getSubactions&&(this._indent(),e._getSubactions().forEach(function(e){var t=n._formatActionInvocation(e);r.push(t),i=Math.max(i,t.length)}),this._dedent()),t=i+this._currentIndent,this._actionMaxLength=Math.max(this._actionMaxLength,t),this._addItem(this._formatAction,[e])}},HelpFormatter.prototype.addArguments=function(e){var t=this;e.forEach(function(e){t.addArgument(e)})},HelpFormatter.prototype.formatHelp=function(){var e=this._rootSection.formatHelp(this);return e&&(e=e.replace(this._longBreakMatcher,$$.EOL+$$.EOL),e=_.str.strip(e,$$.EOL)+$$.EOL),e},HelpFormatter.prototype._joinParts=function(e){return e.filter(function(e){return!!e&&e!==$$.SUPPRESS}).join("")},HelpFormatter.prototype._formatUsage=function(e,t,n,r){if(r||_.isString(r)||(r="usage: "),t=t||[],n=n||[],e)e=_.str.sprintf(e,{prog:this._prog});else if(e||0!==t.length){if(!e){var i,o,a=_.str.sprintf("%(prog)s",{prog:this._prog}),s=[],u=[];if(t.forEach(function(e){e.isOptional()?s.push(e):u.push(e)}),i=this._formatActionsUsage([].concat(s,u),n),e=[a,i].join(" "),o=this._width-this._currentIndent,r.length+e.length>o){var c=RegExp("\\(.*?\\)+|\\[.*?\\]+|\\S+","g"),l=this._formatActionsUsage(s,n),f=this._formatActionsUsage(u,n),p=l.match(c),h=f.match(c)||[];if(p.join(" ")!==l)throw Error("assert \"optionalParts.join(' ') === optionalUsage\"");if(h.join(" ")!==f)throw Error("assert \"positionalParts.join(' ') === positionalUsage\"");var d,g,m,v=function(e,t,n){var r=[],i=[],a=n?n.length-1:t.length-1;return e.forEach(function(e){a+1+e.length>o&&(r.push(t+i.join(" ")),i=[],a=t.length-1),i.push(e),a+=e.length+1}),i&&r.push(t+i.join(" ")),n&&(r[0]=r[0].substr(t.length)),r};.75*o>=r.length+a.length?(g=_.str.repeat(" ",r.length+a.length+1),d=p?[].concat(v([a].concat(p),g,r),v(h,g)):h?v([a].concat(h),g,r):[a]):(g=_.str.repeat(" ",r.length),m=p+h,d=v(m,g),d.length>1&&(d=[].concat(v(p,g),v(h,g))),d=[a]+d),e=d.join($$.EOL)}}}else e=_.str.sprintf("%(prog)s",{prog:this._prog});return r+e+$$.EOL+$$.EOL},HelpFormatter.prototype._formatActionsUsage=function(e,t){var n=[],r=[],i=this;t.forEach(function(t){var i,o,a=e.indexOf(t._groupActions[0]);if(a>=0&&(i=a+t._groupActions.length,_.isEqual(e.slice(a,i),t._groupActions)))for(t._groupActions.forEach(function(e){n.push(e)}),t.required?(r[a]?r[a]+=" (":r[a]="(",r[i]=")"):(r[a]?r[a]+=" [":r[a]="[",r[i]="]"),o=a+1;i>o;o+=1)r[o]="|"});var o=[];e.forEach(function(e,t){var a,s,u,c;e.help===$$.SUPPRESS?(o.push(null),"|"===r[t]?r.splice(t,t):"|"===r[t+1]&&r.splice(t+1,t+1)):e.isOptional()?(s=e.optionStrings[0],0===e.nargs?a=""+s:(u=e.dest.toUpperCase(),c=i._formatArgs(e,u),a=s+" "+c),!e.required&&0>n.indexOf(e)&&(a="["+a+"]"),o.push(a)):(a=i._formatArgs(e,e.dest),n.indexOf(e)>=0&&"["===a[0]&&"]"===a[a.length-1]&&(a=a.slice(1,-1)),o.push(a))});for(var a=r.length-1;a>=0;--a)null!==r[a]&&o.splice(a,0,r[a]);var s=o.filter(function(e){return!!e}).join(" ");return s=s.replace(/([\[(]) /g,"$1"),s=s.replace(/ ([\])])/g,"$1"),s=s.replace(/\[ *\]/g,""),s=s.replace(/\( *\)/g,""),s=s.replace(/\(([^|]*)\)/g,"$1"),s=_.str.strip(s)},HelpFormatter.prototype._formatText=function(e){e=_.str.sprintf(e,{prog:this._prog});var t=this._width-this._currentIndent,n=_.str.repeat(" ",this._currentIndent);return this._fillText(e,t,n)+$$.EOL+$$.EOL},HelpFormatter.prototype._formatAction=function(e){var t,n,r,i,o=this,a=Math.min(this._actionMaxLength+2,this._maxHelpPosition),s=this._width-a,u=a-this._currentIndent-2,c=this._formatActionInvocation(e);return e.help?u>=c.length?(c=_.str.repeat(" ",this._currentIndent)+c+"  "+_.str.repeat(" ",u-c.length),i=0):(c=_.str.repeat(" ",this._currentIndent)+c+$$.EOL,i=a):c=_.str.repeat(" ",this._currentIndent)+c+$$.EOL,r=[c],e.help?(t=this._expandHelp(e),n=this._splitLines(t,s),r.push(_.str.repeat(" ",i)+n[0]+$$.EOL),n.slice(1).forEach(function(e){r.push(_.str.repeat(" ",a)+e+$$.EOL)})):c.charAt(c.length-1)!==$$.EOL&&r.push($$.EOL),e._getSubactions&&(this._indent(),e._getSubactions().forEach(function(e){r.push(o._formatAction(e))}),this._dedent()),this._joinParts(r)},HelpFormatter.prototype._formatActionInvocation=function(e){if(e.isOptional()){var t,n,r=[];return 0===e.nargs?r=r.concat(e.optionStrings):(t=e.dest.toUpperCase(),n=this._formatArgs(e,t),e.optionStrings.forEach(function(e){r.push(e+" "+n)})),r.join(", ")}var i=this._metavarFormatter(e,e.dest),o=i(1);return o[0]},HelpFormatter.prototype._metavarFormatter=function(e,t){var n;if(e.metavar||""===e.metavar)n=e.metavar;else if(e.choices){var r=e.choices;r=_.isString(r)?r.split("").join(", "):_.isArray(r)?r.join(","):_.keys(r).join(","),n="{"+r+"}"}else n=t;return function(e){if(Array.isArray(n))return n;for(var t=[],r=0;e>r;r+=1)t.push(n);return t}},HelpFormatter.prototype._formatArgs=function(e,t){var n,r,i=this._metavarFormatter(e,t);switch(e.nargs){case void 0:case null:r=i(1),n=""+r[0];break;case $$.OPTIONAL:r=i(1),n="["+r[0]+"]";break;case $$.ZERO_OR_MORE:r=i(2),n="["+r[0]+" ["+r[1]+" ...]]";break;case $$.ONE_OR_MORE:r=i(2),n=""+r[0]+" ["+r[1]+" ...]";break;case $$.REMAINDER:n="...";break;case $$.PARSER:r=i(1),n=r[0]+" ...";break;default:r=i(e.nargs),n=r.join(" ")}return n},HelpFormatter.prototype._expandHelp=function(e){var t,n,r={prog:this._prog};for(t in e)e.hasOwnProperty(t)&&(n=e[t],n!==$$.SUPPRESS&&(r[t]=n));return r.choices&&(r.choices=_.isString(r.choices)?r.choices.split("").join(", "):_.isArray(r.choices)?r.choices.join(", "):_.keys(r.choices).join(", ")),_.str.sprintf(this._getHelpString(e),r)},HelpFormatter.prototype._splitLines=function(e,t){var n=[],r=[" ",".",",","!","?"],i=RegExp("["+r.join("")+"][^"+r.join("")+"]*$");return e=e.replace(/[\n\|\t]/g," "),e=_.str.strip(e),e=e.replace(this._whitespaceMatcher," "),e.split($$.EOL).forEach(function(e){if(t>=e.length)return n.push(e),void 0;for(var o=0,a=t,s=0;e.length>=a;)a!==e.length&&r.indexOf(-1>e[a])&&(s=(i.exec(e.substring(o,a))||{}).index,a=o+s+1),n.push(e.substring(o,a)),o=a,a+=t;e.length>o&&n.push(e.substring(o,a))}),n},HelpFormatter.prototype._fillText=function(e,t,n){var r=this._splitLines(e,t);return r.forEach(function(e){e=n+e}),r.join($$.EOL)},HelpFormatter.prototype._getHelpString=function(e){return e.help};