function Reader(e,t){var n=this;if(!(n instanceof Reader))return new Reader(e,t);"string"==typeof e&&(e={path:e}),e.path||n.error("Must provide a path",null,!0);var r,i;switch(e.type&&"function"==typeof e.type?(r=e.type,i=r):(r=getType(e),i=Reader),t&&!r&&(r=getType(t),e[r]=!0,e.type=r),r){case"Directory":i=DirReader;break;case"Link":case"File":i=FileReader;break;case"SymbolicLink":i=LinkReader;break;case"Socket":i=SocketReader;break;case null:i=ProxyReader}return n instanceof i?(Abstract.call(n),n.readable=!0,n.writable=!1,n.type=r,n.props=e,n.depth=e.depth=e.depth||0,n.parent=e.parent||null,n.root=e.root||e.parent&&e.parent.root||n,n._path=n.path=path.resolve(e.path),"win32"===process.platform&&(n.path=n._path=n.path.replace(/\?/g,"_"),n._path.length>=260&&(n._swallowErrors=!0,n._path="\\\\?\\"+n.path.replace(/\//g,"\\"))),n.basename=e.basename=path.basename(n.path),n.dirname=e.dirname=path.dirname(n.path),e.parent=e.root=null,n.size=e.size,n.filter="function"==typeof e.filter?e.filter:null,"alpha"===e.sort&&(e.sort=alphasort),n._stat(t),void 0):new i(e)}function alphasort(e,t){return e===t?0:e.toLowerCase()>t.toLowerCase()?1:e.toLowerCase()<t.toLowerCase()?-1:e>t?1:-1}module.exports=Reader;var fs=require("../../graceful-fs/graceful-fs.js"),Stream=require("stream").Stream,inherits=require("../../inherits/inherits.js"),path=require("path"),getType=require("./get-type.js"),hardLinks=Reader.hardLinks={},Abstract=require("./abstract.js");inherits(Reader,Abstract);var DirReader=require("./dir-reader.js"),FileReader=require("./file-reader.js"),LinkReader=require("./link-reader.js"),SocketReader=require("./socket-reader.js"),ProxyReader=require("./proxy-reader.js");Reader.prototype._stat=function(e){function t(e,t){if(e)return n.error(e);if(Object.keys(t).forEach(function(e){r[e]=t[e]}),void 0!==n.size&&r.size!==n.size)return n.error("incorrect size");n.size=r.size;var i=getType(r);if("Directory"!==i&&r.nlink&&r.nlink>1){var o=r.dev+":"+r.ino;hardLinks[o]!==n._path&&hardLinks[o]?(i=n.type=n.props.type="Link",n.Link=n.props.Link=!0,n.linkpath=n.props.linkpath=hardLinks[o],n._stat=n._read=LinkReader.prototype._read):hardLinks[o]=n._path}if(n.type&&n.type!==i&&n.error("Unexpected type: "+i),n.filter){var a=n._proxy||n;if(!n.filter.call(a,a,r))return n._disowned||(n.abort(),n.emit("end"),n.emit("close")),void 0}var s=["_stat","stat","ready"],u=0;(function l(){if(n._aborted)return n.emit("end"),n.emit("close"),void 0;if(n._paused)return n.once("resume",l),void 0;var e=s[u++];return e?(n.emit(e,r),l(),void 0):n._read()})()}var n=this,r=n.props,i=r.follow?"stat":"lstat";e?process.nextTick(t.bind(null,null,e)):fs[i](n._path,t)},Reader.prototype.pipe=function(e){var t=this;return"function"==typeof e.add&&t.on("entry",function(n){var r=e.add(n);!1===r&&t.pause()}),Stream.prototype.pipe.apply(this,arguments)},Reader.prototype.pause=function(e){this._paused=!0,e=e||this,this.emit("pause",e),this._stream&&this._stream.pause(e)},Reader.prototype.resume=function(e){this._paused=!1,e=e||this,this.emit("resume",e),this._stream&&this._stream.resume(e),this._read()},Reader.prototype._read=function(){this.error("Cannot read unknown type: "+this.type)};