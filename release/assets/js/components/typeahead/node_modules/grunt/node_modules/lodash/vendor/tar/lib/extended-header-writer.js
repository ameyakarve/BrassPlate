function ExtendedHeaderWriter(e){var t=this;if(!(t instanceof ExtendedHeaderWriter))return new ExtendedHeaderWriter(e);t.fields=e;var n={path:("PaxHeader"+path.join("/",e.path||"")).replace(/\\/g,"/").substr(0,100),mode:e.mode||438,uid:e.uid||0,gid:e.gid||0,size:0,mtime:e.mtime||Date.now()/1e3,type:"x",linkpath:"",ustar:"ustar\0",ustarver:"00",uname:e.uname||"",gname:e.gname||"",devmaj:e.devmaj||0,devmin:e.devmin||0};EntryWriter.call(t,n),t.props=n,t._meta=!0}function encodeFields(e,t,n,r){return Object.keys(e).forEach(function(i){var o=e[i];if(tar.numeric[i],t&&(i=t+"."+i),i!==e.type||o!==!0){switch(i){case"mode":case"cksum":case"ustar":case"ustarver":case"prefix":case"basename":case"dirname":case"needExtended":case"block":case"filter":return;case"rdev":if(0===o)return;break;case"nlink":case"dev":case"ino":i="SCHILY."+i;break;default:}if(o&&"object"==typeof o&&!Buffer.isBuffer(o))encodeFields(o,i,n,r);else{if(null===o||void 0===o)return;n.push.apply(n,encodeField(i,o,r))}}}),n}function encodeField(e,t,n){if(e.charAt(0)===e.charAt(0).toLowerCase()){var r=e.split(".")[0];tar.knownExtended[r]||(e="NODETAR."+e)}if(n&&e.charAt(0)!==e.charAt(0).toLowerCase())return[];"number"==typeof val&&(val=val.toString(10));var i=new Buffer(" "+e+"="+t+"\n"),o=Math.floor(Math.log(i.length)/Math.log(10))+1;i.length+o>=Math.pow(10,o)&&(o+=1);var a=o+i.length,s=new Buffer(""+a);if(s.length+i.length!==a)throw Error("Bad length calculation\nlen="+a+"\n"+"lenBuf="+JSON.stringify(""+s)+"\n"+"lenBuf.length="+s.length+"\n"+"digits="+o+"\n"+"s="+JSON.stringify(""+i)+"\n"+"s.length="+i.length);return[s,i]}module.exports=ExtendedHeaderWriter;var inherits=require("../vendor/inherits/inherits.js"),EntryWriter=require("./entry-writer.js");inherits(ExtendedHeaderWriter,EntryWriter);var tar=require("../tar.js"),path=require("path"),inherits=require("../vendor/inherits/inherits.js"),TarHeader=require("./header.js");ExtendedHeaderWriter.prototype.end=function(){var e=this;if(!e._ended){if(e._ended=!0,e._encodeFields(),0===e.props.size)return e._ready=!0,e._stream.end(),void 0;e._stream.write(TarHeader.encode(e.props)),e.body.forEach(function(t){e._stream.write(t)}),e._ready=!0,this._stream.end()}},ExtendedHeaderWriter.prototype._encodeFields=function(){this.body=[],this.fields.prefix&&(this.fields.path=this.fields.prefix+"/"+this.fields.path,this.fields.prefix=""),encodeFields(this.fields,"",this.body,this.fields.noProprietary);var e=this;this.body.forEach(function(t){e.props.size+=t.length})};