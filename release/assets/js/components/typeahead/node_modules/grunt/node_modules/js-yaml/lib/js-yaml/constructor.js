function ConstructorError(){_errors.MarkedYAMLError.apply(this,arguments),this.name="ConstructorError"}function BaseConstructor(){this.constructedObjects=new $$.Hash,this.recursiveObjects=new $$.Hash,this.statePopulators=[],this.deepConstruct=!1,this.yamlConstructors=BaseConstructor.yamlConstructors}function SafeConstructor(){BaseConstructor.apply(this),this.yamlConstructors=SafeConstructor.yamlConstructors}function Constructor(){SafeConstructor.apply(this),this.yamlConstructors=Constructor.yamlConstructors}var $$=require("./common"),_errors=require("./errors"),_nodes=require("./nodes");$$.inherits(ConstructorError,_errors.MarkedYAMLError);var BOOL_VALUES={y:!0,yes:!0,n:!1,no:!1,"true":!0,"false":!1,on:!0,off:!1},TIMESTAMP_REGEXP=RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$");BaseConstructor.yamlConstructors={},BaseConstructor.addConstructor=function(e,t){this.yamlConstructors[e]=t},BaseConstructor.prototype.checkData=function(){return this.checkNode()},BaseConstructor.prototype.getData=function(){return this.checkNode()?this.constructDocument(this.getNode()):void 0},BaseConstructor.prototype.getSingleData=function(){var e=this.getSingleNode();return null!==e?this.constructDocument(e):null},BaseConstructor.prototype.constructDocument=function(e){var t,n,r=this.constructObject(e);for(t=function(e){e.execute()};this.statePopulators.length;)n=this.statePopulators,this.statePopulators=[],n.forEach(t);return this.constructedObjects=new $$.Hash,this.recursiveObjects=new $$.Hash,this.deepConstruct=!1,r},BaseConstructor.prototype.constructObject=function(e,t){var n,r,i,o;if(this.constructedObjects.hasKey(e))return this.constructedObjects.get(e);if(t&&(r=this.deepConstruct,this.deepConstruct=!0),this.recursiveObjects.hasKey(e))throw new ConstructorError(null,null,"found unconstructable recursive node",e.startMark);if(this.recursiveObjects.store(e,null),void 0!==this.yamlConstructors[e.tag])i=this.yamlConstructors[e.tag];else{if(void 0===this.yamlConstructors[null])throw new ConstructorError(null,null,"can't find any constructor for tag="+e.tag,e.startMark);i=this.yamlConstructors[null]}return n=i.call(this,e),n instanceof $$.Populator&&(o=n,n=o.data,this.deepConstruct?o.execute():this.statePopulators.push(o)),this.constructedObjects.store(e,n),this.recursiveObjects.remove(e),t&&(this.deepConstruct=r),n},BaseConstructor.prototype.constructScalar=function(e){if(!$$.isInstanceOf(e,_nodes.ScalarNode))throw new ConstructorError(null,null,"expected a scalar node, but found "+e.id,e.startMark);return e.value},BaseConstructor.prototype.constructSequence=function(e,t){if(!$$.isInstanceOf(e,_nodes.SequenceNode))throw new ConstructorError(null,null,"expected a sequence node, but found "+e.id,e.startMark);return e.value.map(function(e){return this.constructObject(e,t)},this)},BaseConstructor.prototype.constructMapping=function(e,t){var n;if(!$$.isInstanceOf(e,_nodes.MappingNode))throw new ConstructorError(null,null,"expected a mapping node, but found "+e.id,e.startMark);return n={},$$.each(e.value,function(e){var r,i,o=e[0],a=e[1];if(r=this.constructObject(o,t),void 0===o.hash)throw new ConstructorError("while constructing a mapping",o.startMark,"found unhashable key",o.startMark);i=this.constructObject(a,t),n[r]=i},this),n},BaseConstructor.prototype.constructPairs=function(e,t){var n;if(!$$.isInstanceOf(e,_nodes.MappingNode))throw new ConstructorError(null,null,"expected a mapping node, but found "+e.id,e.startMark);return n=[],$$.each(e.value,function(e){var r,i;r=this.constructObject(e[0],t),i=this.constructObject(e[1],t),n.store(r,i)},this),n},$$.inherits(SafeConstructor,BaseConstructor),SafeConstructor.yamlConstructors=$$.extend({},BaseConstructor.yamlConstructors),SafeConstructor.addConstructor=BaseConstructor.addConstructor,SafeConstructor.prototype.constructScalar=function(e){var t;return $$.isInstanceOf(e,_nodes.MappingNode)&&($$.each(e.value,function(e){var n=e[0],r=e[1];"tag:yaml.org,2002:value"===n.tag&&(t=this.constructScalar(r))},this),void 0!==t)?t:BaseConstructor.prototype.constructScalar.call(this,e)},SafeConstructor.prototype.flattenMapping=function(e){var t,n,r,i,o,a,s=this,u=[],c=0;for(i=function(e){u.push(e)},o=function(e){e.forEach(i)},a=function(t){if(!$$.isInstanceOf(t,_nodes.MappingNode))throw new ConstructorError("while constructing a mapping",e.startMark,"expected a mapping for merging, but found "+t.id,t.startMark);s.flattenMapping(t),r.push(t.value)};e.value.length>c;)if(t=e.value[c][0],n=e.value[c][1],"tag:yaml.org,2002:merge"===t.tag)if(e.value.splice(c,1),$$.isInstanceOf(n,_nodes.MappingNode))s.flattenMapping(n),$$.each(n.value,i);else{if(!$$.isInstanceOf(n,_nodes.SequenceNode))throw new ConstructorError("while constructing a mapping",e.startMark,"expected a mapping or list of mappings for merging, but found "+n.id,n.startMark);r=[],$$.each(n.value,a),$$.reverse(r).forEach(o)}else"tag:yaml.org,2002:value"===t.tag?(t.tag="tag:yaml.org,2002:str",c+=1):c+=1;u.length&&($$.each(e.value,function(e){u.push(e)}),e.value=u)},SafeConstructor.prototype.constructMapping=function(e){return $$.isInstanceOf(e,_nodes.MappingNode)&&this.flattenMapping(e),BaseConstructor.prototype.constructMapping.call(this,e)},SafeConstructor.prototype.constructYamlNull=function(e){return this.constructScalar(e),null},SafeConstructor.prototype.constructYamlBool=function(e){var t=this.constructScalar(e);return BOOL_VALUES[t.toLowerCase()]},SafeConstructor.prototype.constructYamlInt=function(e){var t,n=this.constructScalar(e).replace(/_/g,""),r="-"===n[0]?-1:1,i=[];return"+-".indexOf(n[0])>=0&&(n=n.slice(1)),"0"===n?0:/^0b/.test(n)?r*parseInt(n.slice(2),2):/^0x/.test(n)?r*parseInt(n,16):"0"===n[0]?r*parseInt(n,8):n.indexOf(":")>=0?(n.split(":").forEach(function(e){i.unshift(parseInt(e,10))}),n=0,t=1,i.forEach(function(e){n+=e*t,t*=60}),r*n):r*parseInt(n,10)},SafeConstructor.prototype.constructYamlFloat=function(e){var t,n=this.constructScalar(e).replace(/_/g,""),r="-"===n[0]?-1:1,i=[];return"+-".indexOf(n[0])>=0&&(n=n.slice(1)),".inf"===n?1===r?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===n?0/0:n.indexOf(":")>=0?(n.split(":").forEach(function(e){i.unshift(parseFloat(e,10))}),n=0,t=1,i.forEach(function(e){n+=e*t,t*=60}),r*n):r*parseFloat(n,10)},SafeConstructor.prototype.constructYamlBinary=function(e){try{return $$.decodeBase64(this.constructScalar(e))}catch(t){throw new ConstructorError(null,null,"failed to decode base64 data: "+(""+t),e.startMark)}},SafeConstructor.prototype.constructYamlTimestamp=function(e){var t,n,r,i,o,a,s,u,c,l,f=0,p=null;if(t=TIMESTAMP_REGEXP.exec(this.constructScalar(e)),n=+t[1],r=+t[2]-1,i=+t[3],!t[4])return new Date(Date.UTC(n,r,i));if(o=+t[4],a=+t[5],s=+t[6],t[7]){for(f=t[7].slice(0,3);3>f.length;)f+="0";f=+f}return t[9]&&(u=+t[10],c=+(t[11]||0),p=6e4*(60*u+c),"-"===t[9]&&(p=-p)),l=new Date(Date.UTC(n,r,i,o,a,s,f)),p&&l.setTime(l.getTime()-p),l},SafeConstructor.prototype.constructYamlOmap=function(e){var t=this,n=[];return $$.Populator(n,function(){if(!$$.isInstanceOf(e,_nodes.SequenceNode))throw new ConstructorError("while constructing an ordered map",e.startMark,"expected a sequence, but found "+e.id,e.startMark);e.value.forEach(function(r){var i,o,a;if(!$$.isInstanceOf(r,_nodes.MappingNode))throw new ConstructorError("while constructing an ordered map",e.startMark,"expected a mapping of length 1, but found "+r.id,r.startMark);if(1!==r.value.length)throw new ConstructorError("while constructing an ordered map",e.startMark,"expected a single mapping item, but found "+r.value.length+" items",r.startMark);o=t.constructObject(r.value[0][0]),a=t.constructObject(r.value[0][1]),i=Object.create(null),i[o]=a,n.push(i)})})},SafeConstructor.prototype.constructYamlPairs=function(e){var t=this,n=[];return $$.Populator(n,function(){if(!$$.isInstanceOf(e,_nodes.SequenceNode))throw new ConstructorError("while constructing pairs",e.startMark,"expected a sequence, but found "+e.id,e.startMark);e.value.forEach(function(r){var i,o;if(!$$.isInstanceOf(r,_nodes.MappingNode))throw new ConstructorError("while constructing pairs",e.startMark,"expected a mapping of length 1, but found "+r.id,r.startMark);if(1!==r.value.length)throw new ConstructorError("while constructing pairs",e.startMark,"expected a single mapping item, but found "+r.value.length+" items",r.startMark);i=t.constructObject(r.value[0][0]),o=t.constructObject(r.value[0][1]),n.push([i,o])})})},SafeConstructor.prototype.constructYamlSet=function(e){var t={};return $$.Populator(t,function(){$$.extend(t,this.constructMapping(e))},this)},SafeConstructor.prototype.constructYamlStr=function(e){return this.constructScalar(e)},SafeConstructor.prototype.constructYamlSeq=function(e){var t=[];return $$.Populator(t,function(){this.constructSequence(e).forEach(function(e){t.push(e)})},this)},SafeConstructor.prototype.constructYamlMap=function(e){var t={};return $$.Populator(t,function(){$$.extend(t,this.constructMapping(e,!0))},this)},SafeConstructor.prototype.constructUndefined=function(e){throw new ConstructorError(null,null,"could not determine constructor for the tag "+e.tag,e.startMark)},SafeConstructor.addConstructor("tag:yaml.org,2002:null",SafeConstructor.prototype.constructYamlNull),SafeConstructor.addConstructor("tag:yaml.org,2002:bool",SafeConstructor.prototype.constructYamlBool),SafeConstructor.addConstructor("tag:yaml.org,2002:int",SafeConstructor.prototype.constructYamlInt),SafeConstructor.addConstructor("tag:yaml.org,2002:float",SafeConstructor.prototype.constructYamlFloat),SafeConstructor.addConstructor("tag:yaml.org,2002:binary",SafeConstructor.prototype.constructYamlBinary),SafeConstructor.addConstructor("tag:yaml.org,2002:timestamp",SafeConstructor.prototype.constructYamlTimestamp),SafeConstructor.addConstructor("tag:yaml.org,2002:omap",SafeConstructor.prototype.constructYamlOmap),SafeConstructor.addConstructor("tag:yaml.org,2002:pairs",SafeConstructor.prototype.constructYamlPairs),SafeConstructor.addConstructor("tag:yaml.org,2002:set",SafeConstructor.prototype.constructYamlSet),SafeConstructor.addConstructor("tag:yaml.org,2002:str",SafeConstructor.prototype.constructYamlStr),SafeConstructor.addConstructor("tag:yaml.org,2002:seq",SafeConstructor.prototype.constructYamlSeq),SafeConstructor.addConstructor("tag:yaml.org,2002:map",SafeConstructor.prototype.constructYamlMap),SafeConstructor.addConstructor(null,SafeConstructor.prototype.constructUndefined),$$.inherits(Constructor,SafeConstructor),Constructor.yamlConstructors=$$.extend({},SafeConstructor.yamlConstructors),Constructor.addConstructor=SafeConstructor.addConstructor,Constructor.prototype.constructJavascriptRegExp=function(e){var t,n=this.constructScalar(e),r=/\/([gim]*)$/.exec(n);return"/"===n[0]&&r&&4>=r[0].length&&(n=n.slice(1,n.length-r[0].length),t=r[1]),RegExp(n,t)},Constructor.prototype.constructJavascriptUndefined=function(){var e;return e},Constructor.prototype.constructJavascriptFunction=function(e){var t=Function("return "+this.constructScalar(e));return t()},Constructor.addConstructor("tag:yaml.org,2002:js/undefined",Constructor.prototype.constructJavascriptUndefined),Constructor.addConstructor("tag:yaml.org,2002:js/regexp",Constructor.prototype.constructJavascriptRegExp),Constructor.addConstructor("tag:yaml.org,2002:js/function",Constructor.prototype.constructJavascriptFunction),module.exports.BaseConstructor=BaseConstructor,module.exports.SafeConstructor=SafeConstructor,module.exports.Constructor=Constructor;