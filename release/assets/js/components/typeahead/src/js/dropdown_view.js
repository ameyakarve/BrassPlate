/*
 * typeahead.js
 * https://github.com/twitter/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */

var DropdownView=function(){function e(e){utils.bindAll(this),this.isMouseOverDropdown,this.$menu=$(e.menu).on("mouseenter",this._handleMouseenter).on("mouseleave",this._handleMouseleave).on("mouseover",".tt-suggestions > .tt-suggestion",this._handleMouseover).on("click",".tt-suggestions > .tt-suggestion",this._handleSelection)}function t(e){var t=e.parents(".tt-suggestions").first();return{value:e.data("value"),query:t.data("query"),dataset:t.data("dataset")}}return utils.mixin(e.prototype,EventTarget,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(e){this._getSuggestions().removeClass("tt-is-under-cursor"),$(e.currentTarget).addClass("tt-is-under-cursor")},_handleSelection:function(e){this.trigger("select",t($(e.currentTarget)))},_moveCursor:function(e){var t,n,r,i;if(this.$menu.hasClass("tt-is-open")){if(t=this._getSuggestions(),n=t.filter(".tt-is-under-cursor"),n.removeClass("tt-is-under-cursor"),r=t.index(n)+e,r=(r+1)%(t.length+1)-1,-1===r)return this.trigger("cursorOff"),void 0;-1>r&&(r=t.length-1),i=t.eq(r).addClass("tt-is-under-cursor"),this.trigger("cursorOn",{value:i.data("value")})}},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},hideUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.hide()},hide:function(){this.$menu.hasClass("tt-is-open")&&(this.$menu.removeClass("tt-is-open").find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor"),this.trigger("hide"))},show:function(){this.$menu.hasClass("tt-is-open")||(this.$menu.addClass("tt-is-open"),this.trigger("show"))},isOpen:function(){return this.$menu.hasClass("tt-is-open")},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var e=this._getSuggestions().filter(".tt-is-under-cursor").first();return e.length>0?t(e):null},getFirstSuggestion:function(){var e=this._getSuggestions().first();return e.length>0?t(e):null},renderSuggestions:function(e,t,n){var r,i,o,s="tt-dataset-"+t.name,a=this.$menu.find("."+s);0===a.length&&(a=$('<li><ol class="tt-suggestions"></ol></li>').addClass(s).appendTo(this.$menu)),r=document.createElement("div"),i=document.createDocumentFragment(),this.clearSuggestions(t.name),n.length>0&&(this.$menu.removeClass("tt-is-empty"),utils.each(n,function(e,n){r.innerHTML=t.template.render(n),o=r.firstChild,o.setAttribute("data-value",n.value),i.appendChild(o)})),a.find("> .tt-suggestions").data({query:e,dataset:t.name}).append(i),this.trigger("suggestionsRender")},clearSuggestions:function(e){var t=e?this.$menu.find(".tt-dataset-"+e+" .tt-suggestions"):this.$menu.find(".tt-suggestions");t.empty(),0===this._getSuggestions().length&&this.$menu.addClass("tt-is-empty")}}),e}();