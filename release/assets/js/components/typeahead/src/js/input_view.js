/*
 * typeahead.js
 * https://github.com/twitter/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */

var InputView=function(){function e(e){var n=this;utils.bindAll(this),this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},this.query="",this.$hint=$(e.hint),this.$input=$(e.input).on("blur",this._handleBlur).on("focus",this._handleFocus).on("keydown",this._handleSpecialKeyEvent),utils.isMsie()?this.$input.on("keydown keypress cut paste",function(e){n.specialKeyCodeMap[e.which||e.keyCode]||setTimeout(n._compareQueryToInputValue,0)}):this.$input.on("input",this._compareQueryToInputValue),this.$overflowHelper=t(this.$input)}function t(e){return $("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function n(e,t){return e=(e||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),t=(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),e===t}return utils.mixin(e.prototype,EventTarget,{_handleFocus:function(){this.trigger("focus")},_handleBlur:function(){this.trigger("blur")},_handleSpecialKeyEvent:function(e){var t=this.specialKeyCodeMap[e.which||e.keyCode];t&&this.trigger(t,e)},_compareQueryToInputValue:function(){var e=this.getInputValue(),t=n(this.query,e),r=t?this.query.length!==e.length:!1;r?this.trigger("whitespaceChange",{value:this.query}):t||this.trigger("queryChange",{value:this.query=e})},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},getInputValue:function(){return this.$input.val()},setInputValue:function(e,t){this.$input.val(e),t!==!0&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(e){this.$hint.val(e)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var e,t=this.$input.val().length,n=this.$input[0].selectionStart;return utils.isNumber(n)?n===t:document.selection?(e=document.selection.createRange(),e.moveStart("character",-t),t===e.text.length):!0}}),e}();