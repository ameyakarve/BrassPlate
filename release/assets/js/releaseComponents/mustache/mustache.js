/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

(function(e,t){"object"==typeof exports&&exports?module.exports=t:"function"==typeof define&&define.amd?define(t):e.Mustache=t})(this,function(){function e(e,t){return RegExp.prototype.test.call(e,t)}function t(t){return!e(h,t)}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return b[e]})}function i(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=e,this.parent=t,this.clearCache()}function s(){this.clearCache()}function a(e){function t(e,t,r){if(!n[e]){var i=a(t);n[e]=function(e,t){return i(e,t,r)}}return n[e]}var n={};return function(n,r,i){for(var o,s,a="",u=0,l=e.length;l>u;++u)switch(o=e[u],o[0]){case"#":s=i.slice(o[3],o[5]),a+=n._section(o[1],r,s,t(u,o[4],i));break;case"^":a+=n._inverted(o[1],r,t(u,o[4],i));break;case">":a+=n._partial(o[1],r);break;case"&":a+=n._name(o[1],r);break;case"name":a+=n._escaped(o[1],r);break;case"text":a+=o[1]}return a}}function u(e){for(var t,n=[],r=n,i=[],o=0,s=e.length;s>o;++o)switch(t=e[o],t[0]){case"#":case"^":i.push(t),r.push(t),r=t[4]=[];break;case"/":var a=i.pop();a[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}function l(e){for(var t,n,r=[],i=0,o=e.length;o>i;++i)t=e[i],"text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t));return r}function c(e){return[RegExp(n(e[0])+"\\s*"),RegExp("\\s*"+n(e[1]))]}var f={};f.name="mustache.js",f.version="0.7.2",f.tags=["{{","}}"],f.Scanner=i,f.Context=o,f.Writer=s;var p=/\s*/,d=/\s+/,h=/\S/,m=/\s*=/,g=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/,y=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.escape=r,i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},i.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},o.make=function(e){return e instanceof o?e:new o(e)},o.prototype.clearCache=function(){this._cache={}},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."===e)t=this.view;else for(var n=this;n;){if(e.indexOf(".")>0){var r=e.split("."),i=0;for(t=n.view;t&&r.length>i;)t=t[r[i++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(e,t){var n=this._cache[e];if(!n){var r=f.parse(e,t);n=this._cache[e]=this.compileTokens(r,e)}return n},s.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},s.prototype.compileTokens=function(e,t){var n=a(e),r=this;return function(e,i){if(i)if("function"==typeof i)r._loadPartial=i;else for(var s in i)r.compilePartial(s,i[s]);return n(r,o.make(e),t)}},s.prototype.render=function(e,t,n){return this.compile(e)(t,n)},s.prototype._section=function(e,t,n,r){var i=t.lookup(e);switch(typeof i){case"object":if(y(i)){for(var o="",s=0,a=i.length;a>s;++s)o+=r(this,t.push(i[s]));return o}return i?r(this,t.push(i)):"";case"function":var u=this,l=function(e){return u.render(e,t)},c=i.call(t.view,n,l);return null!=c?c:"";default:if(i)return r(this,t)}return""},s.prototype._inverted=function(e,t,n){var r=t.lookup(e);return!r||y(r)&&0===r.length?n(this,t):""},s.prototype._partial=function(e,t){e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e));var n=this._partialCache[e];return n?n(t):""},s.prototype._name=function(e,t){var n=t.lookup(e);return"function"==typeof n&&(n=n.call(t.view)),null==n?"":n+""},s.prototype._escaped=function(e,t){return f.escape(this._name(e,t))},f.parse=function(e,r){function o(){if(E&&!q)for(;k.length;)x.splice(k.pop(),1);else k=[];E=!1,q=!1}if(e=e||"",r=r||f.tags,"string"==typeof r&&(r=r.split(d)),2!==r.length)throw Error("Invalid tags: "+r.join(", "));for(var s,a,h,y,b=c(r),w=new i(e),_=[],x=[],k=[],E=!1,q=!1;!w.eos();){if(s=w.pos,h=w.scanUntil(b[0]))for(var S=0,A=h.length;A>S;++S)y=h.charAt(S),t(y)?k.push(x.length):q=!0,x.push(["text",y,s,s+1]),s+=1,"\n"===y&&o();if(s=w.pos,!w.scan(b[0]))break;if(E=!0,a=w.scan(v)||"name",w.scan(p),"="===a)h=w.scanUntil(m),w.scan(m),w.scanUntil(b[1]);else if("{"===a){var T=RegExp("\\s*"+n("}"+r[1]));h=w.scanUntil(T),w.scan(g),w.scanUntil(b[1]),a="&"}else h=w.scanUntil(b[1]);if(!w.scan(b[1]))throw Error("Unclosed tag at "+w.pos);if("/"===a){if(0===_.length)throw Error('Unopened section "'+h+'" at '+s);var j=_.pop();if(j[1]!==h)throw Error('Unclosed section "'+j[1]+'" at '+s)}var C=[a,h,s,w.pos];if(x.push(C),"#"===a||"^"===a)_.push(C);else if("name"===a||"{"===a||"&"===a)q=!0;else if("="===a){if(r=h.split(d),2!==r.length)throw Error("Invalid tags at "+s+": "+r.join(", "));b=c(r)}}var j=_.pop();if(j)throw Error('Unclosed section "'+j[1]+'" at '+w.pos);return u(l(x))};var w=new s;return f.clearCache=function(){return w.clearCache()},f.compile=function(e,t){return w.compile(e,t)},f.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)},f.compileTokens=function(e,t){return w.compileTokens(e,t)},f.render=function(e,t,n){return w.render(e,t,n)},f.to_html=function(e,t,n,r){var i=f.render(e,t,n);return"function"!=typeof r?i:(r(i),void 0)},f}());