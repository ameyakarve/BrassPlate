/*!
 * typeahead.js 0.8.1
 * https://github.com/twitter/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */

(function(){var e="0.8.1",t={isMsie:function(){return/msie [\w.]+/i.test(navigator.userAgent)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isArray:$.isArray,isFunction:$.isFunction,isObject:function(e){return e===Object(e)},isUndefined:function(e){return void 0===e},bind:$.proxy,bindAll:function(e){var n;for(var r in e)t.isFunction(n=e[r])&&(e[r]=$.proxy(n,e))},indexOf:function(e,t){for(var n=0;e.length>n;n++)if(e[n]===t)return n;return-1},each:$.each,map:$.map,filter:function(e,t){var n=[];return $.each(e,function(r,i){t(i,r,e)&&n.push(i)}),n},every:function(e,t){var n=!0;return e?($.each(e,function(r,i){return(n=t.call(null,i,r,e))?void 0:!1}),!!n):n},mixin:$.extend,getUniqueId:function(){var e=0;return function(){return e++}}(),debounce:function(e,t,n){var r,i;return function(){var o,s,a=this,u=arguments;return o=function(){r=null,n||(i=e.apply(a,u))},s=n&&!r,clearTimeout(r),r=setTimeout(o,t),s&&(i=e.apply(a,u)),i}},throttle:function(e,t){var n,r,i,o,s,a;return s=0,a=function(){s=new Date,i=null,o=e.apply(n,r)},function(){var u=new Date,l=t-(u-s);return n=this,r=arguments,0>=l?(clearTimeout(i),i=null,s=u,o=e.apply(n,r)):i||(i=setTimeout(a,l)),o}},uniqueArray:function(e){for(var t={},n=[],r=0,i=e.length;i>r;++r)t.hasOwnProperty(e[r])||(n.push(e[r]),t[e[r]]=1);return n},tokenizeQuery:function(e){return $.trim(e).toLowerCase().split(/[\s]+/)},tokenizeText:function(e){return $.trim(e).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}},n=function(){var e=/\s+/;return{on:function(t,n){var r;if(!n)return this;for(this._callbacks=this._callbacks||{},t=t.split(e);r=t.shift();)this._callbacks[r]=this._callbacks[r]||[],this._callbacks[r].push(n);return this},trigger:function(t,n){var r,i;if(!this._callbacks)return this;for(t=t.split(e);r=t.shift();)if(i=this._callbacks[r])for(var o=0;i.length>o;o+=1)i[o].call(this,{type:r,data:n});return this}}}(),r=function(){function e(e){this.prefix=["__",e,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=RegExp("^"+this.prefix)}function n(){return(new Date).getTime()}function r(e){return JSON.stringify(t.isUndefined(e)?null:e)}function i(e){return JSON.parse(e)}var o,s=window.localStorage;return o=window.localStorage&&window.JSON?{_prefix:function(e){return this.prefix+e},_ttlKey:function(e){return this._prefix(e)+this.ttlKey},get:function(e){return this.isExpired(e)&&this.remove(e),i(s.getItem(this._prefix(e)))},set:function(e,i,o){return t.isNumber(o)?s.setItem(this._ttlKey(e),r(n()+o)):s.removeItem(this._ttlKey(e)),s.setItem(this._prefix(e),r(i))},remove:function(e){return s.removeItem(this._ttlKey(e)),s.removeItem(this._prefix(e)),this},clear:function(){var e,t,n=[],r=s.length;for(e=0;r>e;e++)(t=s.key(e)).match(this.keyMatcher)&&n.push(t.replace(this.keyMatcher,""));for(e=n.length;e--;)this.remove(n[e]);return this},isExpired:function(e){var r=i(s.getItem(this._ttlKey(e)));return t.isNumber(r)&&n()>r?!0:!1}}:{get:t.noop,set:t.noop,remove:t.noop,clear:t.noop,isExpired:t.noop},t.mixin(e.prototype,o),e}(),i=function(){function e(e){t.bindAll(this),e=e||{},this.sizeLimit=e.sizeLimit||10,this.cache={},this.cachedKeysByAge=[]}return t.mixin(e.prototype,{get:function(e){return this.cache[e]},set:function(e,t){var n;this.cachedKeysByAge.length===this.sizeLimit&&(n=this.cachedKeysByAge.shift(),delete this.cache[n]),this.cache[e]=t,this.cachedKeysByAge.push(e)}}),e}(),o=function(){function e(e){var n;t.bindAll(this),e=e||{},n=/^throttle$/i.test(e.rateLimitFn)?t.throttle:t.debounce,this.wait=e.wait||300,this.wildcard=e.wildcard||"%QUERY",this.maxConcurrentRequests=e.maxConcurrentRequests||6,this.concurrentRequests=0,this.onDeckRequestArgs=null,this.cache=new i,this.get=n(this.get,this.wait)}return t.mixin(e.prototype,{_incrementConcurrentRequests:function(){this.concurrentRequests++},_decrementConcurrentRequests:function(){this.concurrentRequests--},_belowConcurrentRequestsThreshold:function(){return this.concurrentRequests<this.maxConcurrentRequests},get:function(e,t,n){var r,i=this;e=e.replace(this.wildcard,encodeURIComponent(t||"")),(r=this.cache.get(e))?n&&n(r):this._belowConcurrentRequestsThreshold()?$.ajax({url:e,type:"GET",dataType:"json",beforeSend:function(){i._incrementConcurrentRequests()},success:function(t){n&&n(t),i.cache.set(e,t)},complete:function(){i._decrementConcurrentRequests(),i.onDeckRequestArgs&&(i.get.apply(i,i.onDeckRequestArgs),i.onDeckRequestArgs=null)}}):this.onDeckRequestArgs=[].slice.call(arguments,0)}}),e}(),s=function(){function n(e){t.bindAll(this),this.storage=new r(e.name),this.adjacencyList={},this.itemHash={},this.name=e.name,this.resetDataOnProtocolSwitch=e.resetDataOnProtocolSwitch||!1,this.queryUrl=e.remote,this.transport=e.transport,this.limit=e.limit||10,this._customMatcher=e.matcher||null,this._customRanker=e.ranker||null,this._ttl_ms=e.ttl_ms||2592e5,this.keys={version:"version",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList"},e.local&&this._processLocalData(e.local),e.prefetch&&this._loadPrefetchData(e.prefetch)}return t.mixin(n.prototype,{_processLocalData:function(e){e&&this._mergeProcessedData(this._processData(e))},_loadPrefetchData:function(n){function r(n){var r=i._processData(n),o=r.itemHash,s=r.adjacencyList;i.storage.set(i.keys.itemHash,o,i._ttl_ms),i.storage.set(i.keys.adjacencyList,s,i._ttl_ms),i.storage.set(i.keys.version,e,i._ttl_ms),i.storage.set(i.keys.protocol,t.getProtocol(),i._ttl_ms),i._mergeProcessedData(r)}var i=this,o=this.storage.get(this.keys.itemHash),s=this.storage.get(this.keys.adjacencyList),a=this.storage.get(this.keys.protocol),u=this.storage.get(this.keys.version),l=u!==e||a!==t.getProtocol();o&&s&&!l?this._mergeProcessedData({itemHash:o,adjacencyList:s}):$.getJSON(n).done(r)},_processData:function(e){var n={},r={};return t.each(e,function(e,i){var o;t.isString(i)&&(i={value:i,tokens:t.tokenizeText(i)}),i.tokens=t.map(i.tokens||[],function(e){return e.toLowerCase()}),n[o=t.getUniqueId(i.value)]=i,t.each(i.tokens,function(e,n){var i=n.charAt(0),s=r[i]||(r[i]=[o]);!~t.indexOf(s,o)&&s.push(o)})}),{itemHash:n,adjacencyList:r}},_mergeProcessedData:function(e){var n=this;t.mixin(this.itemHash,e.itemHash),t.each(e.adjacencyList,function(e,t){var r=n.adjacencyList[e];n.adjacencyList[e]=r?r.concat(t):t})},_getPotentiallyMatchingIds:function(e){var n=[],r=[];if(t.map(e,t.bind(function(e){var t=this.adjacencyList[e.charAt(0)];t&&r.push(t)},this)),1===r.length)return r[0];var i=[];$.each(r,function(e,t){i.push(t.length)});var o=t.indexOf(i,Math.min.apply(null,i))||0,s=r[o]||[];return n=t.map(s,function(e){var n=t.every(r,function(n){return t.indexOf(n,e)>-1});return n?e:void 0})},_getItemsFromIds:function(e){var n=[];return t.map(e,t.bind(function(e){var t=this.itemHash[e];t&&n.push(t)},this)),n},_matcher:function(e){if(this._customMatcher){var n=this._customMatcher;return function(e){return n(e)}}return function(n){var r=n.tokens,i=t.every(e,function(e){var n=t.filter(r,function(t){return 0===t.indexOf(e)});return n.length});return i?n:void 0}},_compareItems:function(e,t,n){var r=e.score_boost?e.score_boost:0,i=t.score_boost?t.score_boost:0,o=e.score?e.score:0,s=t.score?t.score:0;return n?t.weight+i-(e.weight+r):s+i-(o+r)},_ranker:function(e,t){if(this._customRanker)return this._customRanker(e,t);var n=e.weight&&0!==e.weight,r=t.weight&&0!==t.weight;return n&&!r?-1:r&&!n?1:n&&r?this._compareItems(e,t,!0):this._compareItems(e,t,!1)},_processRemoteSuggestions:function(e,n){var r=this;return function(i){t.each(i,function(e,i){var o=!1;return i=t.isString(i)?{value:i}:i,t.each(n,function(e,t){return i.value===t.value?(o=!0,!1):void 0}),!o&&n.push(i),n.length<r.limit}),e&&e(n)}},getSuggestions:function(e,n){var r=t.tokenizeQuery(e),i=this._getPotentiallyMatchingIds(r),o=this._getItemsFromIds(i),s=t.filter(o,this._matcher(r));s.sort(this._ranker),n&&n(s),s.length<this.limit&&this.queryUrl&&this.transport.get(this.queryUrl,e,this._processRemoteSuggestions(n,s))}}),n}(),a=function(){function e(e){var n=this;t.bindAll(this),this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},this.query="",this.$hint=$(e.hint),this.$input=$(e.input).on("blur",this._handleBlur).on("focus",this._handleFocus).on("keydown",this._handleSpecialKeyEvent),t.isMsie()?this.$input.on("keydown keypress cut paste",function(e){n.specialKeyCodeMap[e.which||e.keyCode]||setTimeout(n._compareQueryToInputValue,0)}):this.$input.on("input",this._compareQueryToInputValue),this.$overflowHelper=r(this.$input)}function r(e){return $("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function i(e,t){return e=(e||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),t=(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),e===t}return t.mixin(e.prototype,n,{_handleFocus:function(){this.trigger("focus")},_handleBlur:function(){this.trigger("blur")},_handleSpecialKeyEvent:function(e){var t=this.specialKeyCodeMap[e.which||e.keyCode];t&&this.trigger(t,e)},_compareQueryToInputValue:function(){var e=this.getInputValue(),t=i(this.query,e),n=t?this.query.length!==e.length:!1;n?this.trigger("whitespaceChange",{value:this.query}):t||this.trigger("queryChange",{value:this.query=e})},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},getInputValue:function(){return this.$input.val()},setInputValue:function(e,t){this.$input.val(e),t!==!0&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(e){this.$hint.val(e)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var e,n=this.$input.val().length,r=this.$input[0].selectionStart;return t.isNumber(r)?r===n:document.selection?(e=document.selection.createRange(),e.moveStart("character",-n),n===e.text.length):!0}}),e}(),u=function(){function e(e){t.bindAll(this),this.isMouseOverDropdown,this.$menu=$(e.menu).on("mouseenter",this._handleMouseenter).on("mouseleave",this._handleMouseleave).on("mouseover",".tt-suggestions > .tt-suggestion",this._handleMouseover).on("click",".tt-suggestions > .tt-suggestion",this._handleSelection)}function r(e){var t=e.parents(".tt-suggestions").first();return{value:e.data("value"),query:t.data("query"),dataset:t.data("dataset")}}return t.mixin(e.prototype,n,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(e){this._getSuggestions().removeClass("tt-is-under-cursor"),$(e.currentTarget).addClass("tt-is-under-cursor")},_handleSelection:function(e){this.trigger("select",r($(e.currentTarget)))},_moveCursor:function(e){var t,n,r,i;if(this.$menu.hasClass("tt-is-open")){if(t=this._getSuggestions(),n=t.filter(".tt-is-under-cursor"),n.removeClass("tt-is-under-cursor"),r=t.index(n)+e,r=(r+1)%(t.length+1)-1,-1===r)return this.trigger("cursorOff"),void 0;-1>r&&(r=t.length-1),i=t.eq(r).addClass("tt-is-under-cursor"),this.trigger("cursorOn",{value:i.data("value")})}},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},hideUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.hide()},hide:function(){this.$menu.hasClass("tt-is-open")&&(this.$menu.removeClass("tt-is-open").find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor"),this.trigger("hide"))},show:function(){this.$menu.hasClass("tt-is-open")||(this.$menu.addClass("tt-is-open"),this.trigger("show"))},isOpen:function(){return this.$menu.hasClass("tt-is-open")},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var e=this._getSuggestions().filter(".tt-is-under-cursor").first();return e.length>0?r(e):null},getFirstSuggestion:function(){var e=this._getSuggestions().first();return e.length>0?r(e):null},renderSuggestions:function(e,n,r){var i,o,s,a="tt-dataset-"+n.name,u=this.$menu.find("."+a);0===u.length&&(u=$('<li><ol class="tt-suggestions"></ol></li>').addClass(a).appendTo(this.$menu)),i=document.createElement("div"),o=document.createDocumentFragment(),this.clearSuggestions(n.name),r.length>0&&(this.$menu.removeClass("tt-is-empty"),t.each(r,function(e,t){i.innerHTML=n.template.render(t),s=i.firstChild,s.setAttribute("data-value",t.value),o.appendChild(s)})),u.find("> .tt-suggestions").data({query:e,dataset:n.name}).append(o),this.trigger("suggestionsRender")},clearSuggestions:function(e){var t=e?this.$menu.find(".tt-dataset-"+e+" .tt-suggestions"):this.$menu.find(".tt-suggestions");t.empty(),0===this._getSuggestions().length&&this.$menu.addClass("tt-is-empty")}}),e}(),l=function(){function e(e){t.bindAll(this),this.$node=r(e.input),this.datasets=e.datasets,t.each(this.datasets,function(e,t){var n='<li class="tt-suggestion">%body</li>';t.template=t.template?t.engine.compile(n.replace("%body",t.template)):{render:function(e){return n.replace("%body","<p>"+e.value+"</p>")}}}),this.inputView=new a({input:this.$node.find(".tt-query"),hint:this.$node.find(".tt-hint")}),this.dropdownView=new u({menu:this.$node.find(".tt-dropdown-menu")}),this.dropdownView.on("select",this._handleSelection).on("cursorOn",this._clearHint).on("cursorOn",this._setInputValueToSuggestionUnderCursor).on("cursorOff",this._setInputValueToQuery).on("cursorOff",this._updateHint).on("suggestionsRender",this._updateHint).on("show",this._updateHint).on("hide",this._clearHint),this.inputView.on("focus",this._showDropdown).on("blur",this._hideDropdown).on("blur",this._setInputValueToQuery).on("enter",this._handleSelection).on("queryChange",this._clearHint).on("queryChange",this._clearSuggestions).on("queryChange",this._getSuggestions).on("whitespaceChange",this._updateHint).on("queryChange whitespaceChange",this._showDropdown).on("queryChange whitespaceChange",this._setLanguageDirection).on("esc",this._hideDropdown).on("esc",this._setInputValueToQuery).on("tab up down",this._managePreventDefault).on("up down",this._moveDropdownCursor).on("up down",this._showDropdown).on("tab left right",this._autocomplete)}function r(e){var t=$(e),n=$(i.hint).css({"background-color":t.css("background-color")});if(0===t.length)return null;try{!t.attr("dir")&&t.attr("dir","auto")}catch(r){}return t.attr({autocomplete:"off",spellcheck:!1}).addClass("tt-query").wrap(i.wrapper).parent().prepend(n).append(i.dropdown)}var i={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="off" spellcheck="false" disabled>',dropdown:'<ol class="tt-dropdown-menu tt-is-empty"></ol>'};return t.mixin(e.prototype,n,{_managePreventDefault:function(e){var t,n,r=e.data,i=!1;switch(e.type){case"tab":t=this.inputView.getHintValue(),n=this.inputView.getInputValue(),i=t&&t!==n;break;case"up":case"down":i=!r.shiftKey&&!r.ctrlKey&&!r.metaKey}i&&r.preventDefault()},_setLanguageDirection:function(){var e="tt-"+this.inputView.getLanguageDirection();this.$node.hasClass(e)||this.$node.removeClass("tt-ltr tt-rtl").addClass(e)},_updateHint:function(){var e,t,n,r,i=this.dropdownView.getFirstSuggestion(),o=i?i.value:null;o&&this.dropdownView.isOpen()&&!this.inputView.isOverflow()&&(e=this.inputView.getInputValue(),t=e.replace(/\s{2,}/g," ").replace(/^\s+/g,""),n=RegExp("^(?:"+t+")(.*$)","i"),r=n.exec(o),this.inputView.setHintValue(e+(r?r[1]:"")))},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(e){var t=e.data;this.inputView.setInputValue(t.value,!0)},_showDropdown:function(){this.dropdownView.show()},_hideDropdown:function(e){this.dropdownView["blur"===e.type?"hideUnlessMouseIsOverDropdown":"hide"]()},_moveDropdownCursor:function(e){var t=e.data;t.shiftKey||t.ctrlKey||t.metaKey||this.dropdownView["up"===e.type?"moveCursorUp":"moveCursorDown"]()},_handleSelection:function(e){var n="select"===e.type,r=n?e.data:this.dropdownView.getSuggestionUnderCursor();r&&(this.inputView.setInputValue(r.value),n?this.inputView.focus():e.data.preventDefault(),n&&t.isMsie()?setTimeout(this.dropdownView.hide,0):this.dropdownView.hide())},_getSuggestions:function(){var e=this,n=this.inputView.getQuery();t.each(this.datasets,function(t,r){r.getSuggestions(n,function(t){e._renderSuggestions(n,r,t)})})},_renderSuggestions:function(e,t,n){e===this.inputView.getQuery()&&(n=n.slice(0,t.limit),this.dropdownView.renderSuggestions(e,t,n))},_autocomplete:function(e){var t,n,r,i;("right"!==e.type&&"left"!==e.type||(t=this.inputView.isCursorAtEnd(),n="ltr"===this.inputView.getLanguageDirection()?"left"===e.type:"right"===e.type,t&&!n))&&(r=this.inputView.getQuery(),i=this.inputView.getHintValue(),""!==i&&r!==i&&this.inputView.setInputValue(i))}}),e}();(function(){function e(e){return i[e]?i[e].apply(this,[].slice.call(arguments,1)):i.initialize.apply(this,arguments)}function n(e){u=e}var r,i,a={},u={};jQuery.fn.typeahead=e,e.configureTransport=n,i={initialize:function(n){var i={};if(n=t.isArray(n)?n:[n],0===n.length)throw Error("no datasets provided");return delete e.configureTransport,r=r||new o(u),t.each(n,function(e,n){var o,u=n.name=n.name||t.getUniqueId();if(a[u])o=a[u];else{if(n.limit=n.limit||5,n.template=n.template,n.engine=n.engine,n.template&&!n.engine)throw Error("no template engine specified for "+u);o=a[u]=new s({name:n.name,limit:n.limit,local:n.local,prefetch:n.prefetch,ttl_ms:n.ttl_ms,remote:n.remote,matcher:n.matcher,ranker:n.ranker,transport:r})}i[u]={name:n.name,limit:n.limit,template:n.template,engine:n.engine,getSuggestions:o.getSuggestions}}),this.each(function(){$(this).data({typeahead:new l({input:this,datasets:i})})})}}})()})();