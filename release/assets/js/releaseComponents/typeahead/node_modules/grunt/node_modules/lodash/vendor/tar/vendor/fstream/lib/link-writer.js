function LinkWriter(e){var t=this;if(!(t instanceof LinkWriter))throw Error("LinkWriter must be called as constructor.");if(!("Link"===e.type&&e.Link||"SymbolicLink"===e.type&&e.SymbolicLink))throw Error("Non-link type "+e.type);""===e.linkpath&&(e.linkpath="."),e.linkpath||t.error("Need linkpath property to create "+e.type),Writer.call(this,e)}function clobber(e,t,n){rimraf(e._path,function(r){return r?e.error(r):(create(e,t,n),void 0)})}function create(e,t,n){fs[n](t,e._path,function(t){if(t){if("ENOENT"!==t.code&&"EACCES"!==t.code&&"EPERM"!==t.code||"win32"!==process.platform)return e.error(t);e.ready=!0,e.emit("ready"),e.emit("end"),e.emit("close"),e.end=e._finish=function(){}}finish(e)})}function finish(e){e.ready=!0,e.emit("ready"),e._ended&&!e._finished&&e._finish()}module.exports=LinkWriter;var fs=require("../../graceful-fs/graceful-fs.js"),Writer=require("./writer.js"),inherits=require("../../inherits/inherits.js"),path=require("path"),rimraf=require("../../rimraf/rimraf.js");inherits(LinkWriter,Writer),LinkWriter.prototype._create=function(){var e=this,t="Link"===e.type||"win32"===process.platform,n=t?"link":"symlink",r=t?path.resolve(e.dirname,e.linkpath):e.linkpath;return t?clobber(e,r,n):(fs.readlink(e._path,function(t,i){return i&&i===r?finish(e):(clobber(e,r,n),void 0)}),void 0)},LinkWriter.prototype.end=function(){this._ended=!0,this.ready&&(this._finished=!0,this._finish())};