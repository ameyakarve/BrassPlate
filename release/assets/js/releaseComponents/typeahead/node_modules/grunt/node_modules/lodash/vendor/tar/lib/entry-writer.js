function EntryWriter(e){var t=this;return t instanceof EntryWriter?(Stream.apply(this),t.writable=!0,t.readable=!0,t._stream=new BlockStream(512),t._stream.on("data",function(e){t.emit("data",e)}),t._stream.on("drain",function(){t.emit("drain")}),t._stream.on("end",function(){t.emit("end"),t.emit("close")}),t.props=e,"Directory"===e.type&&(e.size=0),e.ustar="ustar\0",e.ustarver="00",t.path=e.path,t._buffer=[],t._didHeader=!1,t._meta=!1,t.on("pipe",function(){t._process()}),void 0):new EntryWriter(e)}module.exports=EntryWriter;var tar=require("../tar.js"),TarHeader=require("./header.js"),Entry=require("./entry.js"),inherits=require("../vendor/inherits/inherits.js"),BlockStream=require("../vendor/block-stream/block-stream.js"),ExtendedHeaderWriter,Stream=require("stream").Stream,EOF={};inherits(EntryWriter,Stream),EntryWriter.prototype.write=function(e){return this._ended?this.emit("error",Error("write after end")):(this._buffer.push(e),this._process(),this._needDrain=this._buffer.length>0,!this._needDrain)},EntryWriter.prototype.end=function(e){e&&this._buffer.push(e),this._buffer.push(EOF),this._ended=!0,this._process(),this._needDrain=this._buffer.length>0},EntryWriter.prototype.pause=function(){this._paused=!0,this.emit("pause")},EntryWriter.prototype.resume=function(){this._paused=!1,this.emit("resume"),this._process()},EntryWriter.prototype.add=function(e){return this.parent?(this._ended||this.end(),this.parent.add(e)):this.emit("error",Error("no parent"))},EntryWriter.prototype._header=function(){if(!this._didHeader){this._didHeader=!0;var e=TarHeader.encode(this.props);if(this.props.needExtended&&!this._meta){var t=this;ExtendedHeaderWriter=ExtendedHeaderWriter||require("./extended-header-writer.js"),ExtendedHeaderWriter(this.props).on("data",function(e){t.emit("data",e)}).on("error",function(e){t.emit("error",e)}).end()}this.emit("data",e),this.emit("header")}},EntryWriter.prototype._process=function(){if(this._didHeader||this._meta||this._header(),!this._paused&&!this._processing){this._processing=!0;for(var e=this._buffer,t=0;e.length>t;t++){var n=e[t];if(n===EOF?this._stream.end():this._stream.write(n),this._paused)return this._processing=!1,e.length>t&&(this._needDrain=!0,this._buffer=e.slice(t+1)),void 0}this._buffer.length=0,this._processing=!1,this.emit("drain")}},EntryWriter.prototype.destroy=function(){};