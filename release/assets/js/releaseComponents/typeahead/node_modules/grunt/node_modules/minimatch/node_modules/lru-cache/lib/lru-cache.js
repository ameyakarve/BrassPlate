(function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function t(){return 1}function n(i){function o(){if(!(a>=h))for(var e in d){if(a>=h)break;var t=d[e];c&&c(t.key,t.value),h-=t.length,g--,delete f[t.key],delete d[e]}}if(!(this instanceof n))return new n(i);var a;"number"==typeof i&&(a=i,i={max:a}),i||(i={}),a=i.max;var s=i.length||t;"function"!=typeof s&&(s=t),(!a||"number"!=typeof a||0>=a)&&(a=1/0);var u=i.stale||!1,l=i.maxAge||null,c=i.dispose,f=Object.create(null),d=Object.create(null),p=0,h=0,g=0;Object.defineProperty(this,"max",{set:function(e){(!e||"number"!=typeof e||0>=e)&&(e=1/0),a=e,h>a&&o()},get:function(){return a},enumerable:!0}),Object.defineProperty(this,"lengthCalculator",{set:function(e){if("function"!=typeof e){s=t,h=g;for(var n in f)f[n].length=1}else{s=e,h=0;for(var n in f)f[n].length=s(f[n].value),h+=f[n].length}h>a&&o()},get:function(){return s},enumerable:!0}),Object.defineProperty(this,"length",{get:function(){return h},enumerable:!0}),Object.defineProperty(this,"itemCount",{get:function(){return g},enumerable:!0}),this.forEach=function(e,t){t=t||this;for(var n=0,r=p-1;r>=0&&g>n;r--)if(d[r]){n++;var i=d[r];e.call(t,i.value,i.key,this)}},this.keys=function(){for(var e=Array(g),t=0,n=p-1;n>=0&&g>t;n--)if(d[n]){var r=d[n];e[t++]=r.key}return e},this.values=function(){for(var e=Array(g),t=0,n=p-1;n>=0&&g>t;n--)if(d[n]){var r=d[n];e[t++]=r.value}return e},this.reset=function(){if(c)for(var e in f)c(e,f[e].value);f={},d={},p=0,h=0,g=0},this.dump=function(){return f},this.dumpLru=function(){return d},this.set=function(t,n){if(e(f,t))return c&&c(t,f[t].value),l&&(f[t].now=Date.now()),f[t].value=n,this.get(t),!0;var i=s(n),u=l?Date.now():0,m=new r(t,n,p++,i,u);return m.length>a?(c&&c(t,n),!1):(h+=m.length,d[m.lu]=f[t]=m,g++,h>a&&o(),!0)},this.has=function(t){if(!e(f,t))return!1;var n=f[t];return l&&Date.now()-n.now>l?!1:!0},this.get=function(t){if(e(f,t)){var n=f[t];return l&&Date.now()-n.now>l?(this.del(t),u?n.value:void 0):(delete d[n.lu],n.lu=p++,d[n.lu]=n,n.value)}},this.del=function(t){if(e(f,t)){var n=f[t];c&&c(t,n.value),delete f[t],delete d[n.lu],h-=n.length,g--}}}function r(e,t,n,r,i){this.key=e,this.value=t,this.lu=n,this.length=r,this.now=i}"object"==typeof module&&module.exports?module.exports=n:this.LRUCache=n})();