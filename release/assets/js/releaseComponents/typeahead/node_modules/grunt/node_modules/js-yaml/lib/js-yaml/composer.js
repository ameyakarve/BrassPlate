function ComposerError(){_errors.MarkedYAMLError.apply(this,arguments),this.name="ComposerError"}function Composer(){this.anchors={}}var $$=require("./common"),_nodes=require("./nodes"),_events=require("./events"),_errors=require("./errors");$$.inherits(ComposerError,_errors.MarkedYAMLError),Composer.prototype.checkNode=function(){return this.checkEvent(_events.StreamStartEvent)&&this.getEvent(),!this.checkEvent(_events.StreamEndEvent)},Composer.prototype.getNode=function(){return this.checkEvent(_events.StreamEndEvent)?null:this.composeDocument()},Composer.prototype.getSingleNode=function(){var e=null;if(this.getEvent(),this.checkEvent(_events.StreamEndEvent)||(e=this.composeDocument()),!this.checkEvent(_events.StreamEndEvent))throw new ComposerError("expected a single document in the stream",e.startMark,"but found another document",this.getEvent().startMark);return this.getEvent(),e},Composer.prototype.composeDocument=function(){var e;return this.getEvent(),e=this.composeNode(null,null),this.getEvent(),this.anchors={},e},Composer.prototype.composeNode=function(){var e,t,n=null;if(this.checkEvent(_events.AliasEvent)){if(e=this.getEvent(),t=e.anchor,void 0===this.anchors[t])throw new ComposerError(null,null,"found undefined alias "+t,e.startMark);return this.anchors[t]}if(e=this.peekEvent(),t=e.anchor,null!==t&&void 0!==this.anchors[t])throw new ComposerError("found duplicate anchor "+t+"; first occurence",this.anchors[t].startMark,"second occurence",e.startMark);return this.checkEvent(_events.ScalarEvent)?n=this.composeScalarNode(t):this.checkEvent(_events.SequenceStartEvent)?n=this.composeSequenceNode(t):this.checkEvent(_events.MappingStartEvent)&&(n=this.composeMappingNode(t)),n},Composer.prototype.composeScalarNode=function(e){var t,n,r;return t=this.getEvent(),n=t.tag,null===n?n=this.resolve(_nodes.ScalarNode,t.value,t.implicit):"!"===n&&(n=this.resolve(_nodes.ScalarNode,t.value,!1)),r=new _nodes.ScalarNode(n,t.value,t.startMark,t.endMark,t.style),null!==e&&(this.anchors[e]=r),r},Composer.prototype.composeSequenceNode=function(e){var t,n,r,i,o;for(t=this.getEvent(),n=t.tag,null===n?n=this.resolve(_nodes.SequenceNode,null,t.implicit):"!"===n&&(n=this.resolve(_nodes.SequenceNode,null,!1)),r=new _nodes.SequenceNode(n,[],t.startMark,null,t.flowStyle),null!==e&&(this.anchors[e]=r),i=0;!this.checkEvent(_events.SequenceEndEvent);)r.value.push(this.composeNode(r,i)),i+=1;return o=this.getEvent(),r.endMark=o.endMark,r},Composer.prototype.composeMappingNode=function(e){var t,n,r,i,o,a;for(t=this.getEvent(),n=t.tag,null===n?n=this.resolve(_nodes.MappingNode,null,t.implicit):"!"===n&&(n=this.resolve(_nodes.MappingNode,null,!1)),r=new _nodes.MappingNode(n,[],t.startMark,null,t.flowStyle),null!==e&&(this.anchors[e]=r);!this.checkEvent(_events.MappingEndEvent);)i=this.composeNode(r,null),o=this.composeNode(r,i),r.value.push([i,o]);return a=this.getEvent(),r.endMark=a.endMark,r},module.exports.Composer=Composer;