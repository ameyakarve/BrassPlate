define(["jquery","mustache","text!src/modules/Ingredients/templates/typeahead.txt","text!src/modules/Ingredients/templates/addItem.txt","underscore"],function(t,e,n,i,r){var o=function(){var e=(new Date).getTime();t.ajax({type:"GET",url:"api/addIngredient",data:"LASTTIMESTAMP=0&CACHEBANG="+e,success:function(e){t("#calculatorComponent").trigger({type:"dataReceived",returnData:e})},error:function(){}})},s=function(i,o){t("#formComponent").trigger({type:"setTimeStamp",timestamp:i}),t("#ingredientTypeahead").remove(),t("#inputWarning").remove(),t("#inputControls").html(e.render(n,{}));var s=r.map(o,function(t){return t.NAME});t("#ingredientTypeahead").typeahead({source:s,updater:function(e){var n=this.source.indexOf(e);return t("#calculatorComponent").trigger({type:"newItemAdded",item:e,index:n}),e},matcher:function(){return window.$("#warningGroup").removeClass("error"),window.$("#inputWarning").html(" "),!0}})},a=function(n,r){console.log(n),t("#itemList").append(e.render(i,{data:n,index:r})),t("#removeItem"+r).click(function(){t("#calculatorComponent").trigger({type:"itemRemoved",index:r})}),t("#itemQuantity"+r).on("input",function(){t("#calculatorComponent").trigger({type:"quantitiesChanged",index:r,removed:!1})})},u=function(){t("#warningGroup").addClass("error"),t("#inputWarning").html("This item is already present")},c=function(e){t("#addedItem"+e).remove(),t("#calculatorComponent").trigger({type:"quantitiesChanged",index:e,removed:!0})},l=function(){var e=t(".inputQuantity");return r.map(e,function(t){return isNaN(parseFloat(t.value))?0:0>parseFloat(t.value)?0:parseFloat(t.value)})},d=function(e){console.log(e),t("#totalPriceValue").html(e.toFixed(2))},h=function(e,n){var i=parseFloat(t("#itemQuantity"+e)[0].value);(0>i||isNaN(i))&&(i=0);var r=i*n;t("#itemValue"+e).html(r.toFixed(2))};return{CalculatorInit:o,CalculatorsetTypeAhead:s,CalculatoraddItem:a,CalculatoraddItemError:u,CalculatorremoveItem:c,CalculatorgetQuantityValues:l,CalculatorrenderTotalCost:d,CalculatorrenderTotalCostChange:h}});