define(["jquery","assets/js/components/bootstrap/js/bootstrap-combined","mustache","underscore"],function(e,t,n,r){var i=function(){e("#addNewIngredientFormModal").modal({show:!1,keyboard:!1}),e("#addNewIngredientButton").click(function(){e("#addNewIngredientFormModal").modal("show")}),e("#addIngredientFormSubmit").click(function(){e("#formComponent").trigger({type:"addFormSubmit"}),e("#addIngredientFormSubmit").button("loading"),e("#addIngredientModalClose").button("loading"),e("#addIngredientFormClear").button("loading")}),e("#calculatorComponent").trigger({type:"nextDependencyLoaded"})},o=function(){var t=e("#addIngredientmodalForm").serialize(),n=(new Date).getTime();t+="&CACHEBANG="+n,e.ajax({type:"GET",url:"api/addIngredient",data:t,success:function(t){e("#formComponent").trigger({type:"dataReceived",returnData:t})},error:function(){console.log("Error in request")}})},a=function(t){e("#formTimeStamp").val(t.timestamp)},s=function(r){r.returnData.init||(console.log(r),e("#calculatorComponent").trigger({type:"dataReceived",returnData:r.returnData}),e("#addIngredientFormSubmit").button("reset"),e("#addIngredientModalClose").button("reset"),e("#addIngredientFormClear").button("reset"),r.returnData.addedStatus.success?(e("#formAlertArea").html(n.render(t.formSuccess)),e("#ingredientBoxSuccessAlert").alert()):(e("#formAlertArea").html(n.render(t.formError)),e("#ingredientBoxErrorAlert").alert()))},u=function(){var t=(new Date).getTime();e.ajax({type:"GET",url:"api/addIngredient",data:"LASTTIMESTAMP=0&CACHEBANG="+t,success:function(t){e("#calculatorComponent").trigger({type:"dataReceived",returnData:t})},error:function(){}})},c=function(i,o){e("#formComponent").trigger({type:"setTimeStamp",timestamp:i}),e("#ingredientTypeahead").remove(),e("#inputWarning").remove(),e("#inputControls").html(n.render(t.typeAhead,{}));var a=r.map(o,function(e){return e.NAME});e("#ingredientTypeahead").typeahead({source:a,updater:function(t){var n=this.source.indexOf(t);return e("#calculatorComponent").trigger({type:"newItemAdded",item:t,index:n}),t},matcher:function(){return window.$("#warningGroup").removeClass("error"),window.$("#inputWarning").html(" "),!0}})},l=function(r,i){console.log(r),e("#itemList").append(n.render(t.addItem,{data:r,index:i})),e("#removeItem"+i).click(function(){e("#calculatorComponent").trigger({type:"itemRemoved",index:i})}),e("#itemQuantity"+i).on("input",function(){e("#calculatorComponent").trigger({type:"quantitiesChanged",index:i,removed:!1})})},f=function(){e("#warningGroup").addClass("error"),e("#inputWarning").html("This item is already present")},p=function(t){e("#addedItem"+t).remove(),e("#calculatorComponent").trigger({type:"quantitiesChanged",index:t,removed:!0})},h=function(){var t=e(".inputQuantity");return r.map(t,function(e){return isNaN(parseFloat(e.value))?0:0>parseFloat(e.value)?0:parseFloat(e.value)})},d=function(t){console.log(t),e("#totalPriceValue").html(t.toFixed(2))},m=function(t,n){var r=parseFloat(e("#itemQuantity"+t)[0].value);(0>r||isNaN(r))&&(r=0);var i=r*n;e("#itemValue"+t).html(i.toFixed(2))};return{FormInit:i,FormSubmitForm:o,FormReceiveFormData:s,FormSetTimeStamp:a,CalculatorInit:u,CalculatorsetTypeAhead:c,CalculatoraddItem:l,CalculatoraddItemError:f,CalculatorremoveItem:p,CalculatorgetQuantityValues:h,CalculatorrenderTotalCost:d,CalculatorrenderTotalCostChange:m}});